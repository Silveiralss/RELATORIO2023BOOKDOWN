--- 
title: "Relatório de Performance ATM 2022"
author: "Silveira"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book

---

# Sumário executivo


A indústria do transporte aéreo contribui significativamente para a economia do Brasil e do mundo. Apesar dos impactos na economia global decorrentes da pandemia da COVID-19 e do conflito entre Rússia e Ucrânia, espera-se que o setor cresça no longo prazo e o Sistema de Controle do Espaço Aéreo Brasileiro (SISCEAB) deverá estar preparado para essa evolução e as consequências decorrentes desse crescimento.

A Comissão de Performance ATM (CP-ATM) produziu de forma colaborativa o Relatório de Performance do SISCEAB, utilizando métricas e definições comumente acordadas para comparar, entender e melhorar o desempenho dos Serviços de Navegação Aérea brasileiros, por meio da gestão de desempenho das Organizações Regionais do Departamento de Controle do Espaço Aéreo (DECEA). Esta edição encontra-se disponível on-line (http://performance.decea.mil.br) no site de performance do DECEA, juntamente com versões anteriores e outros produtos de performance.

Apesar do Relatório de Performance ser atualizado anualmente, as informações e indicadores nele publicados são monitorados e disponibilizados no site do DECEA, com atualizações periódicas. As boas práticas e lições aprendidas nas análises são coordenadas pela CP-ATM com as Organizações Regionais, com foco no desenvolvimento de novos indicadores de performance e na evolução do sistema de Gerenciamento de Tráfego Aéreo (ATM) nacional.

Este relatório concentra-se em Áreas de Performance (KPA) do Plano Global de Navegação Aérea (GANP ), da Organização de Aviação Civil Internacional (OACI), e seu escopo atende às diretrizes do Plano de Performance ATM do DECEA 2022-2023 (PCA 100-3), conforme mostrado no esquema a seguir:

<div align="center">
![Imagem teste](imagens/fig1.jpg)
 
 A análise comparativa de desempenho entre os sistemas locais mostra as particularidades de cada órgão ATS, com semelhanças e diferenças na prestação do serviço de navegação aérea e na performance das Organizações Regionais. Entre as principais conclusões, destacam-se:
 
 - Em geral, a prestação dos serviços de navegação aérea se reflete em um número mais elevado de controladores de tráfego aéreo (ATCO) nas regiões com maior densidade como a FIR-BS (CINDACTA I).
 - Em geral, a prestação dos serviços de navegação aérea se reflete em um número mais elevado de controladores de tráfego aéreo (ATCO) nas regiões com maior densidade como a FIR-BS (CINDACTA I).
 - As particularidades de cada Organização Regional ficam evidentes quando se confrontam números de movimentos por localidade ou por temporada; número de ATCO por localidade, por tamanho de região, por órgão, por total de movimentos, por complexidade ou por exigência do nível de inglês; por condições meteorológicas, dentre outras.
 - As capacidades de pista e de espaço aéreo estão projetadas para atender os níveis atuais de demanda, bem como o crescimento futuro de curto e médio prazos. Não houve mudanças significativas nos valores declarados de capacidade de espaço aéreo em 2022.
- Em geral, o sistema apresentou associação entre menor demanda e maior eficiência, considerando especialmente os indicadores de pontualidade, de tempo adicional de táxi, de tempo adicional na terminal e de variabilidade de tempo de voo.
- Considerando o escopo deste Relatório, os valores médios anuais encontrados no SISCEAB foram de: Pontualidade de Partida – 84,3% / Pontualidade de Chegada – 67,7% / Tempo Adicional de Taxi-out – 3,65 min / Tempo Adicional de Taxi-in – 1,75 min / Tempo Adicional de Chegada em TMA – 4 min (C100) e 3 min (C40) / Índice de Operacionalidade dos ATCO – 85,4%.
- Foram apresentadas algumas implantações recentes no SISCAB que podem ter impactado a performance geral do sistema ATM, incluindo uma abordagem inicial sobre os drones (UAS e derivados).

Este documento está organizado em cinco capítulos e dois anexos. No primeiro capítulo, é abordada a gestão por performance e apresentado um breve histórico falando sobre o GANP e ambições de desempenho, abordando-se, ainda, a abrangência, o âmbito geográfico, o escopo, o âmbito temporal, considerações sobre a retomada dos movimentos pós pandemia da COVID-19 (o “novo normal”) e as fontes de dados utilizadas nas informações e indicadores apresentados.

O segundo capítulo apresenta as características do SISCEAB, apontando fatores internos e externos que podem influenciar nos resultados dos indicadores estudados, ressaltando como os serviços de navegação aérea são organizados e fazendo uma comparação geral das Organizações Regionais do DECEA. Além disso, inclui informações sobre a demanda nacional, desde o movimento nos principais aeroportos brasileiros, movimentos por segmento da aviação (Comercial Doméstica, Comercial Internacional e Geral), o ranking dos quarenta aeroportos mais movimentados, a participação dos movimentos por FIR, as rotas mais voadas pela aviação comercial, a densidade do tráfego aéreo nacional e sobre a composição da frota de aeronaves no país. São também abordados aspectos como a previsão quinquenal de demanda (nacional e por FIR), questões relacionadas ao ATCO, como efetivo e o nível de inglês, além da influência das condições meteorológicas nos aeroportos e um resumo dos principais projetos em andamento no SISCEAB.
No terceiro capítulo, são apresentados os resultados dos indicadores de performance ATM monitorados pelo DECEA em 2022, observando as metas publicadas no PCA 100-3, que abrangem as áreas de Previsibilidade, Eficiência, Capacidade, Custo-Benefício, Participação da Comunidade ATM, Segurança Operacional (Safety) e Segurança da Aviação (Security). Foram analisados os seguintes indicadores: KPI 01 – Pontualidade de partida, KPI 14 – Pontualidade de chegada, KPI 15 – Variabilidade do tempo de voo, KPI 02 – Tempo adicional de taxi-out, KPI 13 – Tempo adicional de taxi-in, KPI 08 – Tempo adicional em TMA, KPI 06 – Capacidade do espaço aéreo, KPI 09 – Capacidade declarada de chegada, KPI 10 – Taxa-pico de chegada, Medidas ATFM, IDBR 06 – Horas de LOGIN x Horas ATCO, IDBR 08 – Índice de operacionalidade do ATCO, Pesquisa de Satisfação do SISCEAB, Incidente classificado como risco potencial, Incidente classificado como risco crítico, Incursão em pista e Aviso de resolução.

O quarto capítulo aponta as conclusões do estudo e as oportunidades de identificar melhorias a serem exploradas em prol do SISCEAB. No quinto capítulo são listadas as referências utilizadas para o desenvolvimento do trabalho. 
Por fim, as Organizações Regionais do DECEA são apresentadas nos Anexos A e B. No primeiro anexo, tem-se o detalhamento de todos os órgãos ATS (ACC, APP, TWR, D-TWR, AFIS e R-AFIS), por Organização Regional do DECEA. No Anexo B são apresentadas de forma resumida as características das circulações aéreas nas FIR do espaço aéreo brasileiro.

Assim, o objetivo do Relatório de Performance ATM é fornecer uma visão geral da performance do SISCEAB, considerando os dados do ano de 2022, possibilitando uma análise gerencial macro do sistema, bem como de cada Organização Regional do DECEA.

<div align="center">
![Imagem teste](imagens/fig2.jpg)

<div align="center">
![Imagem teste](imagens/fig3.jpg)

 <div align="center">
![Imagem teste](imagens/fig4.jpg)
 
  <div align="center">
![Imagem teste](imagens/fig5.jpg)
 
 Assim como nas edições anteriores do Relatório de Performance do SISCEAB, a análise comparativa entre as Organizações Regionais do DECEA inclui o Centro Regional de Controle do Espaço Aéreo do Sudeste (CRCEA-SE), destacando seu elevado número de movimentos nas áreas Terminais de São Paulo e do Rio de Janeiro. Cabe ressaltar, no entanto, que o CRCEA-SE gerencia porções de espaço aéreo que possuem caráter de área terminal (TMA), áreas significativamente menores que as Regiões de Informação de Voo sob jurisdição dos CINDACTA.
 
   <div align="center">
![Imagem teste](imagens/fig6.jpg)
 
    <div align="center">
![Imagem teste](imagens/fig7.jpg)
 


```{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown'
), 'packages.bib')
```

<!--chapter:end:index.Rmd-->




```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(lubridate)
library(dplyr)
library(readr)
library(patchwork) #pacote que soma os gráficos 
library(leaflet)#pacote para mapas dinamicos
library(geobr)#pacote para mapa simples
library(readxl)
library(sf)#pacote para mapa simples
library(rgdal) #pacote para API
library(httr) #pacote para API
library(jsonlite) #pacote para API
library(scales)
library(ggtext)
library(gridExtra)
library(Rcpp)# pacote usado para corrigir um erro
library(ggimage)#pacote para salvar os gráficos como imagem
library(flexdashboard)
library(ggrepel)
library(zoo)

```


```{r echo=FALSE, message=FALSE, warning=FALSE}
URL_BASE <- "http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area="

BDS_KPI_01 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_01")
BDS_KPI_01_TEXT <- content(BDS_KPI_01, "text")
BDS_KPI_01_JSON <- fromJSON(BDS_KPI_01_TEXT,flatten = TRUE)
BDS_KPI_01_DF <- as.data.frame(BDS_KPI_01_JSON) %>%
  select(movimentos.ano,movimentos.percentual_ano, movimentos.regiao,movimentos.aero,movimentos.jan:movimentos.dez) %>% 
  mutate(movimentos.percentual_ano=movimentos.percentual_ano, movimentos.jan=movimentos.jan,
         movimentos.fev=movimentos.fev, movimentos.mar=movimentos.mar,
         movimentos.abr=movimentos.abr, movimentos.mai=movimentos.mai,
         movimentos.jun=movimentos.jun, movimentos.jul=movimentos.jul,
         movimentos.ago=movimentos.ago, movimentos.set=movimentos.set,
         movimentos.out=movimentos.out, movimentos.nov=movimentos.nov,
         movimentos.dez=movimentos.dez)

#uma maneira mais fácil de modificar o nome das colunas é usando o colnames()

COL_NAMES_KPI01 <- c("ANO", "PONTUALIDADE_ANO","REGIONAL","AERO","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")

colnames(BDS_KPI_01_DF) <- COL_NAMES_KPI01

######################

BDS_KPI_01_REGIONAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_01&regional=s")
BDS_KPI_01_TEXT_REGIONAL <- content(BDS_KPI_01_REGIONAL, "text")
BDS_KPI_01_JSON_REGIONAL <- fromJSON(BDS_KPI_01_TEXT_REGIONAL,flatten = TRUE)
BDS_KPI_01_REGIONAL_DF <- as.data.frame(BDS_KPI_01_JSON_REGIONAL)







########

BDS_KPI_02 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_02")
BDS_KPI_02_TEXT <- content(BDS_KPI_02, "text")
BDS_KPI_02_JSON <- fromJSON(BDS_KPI_02_TEXT,flatten = TRUE)
BDS_KPI_02_DF <- as.data.frame(BDS_KPI_02_JSON)

########

BDS_KPI_02_REGIONAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_02&regional=s")
BDS_KPI_02_REGIONAL_TEXT <- content(BDS_KPI_02_REGIONAL, "text")
BDS_KPI_02_REGIONAL_JSON <- fromJSON(BDS_KPI_02_REGIONAL_TEXT,flatten = TRUE)
BDS_KPI_02_REGIONAL_DF <- as.data.frame(BDS_KPI_02_REGIONAL_JSON)


#########

BDS_KPI_06 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_06")
BDS_KPI_06_TEXT <- content(BDS_KPI_06, "text")
BDS_KPI_06_JSON <- fromJSON(BDS_KPI_06_TEXT,flatten = TRUE)
BDS_KPI_06_DF <- as.data.frame(BDS_KPI_06_JSON)

##########


BDS_IDBR_06_TWR <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=IDBR_06&regional=TWR")
BDS_IDBR_06_TWR_TEXT <- content(BDS_IDBR_06_TWR, "text")
BDS_IDBR_06_TWR_JSON <- fromJSON(BDS_IDBR_06_TWR_TEXT,flatten = TRUE)
BDS_IDBR_06_TWR_DF <- as.data.frame(BDS_IDBR_06_TWR_JSON)

############

BDS_IDBR_06_APP <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=IDBR_06&regional=APP")
BDS_IDBR_06_APP_TEXT <- content(BDS_IDBR_06_APP, "text")
BDS_IDBR_06_APP_JSON <- fromJSON(BDS_IDBR_06_APP_TEXT,flatten = TRUE)
BDS_IDBR_06_APP_DF <- as.data.frame(BDS_IDBR_06_APP_JSON)

############

BDS_IDBR_06_ACC <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=IDBR_06&regional=ACC")
BDS_IDBR_06_ACC_TEXT <- content(BDS_IDBR_06_ACC, "text")
BDS_IDBR_06_ACC_JSON <- fromJSON(BDS_IDBR_06_ACC_TEXT,flatten = TRUE)
BDS_IDBR_06_ACC_DF <- as.data.frame(BDS_IDBR_06_ACC_JSON)

BDS_IDBR_06_ACC_DF <- BDS_IDBR_06_ACC_DF %>% mutate(ACC = case_when(movimentos.aero == "BRASIL" ~ "SISCEAB",
                         movimentos.aero == "SBBS" ~ "ACC Brasília",
                         movimentos.aero == "SBCW" ~ "ACC Curitiba",
                         movimentos.aero == "SBRE" ~ "ACC Recife",
                         movimentos.aero == "SBAZ" ~ "ACC Amazônico",
                         movimentos.aero == "SBAO" ~ "ACC Atlântico"))

##########







BDS_KPI_08_C40 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_08_C40")
BDS_KPI_08_C40_TEXT <- content(BDS_KPI_08_C40, "text")
BDS_KPI_08_C40_JSON <- fromJSON(BDS_KPI_08_C40_TEXT,flatten = TRUE)
BDS_KPI_08_C40_DF <- as.data.frame(BDS_KPI_08_C40_JSON)%>%
  select(movimentos.ano,movimentos.percentual_ano, movimentos.regiao,movimentos.aero,movimentos.jan:movimentos.dez)

COL_NAMES_KPI08_c40 <- c("ANO", "PONTUALIDADE_ANO","REGIONAL","AERO","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")

colnames(BDS_KPI_08_C40_DF) <- COL_NAMES_KPI08_c40

##########

BDS_KPI_08_C100 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_08_C100")
BDS_KPI_08_C100_TEXT <- content(BDS_KPI_08_C100, "text")
BDS_KPI_08_C100_JSON <- fromJSON(BDS_KPI_08_C100_TEXT,flatten = TRUE)
BDS_KPI_08_C100_DF <- as.data.frame(BDS_KPI_08_C100_JSON)%>%
  select(movimentos.ano,movimentos.percentual_ano, movimentos.regiao,movimentos.aero,movimentos.jan:movimentos.dez)

COL_NAMES_KPI08_c100 <- c("ANO", "PONTUALIDADE_ANO","REGIONAL","AERO","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")

colnames(BDS_KPI_08_C100_DF) <- COL_NAMES_KPI08_c100

##########
#UNIÃO DO KPI08 C40COM C100

#bind_cols() é usado para unir colunas de df diferentes

BDS_KPI08_C40_C100 <- bind_cols(BDS_KPI_08_C40_DF$ANO,
                                BDS_KPI_08_C40_DF$REGIONAL,
                                BDS_KPI_08_C40_DF$AERO,
                                BDS_KPI_08_C40_DF$PONTUALIDADE_ANO,
                                BDS_KPI_08_C100_DF$PONTUALIDADE_ANO)

COL_NAMES_KPI08_c40_c100 <- c("ANO","REGIONAL","AERO", "PONTUALIDADE_ANO_C40",
                              "PONTUALIDADE_ANO_C100")

colnames(BDS_KPI08_C40_C100) <- COL_NAMES_KPI08_c40_c100
#########################################################
#BDS KPI 08 POR REGIONAL

BDS_KPI_08_C40_REGIONAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_08_C40&regional=s")
BDS_KPI_08_C40_REGIONAL_TEXT <- content(BDS_KPI_08_C40_REGIONAL, "text")
BDS_KPI_08_C40_REGIONAL_JSON <- fromJSON(BDS_KPI_08_C40_REGIONAL_TEXT,flatten = TRUE)
BDS_KPI_08_C40_REGIONAL_DF <- as.data.frame(BDS_KPI_08_C40_REGIONAL_JSON)%>%
  select(movimentos.ano,movimentos.percentual_ano, movimentos.regiao,movimentos.aero,movimentos.jan:movimentos.dez)

COL_NAMES_KPI08_c40_REGIONAL <- c("ANO", "PONTUALIDADE_ANO","REGIONAL","AERO","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")

colnames(BDS_KPI_08_C40_REGIONAL_DF) <- COL_NAMES_KPI08_c40_REGIONAL
################
BDS_KPI_08_C100_REGIONAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_08_C100&regional=s")
BDS_KPI_08_C100_REGIONAL_TEXT <- content(BDS_KPI_08_C100_REGIONAL, "text")
BDS_KPI_08_C100_REGIONAL_JSON <- fromJSON(BDS_KPI_08_C100_REGIONAL_TEXT,flatten = TRUE)
BDS_KPI_08_C100_REGIONAL_DF <- as.data.frame(BDS_KPI_08_C100_REGIONAL_JSON)%>%
  select(movimentos.ano,movimentos.percentual_ano, movimentos.regiao,movimentos.aero,movimentos.jan:movimentos.dez)

COL_NAMES_KPI08_c100_REGIONAL <- c("ANO", "PONTUALIDADE_ANO","REGIONAL","AERO","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")

colnames(BDS_KPI_08_C100_REGIONAL_DF) <- COL_NAMES_KPI08_c100_REGIONAL
#########################
#unindo o KPI 08 por REGIONAL

BDS_KPI08_C40_C100_REGIONAL <- bind_cols(BDS_KPI_08_C40_REGIONAL_DF$ANO,
                                BDS_KPI_08_C40_REGIONAL_DF$REGIONAL,
                                BDS_KPI_08_C40_REGIONAL_DF$AERO,
                                BDS_KPI_08_C40_REGIONAL_DF$PONTUALIDADE_ANO,
                                BDS_KPI_08_C100_REGIONAL_DF$PONTUALIDADE_ANO)

COL_NAMES_KPI08_c40_c100_REGIONAL <- c("ANO","REGIONAL","AERO", "PONTUALIDADE_ANO_C40",
                              "PONTUALIDADE_ANO_C100")

colnames(BDS_KPI08_C40_C100_REGIONAL) <- COL_NAMES_KPI08_c40_c100_REGIONAL
BDS_KPI08_C40_C100_REGIONAL<- BDS_KPI08_C40_C100_REGIONAL %>% pivot_longer(cols = PONTUALIDADE_ANO_C40:PONTUALIDADE_ANO_C100,
                                             names_to = "C40_100",
                                             values_to = "ADICIONAL")



#BDS_KPI08_C40_C100_REGIONAL %>% mutate("40"="40", "100"="100") %>% 
#  unite()



#########################################################
#foi necessário criar uma BDS mensal para o KPI 08


#algumas vezes é necessário usar O pivot_longer() para transpor colunas em linhas

BDS_KPI_08_C40_MES <- BDS_KPI_08_C40_DF %>% 
  pivot_longer(cols = JAN:DEZ,
               names_to = "MES",
               values_to = "ADICIONAL") %>% 
  mutate("XXX"= "40") %>% 
  unite("AERO", c("AERO","XXX"))

BDS_KPI_08_C100_MES <- BDS_KPI_08_C100_DF %>% 
  pivot_longer(cols = JAN:DEZ,
               names_to = "MES",
               values_to = "ADICIONAL")%>% 
  mutate("XXX"= "100") %>% 
  unite("AERO", c("AERO","XXX"))


BDS_KPI_08_MES <- bind_rows(BDS_KPI_08_C40_MES,BDS_KPI_08_C100_MES)









##########

BDS_KPI_09 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_09")
BDS_KPI_09_TEXT <- content(BDS_KPI_09, "text")
BDS_KPI_09_JSON <- fromJSON(BDS_KPI_09_TEXT,flatten = TRUE)
BDS_KPI_09_DF <- as.data.frame(BDS_KPI_09_JSON)

##########

BDS_KPI_10 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_10")
BDS_KPI_10_TEXT <- content(BDS_KPI_10, "text")
BDS_KPI_10_JSON <- fromJSON(BDS_KPI_10_TEXT,flatten = TRUE)
BDS_KPI_10_DF <- as.data.frame(BDS_KPI_10_JSON)

##########

BDS_KPI_11 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_11")
BDS_KPI_11_TEXT <- content(BDS_KPI_11, "text")
BDS_KPI_11_JSON <- fromJSON(BDS_KPI_11_TEXT,flatten = TRUE)
BDS_KPI_11_DF <- as.data.frame(BDS_KPI_11_JSON)

##########

BDS_KPI_13 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_13")
BDS_KPI_13_TEXT <- content(BDS_KPI_13, "text")
BDS_KPI_13_JSON <- fromJSON(BDS_KPI_13_TEXT,flatten = TRUE)
BDS_KPI_13_DF <- as.data.frame(BDS_KPI_13_JSON)

##########
BDS_KPI_13_REGIONAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_13&regional=s")
BDS_KPI_13_REGIONAL_TEXT <- content(BDS_KPI_13_REGIONAL, "text")
BDS_KPI_13_REGIONAL_JSON <- fromJSON(BDS_KPI_13_REGIONAL_TEXT,flatten = TRUE)
BDS_KPI_13_REGIONAL_DF <- as.data.frame(BDS_KPI_13_REGIONAL_JSON)

##########

BDS_KPI_14 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_14")
BDS_KPI_14_TEXT <- content(BDS_KPI_14, "text")
BDS_KPI_14_JSON <- fromJSON(BDS_KPI_14_TEXT,flatten = TRUE)
BDS_KPI_14_DF <- as.data.frame(BDS_KPI_14_JSON)%>%
  select(movimentos.ano,movimentos.percentual_ano, movimentos.regiao,movimentos.aero,movimentos.jan:movimentos.dez) %>% 
  mutate(movimentos.percentual_ano=movimentos.percentual_ano, movimentos.jan=movimentos.jan,
         movimentos.fev=movimentos.fev, movimentos.mar=movimentos.mar,
         movimentos.abr=movimentos.abr, movimentos.mai=movimentos.mai,
         movimentos.jun=movimentos.jun, movimentos.jul=movimentos.jul,
         movimentos.ago=movimentos.ago, movimentos.set=movimentos.set,
         movimentos.out=movimentos.out, movimentos.nov=movimentos.nov,
         movimentos.dez=movimentos.dez)
COL_NAMES_KPI14 <- c("ANO", "PONTUALIDADE_ANO","REGIONAL","AERO","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")

colnames(BDS_KPI_14_DF) <- COL_NAMES_KPI14

#####
BDS_KPI_14_REGIONAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_14&regional=s")
BDS_KPI_14_TEXT_REGIONAL <- content(BDS_KPI_14_REGIONAL, "text")
BDS_KPI_14_JSON_REGIONAL <- fromJSON(BDS_KPI_14_TEXT_REGIONAL,flatten = TRUE)
BDS_KPI_14_REGIONAL_DF <- as.data.frame(BDS_KPI_14_JSON_REGIONAL)



####################

PONT_ARR_DEP <- bind_cols(BDS_KPI_14_DF$ANO,BDS_KPI_14_DF$AERO,BDS_KPI_14_DF$PONTUALIDADE_ANO,BDS_KPI_01_DF$PONTUALIDADE_ANO)
COL_NAMES_ARR_DEP <- c("ANO","AERO", "PONT.ARR","PONT.DEP")
colnames(PONT_ARR_DEP) <- COL_NAMES_ARR_DEP

PONT_ARR_DEP <- PONT_ARR_DEP %>% filter(ANO==2022)


##########

BDS_KPI_15 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_15")
BDS_KPI_15_TEXT <- content(BDS_KPI_15, "text")
BDS_KPI_15_JSON <- fromJSON(BDS_KPI_15_TEXT,flatten = TRUE)
BDS_KPI_15_DF <- as.data.frame(BDS_KPI_15_JSON)


#abaixo crio um df para poder fazer a variação entre o ano de 2022 e 2019

VAR15_2022 <- BDS_KPI_15_DF %>% filter(movimentos.ano=="2022") %>% filter(movimentos.total_movimentos>3500)#QUANDO NECESSÁRIO É SÓ SUBSTITUIR O "2000" PELO VALOR NECESSÁRIO
VAR15_2021 <- BDS_KPI_15_DF %>% filter(movimentos.ano=="2021") %>% filter(movimentos.fluxo%in%VAR15_2022$movimentos.fluxo)
VAR15 <- bind_cols(VAR15_2021,VAR15_2022$movimentos.percentual_ano_70,VAR15_2022$movimentos.total_movimentos) %>% 
  #FOI CRIADO O VAR15 PARA CRIAR O LABEL DE VARIAÇÃO 
  transmute(ROTA=movimentos.fluxo,VAR21=movimentos.percentual_ano_70,VAR22=...24,MOVIMENTOS.21=movimentos.total_movimentos, MOVIMENTOS.22=...25 ) %>% 
  mutate(VAR= (VAR22-VAR21)/VAR21, VAR.ANO=(MOVIMENTOS.22-MOVIMENTOS.21)/MOVIMENTOS.21)




##########

BDS_KPI_TOTAL_AZ <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Total&regional=SBAZ")
BDS_KPI_TOTAL_AZ_TEXT <- content(BDS_KPI_TOTAL_AZ, "text")
BDS_KPI_TOTAL_AZ_JSON <- fromJSON(BDS_KPI_TOTAL_AZ_TEXT,flatten = TRUE)
BDS_KPI_TOTAL_AZ_DF <- as.data.frame(BDS_KPI_TOTAL_AZ_JSON)

##########

BDS_KPI_TOTAL_AO <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Total&regional=SBAO")
BDS_KPI_TOTAL_AO_TEXT <- content(BDS_KPI_TOTAL_AO, "text")
BDS_KPI_TOTAL_AO_JSON <- fromJSON(BDS_KPI_TOTAL_AO_TEXT,flatten = TRUE)
BDS_KPI_TOTAL_AO_DF <- as.data.frame(BDS_KPI_TOTAL_AO_JSON)

##########

BDS_KPI_TOTAL_BS <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Total&regional=SBBS")
BDS_KPI_TOTAL_BS_TEXT <- content(BDS_KPI_TOTAL_BS, "text")
BDS_KPI_TOTAL_BS_JSON <- fromJSON(BDS_KPI_TOTAL_BS_TEXT,flatten = TRUE)
BDS_KPI_TOTAL_BS_DF <- as.data.frame(BDS_KPI_TOTAL_BS_JSON)

##########

BDS_KPI_TOTAL_CW <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Total&regional=SBCW")
BDS_KPI_TOTAL_CW_TEXT <- content(BDS_KPI_TOTAL_CW, "text")
BDS_KPI_TOTAL_CW_JSON <- fromJSON(BDS_KPI_TOTAL_CW_TEXT,flatten = TRUE)
BDS_KPI_TOTAL_CW_DF <- as.data.frame(BDS_KPI_TOTAL_CW_JSON)

##########

BDS_KPI_TOTAL_RE <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Total&regional=SBRE")
BDS_KPI_TOTAL_RE_TEXT <- content(BDS_KPI_TOTAL_RE, "text")
BDS_KPI_TOTAL_RE_JSON <- fromJSON(BDS_KPI_TOTAL_RE_TEXT,flatten = TRUE)
BDS_KPI_TOTAL_RE_DF <- as.data.frame(BDS_KPI_TOTAL_RE_JSON)

##########

BDS_KPI_TOTAL_Brasil <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Total&regional=Brasil")
BDS_KPI_TOTAL_Brasil_TEXT <- content(BDS_KPI_TOTAL_Brasil, "text")
BDS_KPI_TOTAL_Brasil_JSON <- fromJSON(BDS_KPI_TOTAL_Brasil_TEXT,flatten = TRUE)
BDS_KPI_TOTAL_Brasil_DF <- as.data.frame(BDS_KPI_TOTAL_Brasil_JSON)

##########

BDS_KPI_TOTAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Total")
BDS_KPI_TOTAL_TEXT <- content(BDS_KPI_TOTAL, "text")
BDS_KPI_TOTAL_JSON <- fromJSON(BDS_KPI_TOTAL_TEXT,flatten = TRUE)
BDS_KPI_TOTAL_DF <- as.data.frame(BDS_KPI_TOTAL_JSON)

#########

BDS_KPI_COMER <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Comercial")
BDS_KPI_COMER_TEXT <- content(BDS_KPI_COMER, "text")
BDS_KPI_COMER_JSON <- fromJSON(BDS_KPI_COMER_TEXT,flatten = TRUE)
BDS_KPI_COMER_DF <- as.data.frame(BDS_KPI_COMER_JSON)

##########

BDS_KPI_GERAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Geral")
BDS_KPI_GERAL_TEXT <- content(BDS_KPI_GERAL, "text")
BDS_KPI_GERAL_JSON <- fromJSON(BDS_KPI_GERAL_TEXT,flatten = TRUE)
BDS_KPI_GERAL_DF <- as.data.frame(BDS_KPI_GERAL_JSON)

#################
COL.NAMES.MOV <- c("ANO", "TOTAL","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")

MOV_GERAL <- BDS_KPI_GERAL_DF %>% select(movimentos.ano, movimentos.total,movimentos.jan:movimentos.dez) %>% 
  group_by(movimentos.ano) %>% summarise(movimentos.total = sum(movimentos.total),
                                         movimentos.jan = sum(movimentos.jan),
                                         movimentos.fev = sum(movimentos.fev),
                                         movimentos.mar = sum(movimentos.mar),
                                         movimentos.abr = sum(movimentos.abr),
                                         movimentos.mai = sum(movimentos.mai),
                                         movimenos.jun = sum(movimentos.jun),
                                         movimentos.jul = sum(movimentos.jul),
                                         movimentos.ago = sum(movimentos.ago),
                                         movimentoss.set = sum(movimentos.set),
                                         movimentos.out = sum(movimentos.out),
                                         movimentos.nov = sum(movimentos.nov),
                                         movimentos.dez = sum(movimentos.dez)) %>% 
  `colnames<-`(COL.NAMES.MOV) %>% pivot_longer(cols = JAN:DEZ,
                                               names_to = "MES",
                                               values_to = "MOV") %>% 
  mutate(ANO=as.factor(ANO),MES= factor(MES, levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ")))


###########

BDS_KPI_MIL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Militar")
BDS_KPI_MIL_TEXT <- content(BDS_KPI_MIL, "text")
BDS_KPI_MIL_JSON <- fromJSON(BDS_KPI_MIL_TEXT,flatten = TRUE)
BDS_KPI_MIL_DF <- as.data.frame(BDS_KPI_MIL_JSON)


#########

BDS_KPI_MEDIA <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Media")
BDS_KPI_MEDIA_TEXT <- content(BDS_KPI_MEDIA, "text")
BDS_KPI_MEDIA_JSON <- fromJSON(BDS_KPI_MEDIA_TEXT,flatten = TRUE)
BDS_KPI_MEDIA_DF <- as.data.frame(BDS_KPI_MEDIA_JSON)

######### 
#BDS PARA MOVIMENTOS DA AVIAÇÃO COMERCIAL DOMÉSTICA (01)

BDS_KPI_COMERCIAL_NAC <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Comercial-Nac")
BDS_KPI_COMERCIAL_NAC_TEXT <- content(BDS_KPI_COMERCIAL_NAC, "text")
BDS_KPI_COMERCIAL_NAC_JSON <- fromJSON(BDS_KPI_COMERCIAL_NAC_TEXT,flatten = TRUE)
BDS_KPI_COMERCIAL_NAC_DF <- as.data.frame(BDS_KPI_COMERCIAL_NAC_JSON) %>% 
  select(movimentos.ano, movimentos.total,movimentos.jan:movimentos.dez)
COL.NAMES.MOV <- c("ANO", "TOTAL","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")
colnames(BDS_KPI_COMERCIAL_NAC_DF) <- COL.NAMES.MOV

#AJUSTES NA BDS PARA CRIAR O GRÁFICO PARA O ANO DE 2022
MOV_COM_DOMESTC <- BDS_KPI_COMERCIAL_NAC_DF %>% 
  pivot_longer(cols = JAN:DEZ,
               names_to = "MES",
               values_to = "MOV") %>% 
  mutate(MES=factor(MES,levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ")), ANO=as.character(ANO)) 
MOV_COM_DOMESTC_2019 <- MOV_COM_DOMESTC %>% filter(ANO=="2019")
MOV_COM_DOMESTC_2022 <- MOV_COM_DOMESTC %>% filter(ANO=="2022")
MOV_COM_DOM <- bind_cols(MOV_COM_DOMESTC_2019,MOV_COM_DOMESTC_2022$MOV) %>% #FOI CRIADO O MOV_COM_DOM PARA CRIAR O LABEL DE VARIAÇÃO 
  transmute(ANO=ANO,TOTAL=TOTAL,MES=MES,MOV19=MOV,MOV22=...5) %>% mutate(VAR= (MOV22-MOV19)/MOV19)






#########
#BDS PARA MOVIMENTOS DA AVIAÇÃO COMERCIAL INTERNACIONAL (02)

BDS_KPI_COMERCIAL_INT <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Comercial-Int")
BDS_KPI_COMERCIAL_INT_TEXT <- content(BDS_KPI_COMERCIAL_INT, "text")
BDS_KPI_COMERCIAL_INT_JSON <- fromJSON(BDS_KPI_COMERCIAL_INT_TEXT,flatten = TRUE)
BDS_KPI_COMERCIAL_INT_DF <- as.data.frame(BDS_KPI_COMERCIAL_INT_JSON)%>% 
  select(movimentos.ano, movimentos.total,movimentos.jan:movimentos.dez)
COL.NAMES.MOV <- c("ANO", "TOTAL","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")
colnames(BDS_KPI_COMERCIAL_INT_DF) <- COL.NAMES.MOV

#AJUSTES NA BDS PARA CRIAR O GRÁFICO PARA O ANO DE 2022
MOV_COM_INT <- BDS_KPI_COMERCIAL_INT_DF %>%
  pivot_longer(cols = JAN:DEZ,
               names_to = "MES",
               values_to = "MOV") %>% 
  mutate(MES=factor(MES,levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ")), ANO=as.character(ANO))
MOV_COM_INT_2019 <- MOV_COM_INT %>% filter(ANO=="2019")
MOV_COM_INT_2022 <- MOV_COM_INT %>% filter(ANO=="2022")
MOV_COM_INT_VAR <- bind_cols(MOV_COM_INT_2019,MOV_COM_INT_2022$MOV) %>% 
  transmute(ANO=ANO,TOTAL=TOTAL,MES=MES,MOV19=MOV,MOV22=...5) %>% mutate(VAR= (MOV22-MOV19)/MOV19)




#########

BDS_KPI_IDBR_06 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=IDBR_06")
BDS_KPI_IDBR_06_TEXT <- content(BDS_KPI_IDBR_06, "text")
BDS_KPI_IDBR_06_JSON <- fromJSON(BDS_KPI_IDBR_06_TEXT,flatten = TRUE)
BDS_KPI_IDBR_06_DF <- as.data.frame(BDS_KPI_IDBR_06_JSON)

#########

BDS_KPI_MIN_ATRASO <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=MIN_ATRASO")
BDS_KPI_MIN_ATRASO_TEXT <- content(BDS_KPI_MIN_ATRASO, "text")
BDS_KPI_MIN_ATRASO_JSON <- fromJSON(BDS_KPI_MIN_ATRASO_TEXT,flatten = TRUE)
BDS_KPI_MIN_ATRASO_DF <- as.data.frame(BDS_KPI_MIN_ATRASO_JSON)

#########

BDS_KPI_DENSIDADE <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=DENSIDADE")
BDS_KPI_DENSIDADE_TEXT <- content(BDS_KPI_DENSIDADE, "text")
BDS_KPI_DENSIDADE_JSON <- fromJSON(BDS_KPI_DENSIDADE_TEXT,flatten = TRUE)
BDS_KPI_DENSIDADE_DF <- as.data.frame(BDS_KPI_DENSIDADE_JSON)


#####################################################################################################################################################

#criação do conjunto de cores para os gráficos

cores <- c("#B0C4DE",
           "#708090",
           "#4682B4",
           "#191970")

#######################################
#UNIÃO DAS BDS TOTAL(POR FIR) PARA CIAÇÃO DO GRÁFICO "TOTAL DE MOVIMENTOS SISCEAB E POR FIR" (03)


TOTAL_MOV_SISC_FIR <- bind_rows(BDS_KPI_TOTAL_Brasil_DF, 
                                BDS_KPI_TOTAL_BS_DF, 
                                BDS_KPI_TOTAL_CW_DF, 
                                BDS_KPI_TOTAL_RE_DF, 
                                BDS_KPI_TOTAL_AZ_DF, 
                                BDS_KPI_TOTAL_AO_DF) %>% 
  select(movimentos.fir, movimentos.ano, movimentos.total) %>%
  filter(movimentos.ano!='2018')

#MUDANDO O NOME DAS COLUNAS
COL.NAMES.TOTAL <- c("FIR","ANO", "TOTAL") 
colnames(TOTAL_MOV_SISC_FIR) <- COL.NAMES.TOTAL

#AJUSTES NA BDS PARA CRIAR O GRÁFICO
#case_when() substitui o nome dos itens

TOTAL_MOV_SISC_FIR <- TOTAL_MOV_SISC_FIR %>%
mutate(FIR = case_when(FIR == "BRASIL" ~ "SISCEAB",
                         FIR == "SBBS" ~ "FIR Brasília",
                         FIR == "SBCW" ~ "FIR Curitiba",
                         FIR == "SBRE" ~ "FIR Recife",
                         FIR == "SBAZ" ~ "FIR Amazônica",
                         FIR == "SBAO" ~ "FIR Atlântico"), ANO=as.character(ANO)) %>%
  mutate(FIR= factor(FIR))


###
#BDS PARA MOVIMENTOS MENSAL POR FIR
#bind_rows()cola linhas de df diferentes
#transmute()cria ou modifica colunas e exclui as colunas que não foram usadas, diferente do mutate que mantem todas as #colunas

VAR_MES_FIR <- bind_rows(BDS_KPI_TOTAL_Brasil_DF, 
          BDS_KPI_TOTAL_BS_DF, 
          BDS_KPI_TOTAL_CW_DF, 
          BDS_KPI_TOTAL_RE_DF, 
          BDS_KPI_TOTAL_AZ_DF, 
          BDS_KPI_TOTAL_AO_DF) %>% 
  transmute(FIR=movimentos.fir,ANO=movimentos.ano,TOTAL=movimentos.total,
            JAN=movimentos.jan,
            FEV=movimentos.fev,
            MAR=movimentos.mar,
            ABR=movimentos.abr,
            MAI=movimentos.mai,
            JUN=movimentos.jun,
            JUL=movimentos.jul,
            AGO=movimentos.ago,
            SET=movimentos.set,
            OUT=movimentos.out,
            NOV=movimentos.nov,
            DEZ=movimentos.dez) %>% 
  pivot_longer(cols = JAN:DEZ,
               names_to = "MES",
               values_to = "MOV") %>% 
  mutate(MES=factor(MES,levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ"))) %>% 
  mutate(FIR = case_when(FIR == "BRASIL" ~ "SISCEAB",
                         FIR == "SBBS" ~ "FIR Brasília",
                         FIR == "SBCW" ~ "FIR Curitiba",
                         FIR == "SBRE" ~ "FIR Recife",
                         FIR == "SBAZ" ~ "FIR Amazônica",
                         FIR == "SBAO" ~ "FIR Atlântico"), ANO=as.character(ANO)) %>%
  mutate(FIR= factor(FIR, levels = c("FIR Brasília","FIR Curitiba","FIR Recife","FIR Amazônica","FIR Atlântico","SISCEAB")))
  

#########################################

#BDS PARA CRIAÇÃO DO GRÁFICO DE MOVIMENTOS DO ANO POR MES SISCEAB (04)


TOTAL_MOV_MES_SISCEAB <- BDS_KPI_TOTAL_Brasil_DF %>%
  select(movimentos.ano,movimentos.total:movimentos.dez) %>% 
  filter(movimentos.ano!='2018')
colnames(TOTAL_MOV_MES_SISCEAB) <- COL.NAMES.MOV

#AJUSTES NA BDS PARA CRIAR O GRÁFICO
TOTAL_MES_SISCEAB <- TOTAL_MOV_MES_SISCEAB %>%
  pivot_longer(cols = JAN:DEZ,
               names_to = "MES",
               values_to = "MOV") %>% 
  mutate(MES=factor(MES,levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ")), ANO=as.character(ANO))



#########################################
# BDS PARA CRIAÇÃO DO GRÁFICO DE DENSIDADE DO TRÁFEGO POR REGIONAL(05)

BDS_DENSIDADE <- BDS_KPI_DENSIDADE_DF %>% 
  filter(movimentos.ano == "2022") %>% 
  separate(movimentos.chave, into = c("FIR","CHAVE"), sep = "-") %>% 
  select(FIR, movimentos.ano,movimentos.percentual_ano, movimentos.jan:movimentos.dez) %>% 
  mutate(FIR = case_when(FIR == "BRASIL" ~ "SISCEAB",
                         FIR == "SBBS" ~ "CINDACTA I",
                         FIR == "SBCW" ~ "CINDACTA II",
                         FIR == "SBRE" ~ "CINDACTA III",
                         FIR == "SBAZ" ~ "CINDACTA IV",
                         FIR == "SBAO" ~ "FIR Atlântico",
                         FIR == "CRCEA" ~ "CRCEA-SE"))

COL.NAMES.DENSI <- c("FIR","ANO", "PERCENT.ANO","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")
colnames(BDS_DENSIDADE) <- COL.NAMES.DENSI

DENSIDADE_C1 <- BDS_DENSIDADE[5,3]
DENSIDADE_C2 <- BDS_DENSIDADE[6,3]
DENSIDADE_C3 <- BDS_DENSIDADE[7,3]
DENSIDADE_C4 <- BDS_DENSIDADE[4,3]
DENSIDADE_SISCEAB <- BDS_DENSIDADE[1,3]
DENSIDADE_CRCEA <- BDS_DENSIDADE[2,3]
DENSIDADE_AO <- BDS_DENSIDADE[3,3]

##########################################
#LAT LONG DOS MAPAS



VERTICES_SETORES_FIR_SET22 <- read_csv("data/VERTICES_RESTANTES.csv")




VERTICES_SBCW <- read_excel("data/VERTICES_SBCW.xlsx") %>% 
  mutate(REGIONAL= "CINDACTA II", DENSIDADE= DENSIDADE_C2)

VERTICES_SBAZ <- read_excel("data/VERTICES_SBAZ.xlsx") %>% 
  mutate(REGIONAL= "CINDACTA IV", DENSIDADE=DENSIDADE_C4)

VERTICES_SBBS <- read_excel("data/VERTICES_SBBS.xlsx") %>% 
  mutate(REGIONAL="CINDACTA I", DENSIDADE=DENSIDADE_C1)

VERTICES_CRCEA_SE <- read_excel("data/VERTICES_CRCEA_SE.xlsx") %>% 
  mutate(REGIONAL="CRCEA-SE", DENSIDADE=DENSIDADE_CRCEA)

VERTICES_SBRE <- read_excel("data/VERTICES_SBRE.xlsx") %>% 
  mutate(REGIONAL="CINDACTA III", DENSIDADE=DENSIDADE_C3)


VERTICES_SBAO_S1 <-read_csv("data/SBAO_S1.csv")
VERTICES_SBAO_S2 <-read_csv("data/SBAO_S2.csv")
VERTICES_SBAO_S3 <-read_csv("data/SBAO_S3.csv")

VERTICES_SBAO <- bind_rows(VERTICES_SBAO_S1,VERTICES_SBAO_S2,VERTICES_SBAO_S3)




# JURISDICAO <- bind_rows(VERTICES_SETORES_FIR_SET22,VERTICES_SBAO)


 JURISDICAO <- bind_rows(VERTICES_SBAZ,VERTICES_SBBS,VERTICES_SBCW,VERTICES_SBRE)


TEXTOJURISDIÇÃO <- data.frame(X=c(-16.34,-27.29,-9.23,-5.54,-20), Y=c(-49.14,-51.41,-39.29,-59.52,-70), 
                              VALOR=c(DENSIDADE_C1,DENSIDADE_C2,DENSIDADE_C3,DENSIDADE_C4, DENSIDADE_SISCEAB))#DF criado para gerar a legenda
TEXTOJURISDIÇÃOCRCEA <- data.frame(X=c(-25), Y=c(-35), VALOR=c(DENSIDADE_CRCEA))
LINHATEXTOJURISDIÇÃOCRCEA <- data.frame(x1=-35, x2= -45.45, y1=-25, y2= -23.33)  
CORESJURISDICAO <- c("#FFD700","#007FFF","#CC0000","#215E21","#4F2F4F","#E6E8FA") #cores do mapa

#############
#BDS PARA PONTUALIDADE

PBWG_BRA_punctuality_ADR3 <- read_csv("data/PBWG-BRA-punctuality_ADR3.csv")


  BDS_PONTUALIDADE_ARR <- PBWG_BRA_punctuality_ADR3 %>% 
    filter(PHASE =="ARR") %>% 
    separate(DATE,into =c("ANO", "M"), sep = "-") %>%
    group_by(APT_GROUP,APT_ICAO, ANO, PHASE) %>% 
     summarise(`(-1e+09.-60]`=sum(`(-1e+09.-60]`),
               `(-60.-55]`=sum(`(-60.-55]`),
               `(-55.-50]`=sum(`(-55.-50]`),
               `(-50.-45]`=sum(`(-50.-45]`),
               `(-45.-40]`=sum(`(-45.-40]`),
               `(-40.-35]`=sum(`(-40.-35]`),
               `(-35.-30]`=sum(`(-35.-30]`),
               `(-30.-25]`=sum(`(-30.-25]`),
               `(-25.-20]`=sum(`(-25.-20]`),
               `(-20.-15]`=sum(`(-20.-15]`),
               `(-15.-10]`=sum(`(-15.-10]`),
               `(-10.-5]`=sum(`(-10.-5]`),
               `(-5.0]`=sum(`(-5.0]`),
               `(0.5]`=sum(`(0.5]`),
               `(5.10]`=sum(`(5.10]`),
               `(10.15]`=sum(`(10.15]`),
               `(15.20]`=sum(`(15.20]`),
               `(20.25]`=sum(`(20.25]`),
               `(25.30]`=sum(`(25.30]`),
               `(30.35]`=sum(`(30.35]`),
               `(35.40]`=sum(`(35.40]`),
               `(40.45]`=sum(`(40.45]`),
               `(45.50]`=sum(`(45.50]`),
               `(50.55]`=sum(`(50.55]`),
               `(55.60]`=sum(`(55.60]`),
               `(60.1e+09]`=sum(`(60.1e+09]`),
               EARLY_M15M05=sum(EARLY_M15M05),
               EARLY_M05M00=sum(EARLY_M05M00), 
               LATE_P00P05=sum(LATE_P00P05),
               LATE_P05P15=sum(LATE_P05P15),
               WITHIN_M05P05=sum(WITHIN_M05P05),
               WITHIN_M15P15=sum(WITHIN_M15P15)) %>% 
    mutate(SOMA=`(-1e+09.-60]`+ `(-60.-55]`+
        `(-55.-50]`+ `(-50.-45]`+
        `(-45.-40]`+ `(-40.-35]`+
        `(-35.-30]`+ `(-30.-25]`+
        `(-25.-20]`+ `(-20.-15]`+
        `(-15.-10]`+`(-10.-5]`+
        `(-5.0]`+`(0.5]`+
        `(5.10]`+`(10.15]`+
        `(15.20]`+ `(20.25]`+
        `(25.30]`+ `(30.35]`+
        `(35.40]`+ `(40.45]`+
        `(45.50]`+ `(50.55]`+
        `(55.60]`+ `(60.1e+09]`,
      EARLY=(`(-1e+09.-60]`+ `(-60.-55]`+
           `(-55.-50]`+ `(-50.-45]`+
           `(-45.-40]`+ `(-40.-35]`+
           `(-35.-30]`+ `(-30.-25]`+
           `(-25.-20]`+ `(-20.-15]`)/SOMA,
           EARLY_15_5=(`(-15.-10]`+`(-10.-5]`)/SOMA,
           WITHIN_5=(`(-5.0]`+`(0.5]`)/SOMA,
           LATE_5_15=(`(5.10]`+`(10.15]`)/SOMA,
           LATE=(`(15.20]`+ `(20.25]`+
           `(25.30]`+ `(30.35]`+
           `(35.40]`+ `(40.45]`+
           `(45.50]`+ `(50.55]`+
           `(55.60]`+ `(60.1e+09]`)/SOMA)%>% 
    pivot_longer(cols = EARLY:LATE
                        , names_to = "SLOT"
                        , values_to = "FLIGHTS") %>% 
    mutate(SLOT= case_when(SLOT=="EARLY"~"Adiantado > 15 min",
                           SLOT=="EARLY_15_5"~"Adiantado de -15 min a -5 min",
                           SLOT=="WITHIN_5"~"Pontual de -5 min a +5 min",
                           SLOT=="LATE_5_15"~"Atrasado de +5 min a +15 min",
                           SLOT=="LATE"~"Atrasado > 15 min")) %>% 
mutate(SLOT=factor(SLOT, levels = c("Adiantado > 15 min",
                                    "Adiantado de -15 min a -5 min",
                                    "Pontual de -5 min a +5 min",
                                    "Atrasado de +5 min a +15 min",
                                    "Atrasado > 15 min")))%>%
    mutate(APT_ICAO=factor(APT_ICAO, levels = c("SBBR","SBCF","SBCG","SBCT","SBFI","SBFL","SBPA",
                                      "SBFZ","SBMO","SBPS","SBRF","SBSV","SBBE","SBCY","SBEG",
                                      "SBGL","SBGR","SBKP","SBRJ","SBSP")))
  
  #conjunto de cores para o gráfico de pontualidade
  
CORESPONT <- c("#1E90FF","#87CEFA","#FFDAB9","#FF8C00","#FF0000")
  
######
  
  BDS_PONTUALIDADE_DEP <- PBWG_BRA_punctuality_ADR3 %>% 
  filter(PHASE =="DEP") %>% 
  separate(DATE,into =c("ANO", "M"), sep = "-") %>%
  group_by(APT_GROUP,APT_ICAO, ANO, PHASE) %>% 
  summarise(`(-1e+09.-60]`=sum(`(-1e+09.-60]`),
            `(-60.-55]`=sum(`(-60.-55]`),
            `(-55.-50]`=sum(`(-55.-50]`),
            `(-50.-45]`=sum(`(-50.-45]`),
            `(-45.-40]`=sum(`(-45.-40]`),
            `(-40.-35]`=sum(`(-40.-35]`),
            `(-35.-30]`=sum(`(-35.-30]`),
            `(-30.-25]`=sum(`(-30.-25]`),
            `(-25.-20]`=sum(`(-25.-20]`),
            `(-20.-15]`=sum(`(-20.-15]`),
            `(-15.-10]`=sum(`(-15.-10]`),
            `(-10.-5]`=sum(`(-10.-5]`),
            `(-5.0]`=sum(`(-5.0]`),
            `(0.5]`=sum(`(0.5]`),
            `(5.10]`=sum(`(5.10]`),
            `(10.15]`=sum(`(10.15]`),
            `(15.20]`=sum(`(15.20]`),
            `(20.25]`=sum(`(20.25]`),
            `(25.30]`=sum(`(25.30]`),
            `(30.35]`=sum(`(30.35]`),
            `(35.40]`=sum(`(35.40]`),
            `(40.45]`=sum(`(40.45]`),
            `(45.50]`=sum(`(45.50]`),
            `(50.55]`=sum(`(50.55]`),
            `(55.60]`=sum(`(55.60]`),
            `(60.1e+09]`=sum(`(60.1e+09]`),
            EARLY_M15M05=sum(EARLY_M15M05),
            EARLY_M05M00=sum(EARLY_M05M00), 
            LATE_P00P05=sum(LATE_P00P05),
            LATE_P05P15=sum(LATE_P05P15),
            WITHIN_M05P05=sum(WITHIN_M05P05),
            WITHIN_M15P15=sum(WITHIN_M15P15)) %>% 
  mutate(SOMA=`(-1e+09.-60]`+ `(-60.-55]`+
           `(-55.-50]`+ `(-50.-45]`+
           `(-45.-40]`+ `(-40.-35]`+
           `(-35.-30]`+ `(-30.-25]`+
           `(-25.-20]`+ `(-20.-15]`+
           `(-15.-10]`+`(-10.-5]`+
           `(-5.0]`+`(0.5]`+
           `(5.10]`+`(10.15]`+
           `(15.20]`+ `(20.25]`+
           `(25.30]`+ `(30.35]`+
           `(35.40]`+ `(40.45]`+
           `(45.50]`+ `(50.55]`+
           `(55.60]`+ `(60.1e+09]`,
         EARLY=(`(-1e+09.-60]`+ `(-60.-55]`+
                  `(-55.-50]`+ `(-50.-45]`+
                  `(-45.-40]`+ `(-40.-35]`+
                  `(-35.-30]`+ `(-30.-25]`+
                  `(-25.-20]`+ `(-20.-15]`)/SOMA,
         EARLY_15_5=(`(-15.-10]`+`(-10.-5]`)/SOMA,
         WITHIN_5=(`(-5.0]`+`(0.5]`)/SOMA,
         LATE_5_15=(`(5.10]`+`(10.15]`)/SOMA,
         LATE=(`(15.20]`+ `(20.25]`+
                 `(25.30]`+ `(30.35]`+
                 `(35.40]`+ `(40.45]`+
                 `(45.50]`+ `(50.55]`+
                 `(55.60]`+ `(60.1e+09]`)/SOMA)%>% 
  pivot_longer(cols = EARLY:LATE
               , names_to = "SLOT"
               , values_to = "FLIGHTS") %>% 
  mutate(SLOT= case_when(SLOT=="EARLY"~"Adiantado > 15 min",
                           SLOT=="EARLY_15_5"~"Adiantado de -15 min a -5 min",
                           SLOT=="WITHIN_5"~"Pontual de -5 min a +5 min",
                           SLOT=="LATE_5_15"~"Atrasado de +5 min a +15 min",
                           SLOT=="LATE"~"Atrasado > 15 min")) %>% 
mutate(SLOT=factor(SLOT, levels = c("Adiantado > 15 min",
                                    "Adiantado de -15 min a -5 min",
                                    "Pontual de -5 min a +5 min",
                                    "Atrasado de +5 min a +15 min",
                                    "Atrasado > 15 min")))%>%
  mutate(APT_ICAO=factor(APT_ICAO, levels = c("SBBR","SBCF","SBCG","SBCT","SBFI","SBFL","SBPA",
                                      "SBFZ","SBMO","SBPS","SBRF","SBSV","SBBE","SBCY","SBEG",
                                      "SBGL","SBGR","SBKP","SBRJ","SBSP")))




###########
#BDS ATCO

EVOLUCAO_ATCO <- read_excel("data/EVOLUCAO_ATCO.xlsx") %>% 
  pivot_longer(cols=ATCO_OPERACIONAL:ATCO_NAO_OPERACIONAL,names_to = "OPERACIONALIDADE",values_to = "QTD")



#####################
# EPLIS

EPLIS <- read_excel("data/EPLIS.xlsx") %>% 
  mutate(PCT=QTD/sum(QTD))


BDS_KPI_TOTAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Total")
BDS_KPI_TOTAL_TEXT <- content(BDS_KPI_TOTAL, "text")
BDS_KPI_TOTAL_JSON <- fromJSON(BDS_KPI_TOTAL_TEXT,flatten = TRUE)
BDS_KPI_TOTAL_DF <- as.data.frame(BDS_KPI_TOTAL_JSON)


##########################################
BDS_KPI_COMER <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Comercial")
BDS_KPI_COMER_TEXT <- content(BDS_KPI_COMER, "text")
BDS_KPI_COMER_JSON <- fromJSON(BDS_KPI_COMER_TEXT,flatten = TRUE)
BDS_KPI_COMER_DF <- as.data.frame(BDS_KPI_COMER_JSON)
BDS.COMER <- BDS_KPI_COMER_DF %>% select(movimentos.ano, movimentos.aero: movimentos.dez) %>% 
  mutate(TIPO= "Comercial",REGIONAL = case_when(movimentos.aero=="SBBE"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBBI"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBBR"~"CINDACTA I",
                                                                                                                                      movimentos.aero=="SBCF"~"CINDACTA I",
                                                                                                                                      movimentos.aero=="SBCG"~"CINDACTA I",
                                                                                                                                      movimentos.aero=="SBCO"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBCT"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBCY"~"CINDACTA I",
                                                                                                                                      movimentos.aero=="SBEG"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBFI"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBFL"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBBE"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBFN"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBFZ"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBGL"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBGR"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBKP"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBME"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBMN"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBMO"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBMT"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBNT"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBPA"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBPS"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBSV"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBPV"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBRB"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBRF"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBRJ"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBSC"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBSJ"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBSL"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBSM"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBSP"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBYS"~"CINDACTA I"))


BDS_KPI_GERAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Geral")
BDS_KPI_GERAL_TEXT <- content(BDS_KPI_GERAL, "text")
BDS_KPI_GERAL_JSON <- fromJSON(BDS_KPI_GERAL_TEXT,flatten = TRUE)
BDS_KPI_GERAL_DF <- as.data.frame(BDS_KPI_GERAL_JSON)
BDS.GERAL <- BDS_KPI_GERAL_DF %>% select(movimentos.ano, movimentos.aero: movimentos.dez) %>% mutate(TIPO= "Geral",REGIONAL = case_when(movimentos.aero=="SBBE"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBBI"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBBR"~"CINDACTA I",
                                                                                                                                      movimentos.aero=="SBCF"~"CINDACTA I",
                                                                                                                                      movimentos.aero=="SBCG"~"CINDACTA I",
                                                                                                                                      movimentos.aero=="SBCO"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBCT"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBCY"~"CINDACTA I",
                                                                                                                                      movimentos.aero=="SBEG"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBFI"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBFL"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBBE"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBFN"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBFZ"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBGL"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBGR"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBKP"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBME"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBMN"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBMO"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBMT"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBNT"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBPA"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBPS"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBSV"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBPV"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBRB"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBRF"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBRJ"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBSC"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBSJ"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBSL"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBSM"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBSP"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBYS"~"CINDACTA I"))



BDS_KPI_MIL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Militar")
BDS_KPI_MIL_TEXT <- content(BDS_KPI_MIL, "text")
BDS_KPI_MIL_JSON <- fromJSON(BDS_KPI_MIL_TEXT,flatten = TRUE)
BDS_KPI_MIL_DF <- as.data.frame(BDS_KPI_MIL_JSON)
BDS.MIL <- BDS_KPI_MIL_DF %>% select(movimentos.ano, movimentos.aero: movimentos.dez) %>% mutate(TIPO= "Militar",REGIONAL = case_when(movimentos.aero=="SBBE"~"CINDACTA IV",
                                                                                                                      movimentos.aero=="SBBI"~"CINDACTA II",
                                                                                                                      movimentos.aero=="SBBR"~"CINDACTA I",
                                                                                                                      movimentos.aero=="SBCF"~"CINDACTA I",
                                                                                                                      movimentos.aero=="SBCG"~"CINDACTA I",
                                                                                                                      movimentos.aero=="SBCO"~"CINDACTA II",
                                                                                                                      movimentos.aero=="SBCT"~"CINDACTA II",
                                                                                                                      movimentos.aero=="SBCY"~"CINDACTA I",
                                                                                                                      movimentos.aero=="SBEG"~"CINDACTA IV",
                                                                                                                      movimentos.aero=="SBFI"~"CINDACTA II",
                                                                                                                      movimentos.aero=="SBFL"~"CINDACTA II",
                                                                                                                      movimentos.aero=="SBBE"~"CINDACTA IV",
                                                                                                                      movimentos.aero=="SBFN"~"CINDACTA III",
                                                                                                                      movimentos.aero=="SBFZ"~"CINDACTA III",
                                                                                                                      movimentos.aero=="SBGL"~"CRCEA-SE",
                                                                                                                      movimentos.aero=="SBGR"~"CRCEA-SE",
                                                                                                                      movimentos.aero=="SBKP"~"CRCEA-SE",
                                                                                                                      movimentos.aero=="SBME"~"CINDACTA II",
                                                                                                                      movimentos.aero=="SBMN"~"CINDACTA IV",
                                                                                                                      movimentos.aero=="SBMO"~"CINDACTA III",
                                                                                                                      movimentos.aero=="SBMT"~"CRCEA-SE",
                                                                                                                      movimentos.aero=="SBNT"~"CINDACTA III",
                                                                                                                      movimentos.aero=="SBPA"~"CINDACTA II",
                                                                                                                      movimentos.aero=="SBPS"~"CINDACTA III",
                                                                                                                      movimentos.aero=="SBSV"~"CINDACTA III",
                                                                                                                      movimentos.aero=="SBPV"~"CINDACTA IV",
                                                                                                                      movimentos.aero=="SBRB"~"CINDACTA IV",
                                                                                                                      movimentos.aero=="SBRF"~"CINDACTA III",
                                                                                                                      movimentos.aero=="SBRJ"~"CRCEA-SE",
                                                                                                                      movimentos.aero=="SBSC"~"CINDACTA II",
                                                                                                                      movimentos.aero=="SBSJ"~"CRCEA-SE",
                                                                                                                      movimentos.aero=="SBSL"~"CINDACTA III",
                                                                                                                      movimentos.aero=="SBSM"~"CINDACTA II",
                                                                                                                      movimentos.aero=="SBSP"~"CRCEA-SE",
                                                                                                                      movimentos.aero=="SBYS"~"CINDACTA I"))





PARTICIPACAO.AERO <- bind_rows(BDS.MIL, BDS.GERAL,BDS.COMER) %>% 
  group_by(movimentos.ano, REGIONAL, TIPO, movimentos.aero) %>% 
  summarise(TOTAL=sum(movimentos.total),
            JAN=sum(movimentos.jan),
            FEV=sum(movimentos.fev),
            MAR= sum(movimentos.mar),
            ABR=sum(movimentos.abr),
            MAI=sum(movimentos.mai),
            JUN=sum(movimentos.jun),
            JUL=sum(movimentos.jul),
            AGO=sum(movimentos.ago),
            SET=sum(movimentos.set),
            OUT=sum(movimentos.out),
            NOV=sum(movimentos.nov),
            DEZ=sum(movimentos.dez))

PARTICIPACAO.TOTAL <- bind_rows(BDS.MIL, BDS.GERAL,BDS.COMER) %>% 
  group_by(movimentos.ano, REGIONAL, TIPO) %>% 
  summarise(QTD=sum(movimentos.total),
            JAN=sum(movimentos.jan),
            FEV=sum(movimentos.fev),
            MAR= sum(movimentos.mar),
            ABR=sum(movimentos.abr),
            MAI=sum(movimentos.mai),
            JUN=sum(movimentos.jun),
            JUL=sum(movimentos.jul),
            AGO=sum(movimentos.ago),
            SET=sum(movimentos.set),
            OUT=sum(movimentos.out),
            NOV=sum(movimentos.nov),
            DEZ=sum(movimentos.dez)) %>% 
  select(movimentos.ano, REGIONAL,TIPO, QTD) %>% 
  mutate(TOTAL=sum(QTD)) %>% 
  mutate(PRC=round(QTD/TOTAL,digits = 2))

#####################################################

VERTICES_TMA_BRASIL <- read_excel("data/VERTICES_TMA_BRASIL.xlsx")

TMA_SBWA <- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWA")
TMA_SBWQ<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWQ")
TMA_SBWN<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWN")
TMA_SBWX<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWX")
TMA_SBXK<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXK")
TMA_SBWB<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWB")
TMA_SBXJ<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXJ")
TMA_SBXD<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXD")
TMA_SBWS<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWS")
TMA_SBXE<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXE")
TMA_SBWZ<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWZ")
TMA_SBXT<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXT")
TMA_SBWF<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWF")
TMA_SBXM<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXM")
TMA_SBXA<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXA")
TMA_SBXS<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXS")
TMA_SBWL<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWL")
TMA_SBWK<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWK")
TMA_SBWR<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWR")
TMA_SBXW<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXW")
TMA_SBXU<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXU")
TMA_SBWH<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWH")
TMA_SBXR<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXR")
TMA_SBWE<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWE")
TMA_SBWJ<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWJ")
TMA_SBXQ<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXQ")
TMA_SBWU<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWU")
TMA_SBXO<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXO")
TMA_SBXG<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXG")
TMA_SBXP<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXP")
TMA_SBWT<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWT")
TMA_SBXF<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXF")
TMA_SBWP<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWP")
TMA_SBWM<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWM")
TMA_SBXL<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXL")
TMA_SBWI<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWI")
TMA_SBXN<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXN")
TMA_SBWG<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWG")
TMA_SBWY<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWY")
TMA_SBWV<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWV")
TMA_SBXB<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXB")







ANO.RELATORIO <- year(Sys.Date())-1

```




































# Introdução

## Gestão por performance

A Organização de Aviação Civil Internacional (OACI) é uma agência especializada das Nações Unidas que tem por objetivo desenvolver princípios e técnicas para a navegação aérea internacional fomentando o planejamento e o desenvolvimento do transporte aéreo global, promovendo o desenvolvimento de todos os aspectos da indústria de aviação civil internacional.

A OACI enfatiza a importância de uma gestão baseada em performance e estimula Estados, Regiões e Organizações a se envolverem e participarem de atividades de análise comparativa de desempenho, divulgando seus resultados para fornecer à comunidade ATM internacional uma oportunidade de monitorar a sua evolução.

Ao promover uma gestão por performance, os Estados são orientados a utilizarem um conjunto de indicadores-chave de performance (KPI – Key Performance Indicators), que forneçam os meios de identificar deficiências e priorizar investimentos, além de compartilhar problemas de desempenho e melhores práticas em um nível regional e global, medindo e documentando os benefícios de desempenho produzidos pelas implementações de novas tecnologias e conceitos.

Desta forma, a gestão por performance permite que todas as partes envolvidas analisem a performance do sistema de navegação aérea corrente e futuro e tomem ações, caso necessário, de modo a preencher a lacuna entre o desempenho corrente e o desempenho esperado.

Assim, a CP-ATM, em atendimento ao Plano de Performance ATM do DECEA (PCA 100-3), dentre outras atribuições, atua na definição de indicadores de performance, na realização de análises pós-operações e em demais produtos de monitoramento do desempenho do SISCEAB, colaborando, assim, com a otimização da gestão por performance no âmbito do DECEA. 


### Plano Global de Navegação Aérea - GANP 

O GANP é o mais alto documento estratégico de navegação aérea da OACI, constituindo diretrizes para conduzir a evolução do sistema global de navegação aérea e apoiando o planejamento para implementações em nível local (Estados isolados) e regional (grupos de Estados).

O objetivo do GANP é acomodar todas as operações dos usuários do espaço aéreo de maneira segura e economicamente viável, ao mesmo tempo em que busca a redução do impacto ambiental da aviação.

Este relatório de performance concentra-se em um subconjunto das onze Áreas de Performance (KPA) do GANP. A relação entre as áreas de desempenho e as ambições da comunidade ATM estão descritas no quadro a seguir.


| KPA        |AMBIÇÃO DE DESEMPENHO|
|:-------------:| :-------------: |
|ACESSO E EQUIDADE|Nenhum membro da comunidade aeronáutica excluído ou tratado de forma injusta|
|CAPACIDADE|Capacidade nominal  facilmente compatível com a demanda.                Eventos inesperados não interromperão a prestação do serviço e não afetarão significativamente o desempenho do sistema|
|CUSTO-BENEFÍCIO|Sem aumento do custo total direto dos Serviços de Navegação Aérea.         Aumento significativo da produtividade dos Serviços de Navegação Aérea, independentemente da demanda|
|EFICIÊNCIA|Redução da distância entre a eficiência de voo alcançada e a trajetória ótima desejada|
|MEIO AMBIENTE|Ineficiências induzidas pelos Serviços de Navegação Aérea progressivamente eliminadas para contribuir com os objetivos globais da OACI relacionadas à emissões de CO2 Benefícios obtidos com os ganhos de eficiência de voo|
|FLEXIBILIDADE|Absorção das alterações necessárias às trajetórias dos voos|
|INTEROPERABILIDADE|Compatibilidade de sistemas em nível operacional e técnico|
|PARTICIPAÇÃO DA COMUNIDADE ATM|Máxima utilização partilhada dos recursos da navegação aérea|
|PREVISIBILIDADE|Sem variabilidade da entrega dos Serviços de Navegação Aérea|
|SEGURANÇA OPERACIONAL (Safety)|Sem acidentes relacionados com os Serviços de Navegação Aérea e redução significativa (50%) dos incidentes graves|
|SEGURANÇA DA AVIAÇÃO (Security)|Sem interrupções significativas devido a incidentes cibernéticos|



A visão do GANP reflete os objetivos do sistema de navegação aérea, que incluem desafios, oportunidades e tendências tecnológicas. A evolução impulsionada por essa visão produzirá um sistema de navegação aérea global de alto desempenho que atende às crescentes expectativas da sociedade.

Neste plano, é proposta uma estrutura de quatro camadas composta pelos níveis global (estratégico e técnico), regional e nacional, os quais fornecem uma estrutura para o alinhamento dos planos regionais, sub-regionais e nacionais. A estrutura de quatro camadas facilita a tomada de decisões ao fornecer uma direção estratégica estável para a evolução do sistema de navegação aérea e, ao mesmo tempo, indicando o grau de relevância, ao longo do tempo, para o conteúdo técnico a ser tratado.

## Abrangência

Os indicadores de performance apresentados neste documento foram calculados por meio de informações coletadas das melhores fontes de dados em termos de qualidade, regularidade e disponibilidade. Comparações de atividades operacionais requerem padronização do modus operandi, definições e entendimento comuns, mesmo considerando as particularidades de cada localidade. 

As informações descritas neste relatório não abordam todas as onze KPA previstas no GANP, concentrando-se nas informações relativas às características do sistema e nas áreas de Previsibilidade, Eficiência, Capacidade, Custo-Benefício, Segurança Operacional (Safety), Segurança da Aviação (Security) e Participação da Comunidade ATM. Além disso, projetos relacionados ao ATM também foram considerados.

## Âmbito geográfico

Este relatório abrange todo o espaço aéreo sob responsabilidade do Brasil sobre terra e mar, que ultrapassa a área sobrejacente ao território brasileiro e alcança uma significativa parte do Oceano Atlântico, conforme tratados internacionais, estendendo-se além de suas fronteiras e perfazendo um total de 22 milhões de km2 sob gestão estratégica da Aeronáutica.

O controle do espaço aéreo brasileiro é integrado: as funções de Defesa Aérea e de Controle de Tráfego Aéreo são desempenhadas pelo DECEA, um órgão governamental subordinado ao Comando da Aeronáutica e ao Ministério da Defesa.

Ao DECEA compete a implementação de equipamentos, órgãos e sistemas, bem como o controle e a supervisão das Organizações subordinadas, provendo diretrizes estratégicas necessárias para a condução das ações executadas pelas suas Organizações Regionais, os quatro Centros Integrados de Defesa Aérea e Controle de Tráfego Aéreo (CINDACTA), distribuídos como áreas de responsabilidade próprias de cinco Regiões de Informação de Voo (FIR), e o Centro Regional de Controle do Espaço Aéreo Sudeste (CRCEA-SE), com as seguintes estruturas de jurisdição:

## Escopo

O escopo de análise foi definido pela necessidade de identificar um conjunto comum de fontes de dados com níveis de detalhamento e cobertura adequados. Atendendo ao previsto no PCA 100-3, dentro das KPA já mencionadas, fazem parte do escopo do relatório as seguintes localidades:

<div align="center">
![Imagem teste](imagens/fig8.jpg)


## Âmbito temporal

Este relatório aborda o desempenho monitorado no SISCEAB para o período de 1º JAN 2022 a 31 DEZ 2022.


## Retomada da demanda nacional pós-COVID-19

Os impactos da pandemia da COVID-19 na indústria do transporte aéreo foram significativos e sem precedentes, estendendo-se durante a maior parte de 2020 e por todo o ano de 2021. A aviação internacional foi o segmento que mais sofreu com as medidas sanitárias impostas, em função do surgimento de novas variantes e do aumento no número de casos. 

A Erro! Autoreferência de indicador não válida. apresenta o total de voos realizados no SISCEAB em 2022, considerando os serviços prestados pelos diversos órgãos de controle. É possível observar a retomada das operações aéreas em quase todos os meses do último ano, com operações sempre próximas ou acima do total de 2019 (pré-pandemia). Vale ressaltar que o “Total de Voos no SISCEAB” conta todos os voos realizados no país, em espaço aéreo controlado, a partir dos planos de voo ativos. Adiante, ao se analisar no 2.4.1 as operações por segmento da aviação (Comercial Doméstica, Comercial Internacional e Geral), são consideradas as operações de pouso e decolagem nos principais aeroportos do país.

Os meses de maior movimento em 2022 foram julho e agosto, registrando 153.915 e 150.258 voos, respectivamente. Ao final do ano, o total de operações aéreas no SISCEAB ficou 5,2% acima do total de 2019.


```{r gf.1, ,fig.cap='Total de voos no SISCEAB',fig.align='center', echo=FALSE, warning=FALSE, message=FALSE,fig.width=15,fig.height=8}
#GRÁFICO COMPARATIVO POR MÊS DE TOTAL DE OPERAÇÕES ARR E DEP NO SISCEAB (03)
BDS_ANO_2019_SIS <- TOTAL_MES_SISCEAB %>% filter(ANO %in% c(2019), MES=="JAN")
BDS_ANO_2022_SIS <- TOTAL_MES_SISCEAB %>% filter(ANO %in% c(2022), MES=="JAN")
BDS_VAR_ANO_SIS <- bind_rows(BDS_ANO_2019_SIS,BDS_ANO_2022_SIS) %>% 
  transmute(ANO=ANO, TOTAL=TOTAL,VAR=(BDS_ANO_2022_SIS$TOTAL-BDS_ANO_2019_SIS$TOTAL)/BDS_ANO_2019_SIS$TOTAL)

GFVARANO_SIS <-  
ggplot(BDS_VAR_ANO_SIS)+                                                                                                 
  geom_col(aes(x=ANO, y=TOTAL, fill = ANO),width = .9, position = position_dodge(preserve = "single"))+                
  scale_y_continuous(limits = c(0,1700000),labels = comma_format(big.mark = "."))+ 
  scale_x_discrete(expand = expansion(add = .7))+
  geom_richtext(aes(x=ANO, y=300000, label= format(TOTAL,big.mark="."), group=ANO),size=5.5, position = position_dodge(width = .9), angle=90)+
  theme_classic() + 
  theme(panel.background=element_rect(fill = "#F0F8FF")
  ) +
  labs(caption = "  ", x = NULL, y = NULL   
  ) +
  theme(legend.position = "none",
        plot.caption = element_text(size = 28))+
  scale_fill_manual(values =cores)


GFVARMES_SIS <- 
TOTAL_MES_SISCEAB %>% filter(ANO %in% c(2019, 2022)) %>%
  ggplot()+
  geom_col(aes(x=MES, y=MOV, fill = ANO), position = position_dodge(preserve = "single"))+
  scale_y_continuous(limits = c(0,160000),labels = comma_format(big.mark = ".")) +
  coord_cartesian(xlim = c(1,12.5))+
  geom_richtext(aes(x=MES, y=32000, label = ifelse(MOV>999,format(MOV,big.mark="."),MOV) , group=ANO),size=3, position = position_dodge(width = .9), angle=90)+
  theme_classic()+
  theme(legend.title    = element_text(size = 8)
        ,legend.key.size = unit(0.3, "cm")
  ) +
  labs( x = NULL, y = "Movimentos - total SISCEAB"
       ,fill = "ANO") +
  theme(legend.position = "bottom",
        legend.title=element_blank(),
        legend.text = element_text(size = 14),
        axis.title.y = element_text(size = 15))+
  scale_fill_manual(values = cores)




 
TOTAL_MES_2019_SIS <- TOTAL_MES_SISCEAB %>% filter(ANO=="2019")
TOTAL_MES_2022_SIS <- TOTAL_MES_SISCEAB %>% filter(ANO=="2022")
TOTALMES_SIS <- bind_cols(TOTAL_MES_2019_SIS,TOTAL_MES_2022_SIS$MOV) %>% #FOI CRIADO O MOV_COM_DOM PARA CRIAR O LABEL DE VARIAÇÃO 
  transmute(ANO=ANO,TOTAL=TOTAL,MES=MES,MOV19=MOV,MOV22=...5) %>% mutate(VAR= (MOV22-MOV19)/MOV19)




MOV_VAR_SIS <-    TOTALMES_SIS %>% 
  transmute(ANO = MES,VAR=VAR) %>% 
  mutate(ANO= factor(ANO, levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ")),
         COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0)))



GFVARDOM_MES_SIS <- 
ggplot(MOV_VAR_SIS)+
  geom_col(aes(x = ANO, y = VAR, fill = COR), 
           na.rm = TRUE, color = "black",width = 0.30) +
  theme_minimal()+
  geom_hline(yintercept = 0) +
  scale_y_continuous(limits=c(-.3,.3),labels = scales::label_percent(scale = 100))+
  scale_x_discrete(breaks = NULL)+
  coord_cartesian(xlim = c(1,12.5))+
  guides(fill = FALSE) +
  geom_text(aes(x = ANO, y = VAR, label=scales::percent(VAR,accuracy = 0.1),vjust = ifelse(VAR < 0, 1.25, -0.25)),size= 3)+
  labs(title= "Mensal",x = NULL, y = "Var. 2019/2022") +
  scale_fill_manual(values = c("firebrick", "dodgerblue4"))+
  theme(panel.spacing = unit(1, "cm", data = NULL),
        plot.title = element_text(size = 18,
                                  face = "bold",
                                  hjust = 0.5),
        axis.title.y = element_text(size = 15))


GFVARDOM_ANO <- 
  ggplot(BDS_VAR_ANO_SIS %>% filter(ANO=="2022") %>% 
           mutate(COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0))))+
  geom_col(aes(x = ANO, y = VAR, fill = COR), 
           na.rm = TRUE, color = "black",width = 0.30) +
  theme_minimal()+
  geom_hline(yintercept = 0) +
  scale_y_continuous(breaks=NULL,limits=c(-.3,.3),labels = scales::label_percent(scale = 100))+
  scale_x_discrete(breaks = NULL,expand = expansion(add = 1.5))+
  guides(fill = FALSE) +
  geom_text(aes(x = ANO, y = VAR, label=scales::percent(VAR,accuracy = 0.1),vjust = ifelse(VAR < 0, 1.25, -0.25)),size=3)+
  labs(title= "Anual",x = NULL, y = NULL) +
  scale_fill_manual(values = c("dodgerblue4","firebrick"))+
  theme(panel.spacing = unit(1, "cm", data = NULL),
        plot.title = element_text(size = 18,
                                  face = "bold",
                                  hjust = 0.5))


  grid.arrange(GFVARDOM_MES_SIS,GFVARDOM_ANO,GFVARMES_SIS,GFVARANO_SIS, ncol=2,widths=c(4,1),heights= c(1.4,4)) 
```


## Fontes de dados

Os indicadores de performance ATM analisados neste relatório, bem como os dados de movimentos de tráfego aéreo e outras informações abordadas baseiam-se nas fontes de dados elencadas no quadro abaixo.


<div align="center">
![Imagem teste](imagens/fig9.jpg)

Destaca-se que o Manual de Metodologia de Indicadores ATM do SISCEAB (MCA 100-22), disponível no portal AISWEB do DECEA, contém a descrição completa de cada indicador de performance ATM abordado neste documento, bem como a respectiva fonte de dados.


É importante reforçar a informação sobre mudanças de algumas fontes de dados para determinados indicadores e informações do Relatório de Performance ATM de 2021 (edição anterior a esta), em relação aos documentos publicados em anos anteriores. Essas alterações ocorreram como resultado do aprimoramento da Subdivisão de Pós-Operações do CGNA e da Divisão de Pesquisas do Instituto de Controle do Espaço Aéreo (ICEA) na mineração, no tratamento e no armazenamento dos dados coletados das diversas fontes do SISCEAB, e contemplam os resultados publicados no Relatório de Performance ATM de 2022.





<!--chapter:end:01-intro.Rmd-->







# Características do SISCEAB {#cross}

O SISCEAB compreende uma área extensa, revelando características singulares entre as Organizações Regionais do DECEA em termos de:

- Organização dos Serviços de Tráfego Aéreo (ATS);
- Tipos de órgãos ATS;
- Características do sistema ATM;
- Perfil atual e futuro da demanda;
- Efetivo de Controlador de Tráfego Aéreo (ATCO);
- Fatores meteorológicos; e
- Projetos no SISCEAB.

Tais particularidades são abordadas ao longo deste capítulo em face da influência que esses fatores têm nos indicadores de performance ATM.

As características dos aeródromos, das TMA e das FIR, bem como suas respectivas complexidades e carga de trabalho associada, podem indicar a necessidade de alocar um efetivo maior de ATCO em determinados órgãos de controle, independentemente do tamanho da área geográfica sob sua jurisdição.

<div align="center">
![Imagem teste](imagens/fig10.jpg)

A quantidade de movimentos anuais dos principais aeroportos, das TWR, dos APP e dos ACC pode ser conferida no Anuário Estatístico de Tráfego Aéreo, documento produzido pelo CGNA e disponível em http://portal.cgna.decea.mil.br, na aba Recursos, ou em http://performance.decea.mil.br/ , na aba Produtos.

## Organização dos Serviços de Navegação Aérea

O DECEA é o órgão central do SISCEAB, responsável pela gestão do tráfego aéreo, que envolve todas as atividades relacionadas à segurança e à eficiência do controle do espaço aéreo brasileiro.

O espaço aéreo sob responsabilidade do Brasil é uma área de aproximadamente 22 milhões de km2, organizada em cinco Regiões de Informação de Voo (FIR), contendo cinco Centros de Controle de Área (ACC), 42 Controles de Aproximação (APP), 57 Torres de Controle de Aeródromo (TWR), uma Torre de Controle Digital (D-TWR), 75 Rádios (AFIS) e cinco Rádios Remotas (R-AFIS).

O CGNA é a organização responsável pelo serviço de Gerenciamento de Fluxo de Tráfego Aéreo (ATFM) no espaço aéreo brasileiro, aplicando medidas ATFM, quando necessário, e conduzindo o processo de tomada de decisões colaborativas com a Comunidade ATM nacional (companhias aéreas, aeroportos, órgãos de controle etc.). Além disso, também coordena a gestão do espaço aéreo, o sistema de tratamento de planos de voo, o banco de dados estatísticos, as análises de indicadores e pós-operações, bem como outras atividades relacionadas à navegação aérea.

## Órgãos ATS – ACC / APP / TWR / AFIS

Os órgãos ATS prestam os Serviços de Tráfego Aéreo, que incluem os Serviços de Controle de Tráfego Aéreo, de Informação de Voo e de Alerta.
Popularmente, o tema controle de tráfego aéreo é associado à figura de uma torre de controle (TWR).

Entretanto, a TWR é uma das engrenagens do grande sistema que compõe o SISCEAB, no qual, também estão envolvidos órgãos de controle como os Centros de Controle de Área (ACC) e os Controles de Aproximação (APP). Adicionalmente, existem as Rádios que, por sua vez, são órgãos prestadores do Serviço de Informação de Voo de Aeródromo (AFIS) que complementam os órgãos provedores dos Serviços de Tráfego Aéreo (ATS).

Cada um desses órgãos ATS possui a sua respectiva área de jurisdição, regulamentos inerentes ao serviço prestado e equipamentos adequados para o provimento de suas atribuições. O ANEXO A apresenta os Regionais e os respectivos órgãos ATS sob sua jurisdição.

## Centro de Controle de Área – ACC

O ACC é um órgão de controle de tráfego aéreo encarregado de prestar os Serviços ATS às aeronaves que evoluem na Região de Informação de Voo (FIR). A FIR é uma porção do espaço aéreo com grandes dimensões em que ocorrem as fases de subida, descida, sobrevoo e cruzamento entre diferentes aeronaves, com performances distintas e em níveis de voo variados.

Os ACC brasileiros trabalham ininterruptamente com equipes de controladores de tráfego aéreo, militares especialistas da Aeronáutica que se revezam em turnos específicos de serviço.

Os ACC dispõem de modernas tecnologias  para o provimento seguro, ordenado e rápido do tráfego aéreo. Dentre esses recursos, destacam-se:

- SAGITARIO – Sistema Avançado de Gerenciamento de Informações de Tráfego Aéreo e Relatório de Interesse Operacional;
- CPDLC – Comunicações por Enlace de Dados Controlador-Piloto; e
- ADS-C – Vigilância Dependente Automática – Contrato.


## Controle de Aproximação - APP

O APP é um órgão de controle de tráfego aéreo encarregado de prestar os serviços requeridos pelas aeronaves partindo e chegando nos aeroportos situados no interior de uma área de controle terminal.

No Brasil, os APP contam com equipes de ATCO, compostas por militares especialistas da Aeronáutica, da Marinha do Brasil ou do Exército Brasileiro. Adicionalmente, alguns APP são integrados por profissionais civis, oriundos de outros Provedores de Serviços de Navegação Aérea (PSNA) como, por exemplo, a NAV Brasil e a INFRAERO. Mesmo com entidades externas ao Comando da Aeronáutica , todo o processo de formação de controladores bem como a gestão de licenças e habilitações é realizada pelo DECEA.

Os APP brasileiros dispõem de modernas tecnologias para o provimento seguro, ordenado e rápido do tráfego aéreo. Dentre esses recursos, destacam-se:

- SAGITARIO (sistema de visualização dos dados radar);
- AMAN (Sistema de Gerenciamento de Chegada);
- SITTI (Central de áudio/telefonia integrada); e
- ADS-B (Vigilância Dependente Automática por Radiodifusão).

## Torre de Controle de Aeródromo - TWR

A TWR é um órgão de controle de tráfego aéreo situada nos aeroportos de maior movimento.

De modo geral, a TWR é responsável por prestar os serviços requeridos pelas aeronaves apenas durante as fases de decolagem e pouso em um aeródromo. Incluem-se entre esses serviços o controle no solo de viaturas e pessoas na área de manobras e, quando necessário, o controle dos voos no circuito de tráfego visual do aeródromo.

Da mesma forma que ocorre com os APP, as TWR do Brasil também contam com equipes de ATCO que podem ser especialistas da Aeronáutica ou profissionais de entidades externas.

Adicionalmente, a incorporação de novas tecnologias ATM, como, por exemplo, o TATIC-TWR, o DCL (autorização de tráfego via enlace de dados) e o radar de solo, permitem otimizar a segurança, a eficiência e o gerenciamento em TWR de elevado fluxo de aeronaves.

Alinhando recursos tecnológicos atuais com práticas inovadoras, o DECEA implementou, no aeródromo de Santa Cruz, a primeira Torre Digital (D-TWR) do SISCEAB.

Na operação da D-TWR Santa Cruz, a visualização tradicional do ATCO acerca do cenário operacional foi substituída pela visualização de um sistema de vigilância, composto por câmeras de alta resolução e monitores, que proporcionam aos controladores uma visão panorâmica do aeródromo e de sua vizinhança.

A primeira D-TWR brasileira foi mais um grande passo à modernização da infraestrutura aeroportuária nacional, permitindo fomentar experiências e conhecimentos para futuras aplicações nos demais aeródromos do país.

Nos aeroportos cujo volume de operações aéreas é considerado baixo, não existe necessidade de instalação de uma TWR. Nesses casos, é disponibilizado o AFIS, cujo serviço é prestado por Operadores de Estação Aeronáutica.

No Brasil, as estações aeronáuticas são identificadas como Rádios e prestam o Serviço de Informação de Voo de Aeródromo (AFIS) visando proporcionar informações relevantes aos aeronavegantes.

Eventualmente, alguns APP ou TWR, em determinados horários e de acordo com critérios estabelecidos, podem prestar o AFIS. Isso permite modular o serviço prestado em função da demanda existente, racionalizando recursos, sem prejuízo à segurança operacional.

A partir de 2016, foram viabilizados os órgãos AFIS remotos (R-AFIS) em aeroportos de baixo movimento, sendo o serviço prestado de forma remota à localidade. Atualmente, as localidades de Fernando de Noronha (na FIR-RE), Oiapoque e Vilhena (na FIR-AZ), Uruguaiana e Corumbá (na FIR-CW) operam na configuração R-AFIS.

As Rádios, remotas ou não, contam com equipes de Operadores de Estação Aeronáutica, que podem ser militares ou civis, da Aeronáutica ou de outras organizações.

## AFIS

No Brasil, as estações aeronáuticas são identificadas como Rádios e prestam o Serviço de Informação de Voo de Aeródromo (AFIS) visando proporcionar informações relevantes aos aeronavegantes.

Eventualmente, alguns APP ou TWR, em determinados horários e de acordo com critérios estabelecidos, podem prestar o AFIS. Isso permite modular o serviço prestado em função da demanda existente, racionalizando recursos, sem prejuízo à segurança operacional.

A partir de 2016, foram viabilizados os órgãos AFIS remotos (R-AFIS) em aeroportos de baixo movimento, sendo o serviço prestado de forma remota à localidade. Atualmente, as localidades de Fernando de Noronha (na FIR-RE), Oiapoque e Vilhena (na FIR-AZ), Uruguaiana e Corumbá (na FIR-CW) operam na configuração R-AFIS.

As Rádios, remotas ou não, contam com equipes de Operadores de Estação Aeronáutica, que podem ser militares ou civis, da Aeronáutica ou de outras organizações.

## Organizações Regionais do DECEA

O Quadro 5 apresenta as principais características do sistema ATM brasileiro, que permite identificar o cenário de cada Organização Regional.

<div align="center">
![Imagem teste](imagens/fig11.jpg)

**NOTA 1:** A metodologia que mede a área geográfica de cada Regional sofreu uma pequena modificação: no Relatório de 2021, se utilizou o critério da jurisdição, que excluía a área do CRCEA-SE das FIR sobrejacentes. Nesta edição, foi utilizada a delimitação geográfica de cada FIR. Assim, a área do CRCEA-SE deixa de ser agregada no cômputo geral do SISCEAB, que é igual ao somatório de suas cinco FIR. 

**NOTA 2:** Em 2022, houve redimensionamento das FIR Amazônica, Atlântico e Recife. Em 16 de junho, parte da FIR-AZ passou para a FIR-AO. Em 1º de dezembro de 2022, parte da FIR-AO passou para a FIR-RE.

**NOTA 3:** As informações relativas aos ATCO foram extraídas do Sistema de Gestão de Pessoal Operacional (SGPO), com base nos detentores de licença de ATCO em atividade, sendo incluídos os graduados militares BCT (da ativa ou da reserva), estagiários, ATCO de Defesa Aérea, oficiais CTA e civis DACTA contabilizados em cada Regional. No efetivo total do SISCEAB e no percentual operacional, além dos ATCO já informados nos Regionais, são considerados também os militares alocados em unidades fora dos Regionais, mas não são considerados aqueles em formação na Escola de Especialistas de Aeronáutica (EEAR). Foram incluídas informações específicas sobre operadores de outras Forças, da NAVBRASIL e demais PSNA.

**NOTA 4:** Em relação aos voos controlados, a quantidade de voos foi calculada por FIR/Regional, com base no número de movimentos de 1º/01/2022 a 31/12/2022 constantes no SETA Millenium, excluindo-se os movimentos repetidos nas duas bases (das localidades de origem e de destino). 

**NOTA 5:** Os dados descritos na NOTA 4 foram utilizados para o cálculo da densidade, em número de voos/km2. A partir daí, foi considerada a inclusão da área da FIR-AO, representada com os valores entre parênteses (0,07 para o SISCEAB e 0,03 para o CINDACTA III). Assim, os valores sem os parênteses representam a densidade do SISCEAB e do CINDACTA III desconsiderando a área da FIR-AO.

**NOTA 6:** A produtividade foi calculada na grandeza de mil voos por ATCO operacional.

**NOTA 7:** O share da aviação geral indica a participação deste segmento em relação ao total de movimentos.

**NOTA 8:** Em relação ao número de ACC, APP, TWR e AFIS, as informações foram obtidas nas publicações AIP-Brasil, ROTAER e no Portal AISWEB, do DECEA, conforme o ANEXO A.

**NOTA 9:** A quantidade de aeródromos foi contabilizada de acordo com o site de performance do DECEA. Para o cálculo do quantitativo de aeródromos sem órgãos ATS foi considerado o total de aeródromos que não possuem TWR, D-TWR, AFIS e R-AFIS.


## Caracterização da demanda

O objetivo geral dos serviços de tráfego aéreo é o fornecimento de um fluxo de tráfego aéreo seguro, ordenado e eficiente. Para fins de comparações operacionais, é importante ter um bom entendimento da demanda nos principais aeroportos do SISCEAB, do ranking dos aeroportos, da participação de movimentos por FIR, das rotas mais voadas pela aviação comercial, da densidade do tráfego e como a frota é composta, de acordo com a classificação das aeronaves em leve, média ou pesada.

A caracterização da demanda de tráfego aéreo no Brasil é detalhada nos tópicos a seguir.

<div align="center">
![Imagem teste](imagens/fig12.jpg)

### Demanda nos principais aeroportos do SISCEAB

Em 2022, a demanda nos principais aeroportos brasileiros apresentou números muito próximos ao volume de operações aéreas observado em 2019, ano de referência pré-pandemia. Nessa seção, são considerados os 34 principais aeroportos, contabilizando as respectivas operações de pouso e decolagem.

Nesse sentido, a Figura 3 apresenta a média móvel semanal  de pousos e decolagens realizados nos principais aeroportos do SISCEAB nos últimos anos. Em 2019, foi observada pouca variação ao longo do ano, com uma média em torno de 5.500 operações de pousos e decolagens por dia. A partir de março de 2020, observa-se uma queda significativa na média móvel em função da pandemia da COVID-19. No ano seguinte, apesar da recuperação inicial, os meses de março, abril e maio mostraram novas contrações da demanda em virtude da segunda onda da COVID-19.

Ao fim do ano passado, a média móvel de operações nos principais aeroportos estava acima de 5.000 movimentos por dia, caracterizando, assim, a recuperação da demanda nacional e a retomada dos voos no cenário pós-covid (o “novo normal”).

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3}

Dados_Base34_2022 <- read_excel("data/Dados_Base34_2022.xlsx", 
                                col_types = c("date", "text", "numeric"))

Dados_Base34_2022 <-Dados_Base34_2022  %>%
  mutate( ROLLSEV = rollmean(x=Total, k=7, fill = NA))

Dados_Base34_2022 %>% ggplot(aes(x=Data)) +
  #geom_point(aes(y = Total), color= "#4682B4",size=.5) +
  geom_line(aes(y = ROLLSEV), color = "royalblue4") +
  scale_y_continuous(limits = c(0,7000))+
  labs( x = NULL, y = "Média móvel diária - 7 dias") +
  theme_bw()




```

#### Aviação comercial doméstica

A Erro! Autoreferência de indicador não válida. apresenta o volume de operações de pouso e decolagem nos principais aeroportos brasileiros  e a variação observada ao comparar 2022 com 2019. Pode-se verificar que a demanda comercial doméstica operou acima de 90% do volume de 2019 de maio a dezembro de 2022, sendo maio o mês com o melhor desempenho (apenas 2,9% abaixo do volume de 2019).

A aviação comercial doméstica nos principais aeroportos brasileiros operou com 89,8% do volume pré-pandemia (10,2% abaixo do volume de 2019).







## Chapters and sub-chapters

There are two steps to cross-reference any heading:

1. Label the heading: `# Hello world {#nice-label}`. 
    - Leave the label off if you like the automated heading generated based on your heading title: for example, `# Hello world` = `# Hello world {#hello-world}`.
    - To label an un-numbered heading, use: `# Hello world {-#nice-label}` or `{# Hello world .unnumbered}`.

1. Next, reference the labeled heading anywhere in the text using `\@ref(nice-label)`; for example, please see Chapter \@ref(cross). 
    - If you prefer text as the link instead of a numbered reference use: [any text you want can go here](#cross).

## Captioned figures and tables

Figures and tables *with captions* can also be cross-referenced from elsewhere in your book using `\@ref(fig:chunk-label)` and `\@ref(tab:chunk-label)`, respectively.

See Figure \@ref(fig:nice-fig).

```{r nice-fig, fig.cap='Here is a nice figure!', out.width='80%', fig.asp=.75, fig.align='center', fig.alt='Plot with connected points showing that vapor pressure of mercury increases exponentially as temperature increases.'}
par(mar = c(4, 4, .1, .1))
plot(pressure, type = 'b', pch = 19)
```

Don't miss Table \@ref(tab:nice-tab).

```{r nice-tab, tidy=FALSE}
knitr::kable(
  head(pressure, 10), caption = 'Here is a nice table!',
  booktabs = TRUE
)
```

<!--chapter:end:02-cross-refs.Rmd-->

# Parts

You can add parts to organize one or more book chapters together. Parts can be inserted at the top of an .Rmd file, before the first-level chapter heading in that same file. 

Add a numbered part: `# (PART) Act one {-}` (followed by `# A chapter`)

Add an unnumbered part: `# (PART\*) Act one {-}` (followed by `# A chapter`)

Add an appendix as a special kind of un-numbered part: `# (APPENDIX) Other stuff {-}` (followed by `# A chapter`). Chapters in an appendix are prepended with letters instead of numbers.




<!--chapter:end:03-parts.Rmd-->

# Footnotes and citations 

## Footnotes

Footnotes are put inside the square brackets after a caret `^[]`. Like this one ^[This is a footnote.]. 

## Citations

Reference items in your bibliography file(s) using `@key`.

For example, we are using the **bookdown** package [@R-bookdown] (check out the last code chunk in index.Rmd to see how this citation key was added) in this sample book, which was built on top of R Markdown and **knitr** [@xie2015] (this citation was added manually in an external file book.bib). 
Note that the `.bib` files need to be listed in the index.Rmd with the YAML `bibliography` key.


The RStudio Visual Markdown Editor can also make it easier to insert citations: <https://rstudio.github.io/visual-markdown-editing/#/citations>

<!--chapter:end:04-citations.Rmd-->

# Blocks

## Equations

Here is an equation.

\begin{equation} 
  f\left(k\right) = \binom{n}{k} p^k\left(1-p\right)^{n-k}
  (\#eq:binom)
\end{equation} 

You may refer to using `\@ref(eq:binom)`, like see Equation \@ref(eq:binom).


## Theorems and proofs

Labeled theorems can be referenced in text using `\@ref(thm:tri)`, for example, check out this smart theorem \@ref(thm:tri).

::: {.theorem #tri}
For a right triangle, if $c$ denotes the *length* of the hypotenuse
and $a$ and $b$ denote the lengths of the **other** two sides, we have
$$a^2 + b^2 = c^2$$
:::

Read more here <https://bookdown.org/yihui/bookdown/markdown-extensions-by-bookdown.html>.

## Callout blocks


The R Markdown Cookbook provides more help on how to use custom blocks to design your own callouts: https://bookdown.org/yihui/rmarkdown-cookbook/custom-blocks.html

<!--chapter:end:05-blocks.Rmd-->

# Sharing your book

## Publishing

HTML books can be published online, see: https://bookdown.org/yihui/bookdown/publishing.html

## 404 pages

By default, users will be directed to a 404 page if they try to access a webpage that cannot be found. If you'd like to customize your 404 page instead of using the default, you may add either a `_404.Rmd` or `_404.md` file to your project root and use code and/or Markdown syntax.

## Metadata for sharing

Bookdown HTML books will provide HTML metadata for social sharing on platforms like Twitter, Facebook, and LinkedIn, using information you provide in the `index.Rmd` YAML. To setup, set the `url` for your book and the path to your `cover-image` file. Your book's `title` and `description` are also used.



This `gitbook` uses the same social sharing data across all chapters in your book- all links shared will look the same.

Specify your book's source repository on GitHub using the `edit` key under the configuration options in the `_output.yml` file, which allows users to suggest an edit by linking to a chapter's source file. 

Read more about the features of this output format here:

https://pkgs.rstudio.com/bookdown/reference/gitbook.html

Or use:

```{r eval=FALSE}
?bookdown::gitbook
```



<!--chapter:end:06-share.Rmd-->

`r if (knitr::is_html_output()) '
# References {-}
'`

<!--chapter:end:07-references.Rmd-->

---
title: "Untitled"
output: html_document
date: '2023-03-30'
---

<!-- ```{r setup, include=FALSE} -->
<!-- knitr::opts_chunk$set(echo = TRUE) -->

<!-- library(tidyverse) -->
<!-- library(lubridate) -->
<!-- library(dplyr) -->
<!-- library(readr) -->
<!-- library(patchwork) #pacote que soma os gráficos  -->
<!-- library(leaflet)#pacote para mapas dinamicos -->
<!-- library(geobr)#pacote para mapa simples -->
<!-- library(readxl) -->
<!-- library(sf)#pacote para mapa simples -->
<!-- library(rgdal) #pacote para API -->
<!-- library(httr) #pacote para API -->
<!-- library(jsonlite) #pacote para API -->
<!-- library(scales) -->
<!-- library(ggtext) -->
<!-- library(gridExtra) -->
<!-- library(Rcpp)# pacote usado para corrigir um erro -->
<!-- library(ggimage)#pacote para salvar os gráficos como imagem -->
<!-- library(flexdashboard) -->
<!-- library(ggrepel) -->
<!-- library(zoo) -->

<!-- ``` -->

#1. BDS

```{r echo=FALSE, message=FALSE, warning=FALSE}
URL_BASE <- "http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area="

BDS_KPI_01 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_01")
BDS_KPI_01_TEXT <- content(BDS_KPI_01, "text")
BDS_KPI_01_JSON <- fromJSON(BDS_KPI_01_TEXT,flatten = TRUE)
BDS_KPI_01_DF <- as.data.frame(BDS_KPI_01_JSON) %>%
  select(movimentos.ano,movimentos.percentual_ano, movimentos.regiao,movimentos.aero,movimentos.jan:movimentos.dez) %>% 
  mutate(movimentos.percentual_ano=movimentos.percentual_ano, movimentos.jan=movimentos.jan,
         movimentos.fev=movimentos.fev, movimentos.mar=movimentos.mar,
         movimentos.abr=movimentos.abr, movimentos.mai=movimentos.mai,
         movimentos.jun=movimentos.jun, movimentos.jul=movimentos.jul,
         movimentos.ago=movimentos.ago, movimentos.set=movimentos.set,
         movimentos.out=movimentos.out, movimentos.nov=movimentos.nov,
         movimentos.dez=movimentos.dez)

#uma maneira mais fácil de modificar o nome das colunas é usando o colnames()

COL_NAMES_KPI01 <- c("ANO", "PONTUALIDADE_ANO","REGIONAL","AERO","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")

colnames(BDS_KPI_01_DF) <- COL_NAMES_KPI01

######################

BDS_KPI_01_REGIONAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_01&regional=s")
BDS_KPI_01_TEXT_REGIONAL <- content(BDS_KPI_01_REGIONAL, "text")
BDS_KPI_01_JSON_REGIONAL <- fromJSON(BDS_KPI_01_TEXT_REGIONAL,flatten = TRUE)
BDS_KPI_01_REGIONAL_DF <- as.data.frame(BDS_KPI_01_JSON_REGIONAL)







########

BDS_KPI_02 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_02")
BDS_KPI_02_TEXT <- content(BDS_KPI_02, "text")
BDS_KPI_02_JSON <- fromJSON(BDS_KPI_02_TEXT,flatten = TRUE)
BDS_KPI_02_DF <- as.data.frame(BDS_KPI_02_JSON)

########

BDS_KPI_02_REGIONAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_02&regional=s")
BDS_KPI_02_REGIONAL_TEXT <- content(BDS_KPI_02_REGIONAL, "text")
BDS_KPI_02_REGIONAL_JSON <- fromJSON(BDS_KPI_02_REGIONAL_TEXT,flatten = TRUE)
BDS_KPI_02_REGIONAL_DF <- as.data.frame(BDS_KPI_02_REGIONAL_JSON)


#########

BDS_KPI_06 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_06")
BDS_KPI_06_TEXT <- content(BDS_KPI_06, "text")
BDS_KPI_06_JSON <- fromJSON(BDS_KPI_06_TEXT,flatten = TRUE)
BDS_KPI_06_DF <- as.data.frame(BDS_KPI_06_JSON)

##########


BDS_IDBR_06_TWR <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=IDBR_06&regional=TWR")
BDS_IDBR_06_TWR_TEXT <- content(BDS_IDBR_06_TWR, "text")
BDS_IDBR_06_TWR_JSON <- fromJSON(BDS_IDBR_06_TWR_TEXT,flatten = TRUE)
BDS_IDBR_06_TWR_DF <- as.data.frame(BDS_IDBR_06_TWR_JSON)

############

BDS_IDBR_06_APP <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=IDBR_06&regional=APP")
BDS_IDBR_06_APP_TEXT <- content(BDS_IDBR_06_APP, "text")
BDS_IDBR_06_APP_JSON <- fromJSON(BDS_IDBR_06_APP_TEXT,flatten = TRUE)
BDS_IDBR_06_APP_DF <- as.data.frame(BDS_IDBR_06_APP_JSON)

############

BDS_IDBR_06_ACC <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=IDBR_06&regional=ACC")
BDS_IDBR_06_ACC_TEXT <- content(BDS_IDBR_06_ACC, "text")
BDS_IDBR_06_ACC_JSON <- fromJSON(BDS_IDBR_06_ACC_TEXT,flatten = TRUE)
BDS_IDBR_06_ACC_DF <- as.data.frame(BDS_IDBR_06_ACC_JSON)

BDS_IDBR_06_ACC_DF <- BDS_IDBR_06_ACC_DF %>% mutate(ACC = case_when(movimentos.aero == "BRASIL" ~ "SISCEAB",
                         movimentos.aero == "SBBS" ~ "ACC Brasília",
                         movimentos.aero == "SBCW" ~ "ACC Curitiba",
                         movimentos.aero == "SBRE" ~ "ACC Recife",
                         movimentos.aero == "SBAZ" ~ "ACC Amazônico",
                         movimentos.aero == "SBAO" ~ "ACC Atlântico"))

##########







BDS_KPI_08_C40 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_08_C40")
BDS_KPI_08_C40_TEXT <- content(BDS_KPI_08_C40, "text")
BDS_KPI_08_C40_JSON <- fromJSON(BDS_KPI_08_C40_TEXT,flatten = TRUE)
BDS_KPI_08_C40_DF <- as.data.frame(BDS_KPI_08_C40_JSON)%>%
  select(movimentos.ano,movimentos.percentual_ano, movimentos.regiao,movimentos.aero,movimentos.jan:movimentos.dez)

COL_NAMES_KPI08_c40 <- c("ANO", "PONTUALIDADE_ANO","REGIONAL","AERO","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")

colnames(BDS_KPI_08_C40_DF) <- COL_NAMES_KPI08_c40

##########

BDS_KPI_08_C100 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_08_C100")
BDS_KPI_08_C100_TEXT <- content(BDS_KPI_08_C100, "text")
BDS_KPI_08_C100_JSON <- fromJSON(BDS_KPI_08_C100_TEXT,flatten = TRUE)
BDS_KPI_08_C100_DF <- as.data.frame(BDS_KPI_08_C100_JSON)%>%
  select(movimentos.ano,movimentos.percentual_ano, movimentos.regiao,movimentos.aero,movimentos.jan:movimentos.dez)

COL_NAMES_KPI08_c100 <- c("ANO", "PONTUALIDADE_ANO","REGIONAL","AERO","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")

colnames(BDS_KPI_08_C100_DF) <- COL_NAMES_KPI08_c100

##########
#UNIÃO DO KPI08 C40COM C100

#bind_cols() é usado para unir colunas de df diferentes

BDS_KPI08_C40_C100 <- bind_cols(BDS_KPI_08_C40_DF$ANO,
                                BDS_KPI_08_C40_DF$REGIONAL,
                                BDS_KPI_08_C40_DF$AERO,
                                BDS_KPI_08_C40_DF$PONTUALIDADE_ANO,
                                BDS_KPI_08_C100_DF$PONTUALIDADE_ANO)

COL_NAMES_KPI08_c40_c100 <- c("ANO","REGIONAL","AERO", "PONTUALIDADE_ANO_C40",
                              "PONTUALIDADE_ANO_C100")

colnames(BDS_KPI08_C40_C100) <- COL_NAMES_KPI08_c40_c100
#########################################################
#BDS KPI 08 POR REGIONAL

BDS_KPI_08_C40_REGIONAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_08_C40&regional=s")
BDS_KPI_08_C40_REGIONAL_TEXT <- content(BDS_KPI_08_C40_REGIONAL, "text")
BDS_KPI_08_C40_REGIONAL_JSON <- fromJSON(BDS_KPI_08_C40_REGIONAL_TEXT,flatten = TRUE)
BDS_KPI_08_C40_REGIONAL_DF <- as.data.frame(BDS_KPI_08_C40_REGIONAL_JSON)%>%
  select(movimentos.ano,movimentos.percentual_ano, movimentos.regiao,movimentos.aero,movimentos.jan:movimentos.dez)

COL_NAMES_KPI08_c40_REGIONAL <- c("ANO", "PONTUALIDADE_ANO","REGIONAL","AERO","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")

colnames(BDS_KPI_08_C40_REGIONAL_DF) <- COL_NAMES_KPI08_c40_REGIONAL
################
BDS_KPI_08_C100_REGIONAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_08_C100&regional=s")
BDS_KPI_08_C100_REGIONAL_TEXT <- content(BDS_KPI_08_C100_REGIONAL, "text")
BDS_KPI_08_C100_REGIONAL_JSON <- fromJSON(BDS_KPI_08_C100_REGIONAL_TEXT,flatten = TRUE)
BDS_KPI_08_C100_REGIONAL_DF <- as.data.frame(BDS_KPI_08_C100_REGIONAL_JSON)%>%
  select(movimentos.ano,movimentos.percentual_ano, movimentos.regiao,movimentos.aero,movimentos.jan:movimentos.dez)

COL_NAMES_KPI08_c100_REGIONAL <- c("ANO", "PONTUALIDADE_ANO","REGIONAL","AERO","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")

colnames(BDS_KPI_08_C100_REGIONAL_DF) <- COL_NAMES_KPI08_c100_REGIONAL
#########################
#unindo o KPI 08 por REGIONAL

BDS_KPI08_C40_C100_REGIONAL <- bind_cols(BDS_KPI_08_C40_REGIONAL_DF$ANO,
                                BDS_KPI_08_C40_REGIONAL_DF$REGIONAL,
                                BDS_KPI_08_C40_REGIONAL_DF$AERO,
                                BDS_KPI_08_C40_REGIONAL_DF$PONTUALIDADE_ANO,
                                BDS_KPI_08_C100_REGIONAL_DF$PONTUALIDADE_ANO)

COL_NAMES_KPI08_c40_c100_REGIONAL <- c("ANO","REGIONAL","AERO", "PONTUALIDADE_ANO_C40",
                              "PONTUALIDADE_ANO_C100")

colnames(BDS_KPI08_C40_C100_REGIONAL) <- COL_NAMES_KPI08_c40_c100_REGIONAL
BDS_KPI08_C40_C100_REGIONAL<- BDS_KPI08_C40_C100_REGIONAL %>% pivot_longer(cols = PONTUALIDADE_ANO_C40:PONTUALIDADE_ANO_C100,
                                             names_to = "C40_100",
                                             values_to = "ADICIONAL")



#BDS_KPI08_C40_C100_REGIONAL %>% mutate("40"="40", "100"="100") %>% 
#  unite()



#########################################################
#foi necessário criar uma BDS mensal para o KPI 08


#algumas vezes é necessário usar O pivot_longer() para transpor colunas em linhas

BDS_KPI_08_C40_MES <- BDS_KPI_08_C40_DF %>% 
  pivot_longer(cols = JAN:DEZ,
               names_to = "MES",
               values_to = "ADICIONAL") %>% 
  mutate("XXX"= "40") %>% 
  unite("AERO", c("AERO","XXX"))

BDS_KPI_08_C100_MES <- BDS_KPI_08_C100_DF %>% 
  pivot_longer(cols = JAN:DEZ,
               names_to = "MES",
               values_to = "ADICIONAL")%>% 
  mutate("XXX"= "100") %>% 
  unite("AERO", c("AERO","XXX"))


BDS_KPI_08_MES <- bind_rows(BDS_KPI_08_C40_MES,BDS_KPI_08_C100_MES)









##########

BDS_KPI_09 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_09")
BDS_KPI_09_TEXT <- content(BDS_KPI_09, "text")
BDS_KPI_09_JSON <- fromJSON(BDS_KPI_09_TEXT,flatten = TRUE)
BDS_KPI_09_DF <- as.data.frame(BDS_KPI_09_JSON)

##########

BDS_KPI_10 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_10")
BDS_KPI_10_TEXT <- content(BDS_KPI_10, "text")
BDS_KPI_10_JSON <- fromJSON(BDS_KPI_10_TEXT,flatten = TRUE)
BDS_KPI_10_DF <- as.data.frame(BDS_KPI_10_JSON)

##########

BDS_KPI_11 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_11")
BDS_KPI_11_TEXT <- content(BDS_KPI_11, "text")
BDS_KPI_11_JSON <- fromJSON(BDS_KPI_11_TEXT,flatten = TRUE)
BDS_KPI_11_DF <- as.data.frame(BDS_KPI_11_JSON)

##########

BDS_KPI_13 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_13")
BDS_KPI_13_TEXT <- content(BDS_KPI_13, "text")
BDS_KPI_13_JSON <- fromJSON(BDS_KPI_13_TEXT,flatten = TRUE)
BDS_KPI_13_DF <- as.data.frame(BDS_KPI_13_JSON)

##########
BDS_KPI_13_REGIONAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_13&regional=s")
BDS_KPI_13_REGIONAL_TEXT <- content(BDS_KPI_13_REGIONAL, "text")
BDS_KPI_13_REGIONAL_JSON <- fromJSON(BDS_KPI_13_REGIONAL_TEXT,flatten = TRUE)
BDS_KPI_13_REGIONAL_DF <- as.data.frame(BDS_KPI_13_REGIONAL_JSON)

##########

BDS_KPI_14 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_14")
BDS_KPI_14_TEXT <- content(BDS_KPI_14, "text")
BDS_KPI_14_JSON <- fromJSON(BDS_KPI_14_TEXT,flatten = TRUE)
BDS_KPI_14_DF <- as.data.frame(BDS_KPI_14_JSON)%>%
  select(movimentos.ano,movimentos.percentual_ano, movimentos.regiao,movimentos.aero,movimentos.jan:movimentos.dez) %>% 
  mutate(movimentos.percentual_ano=movimentos.percentual_ano, movimentos.jan=movimentos.jan,
         movimentos.fev=movimentos.fev, movimentos.mar=movimentos.mar,
         movimentos.abr=movimentos.abr, movimentos.mai=movimentos.mai,
         movimentos.jun=movimentos.jun, movimentos.jul=movimentos.jul,
         movimentos.ago=movimentos.ago, movimentos.set=movimentos.set,
         movimentos.out=movimentos.out, movimentos.nov=movimentos.nov,
         movimentos.dez=movimentos.dez)
COL_NAMES_KPI14 <- c("ANO", "PONTUALIDADE_ANO","REGIONAL","AERO","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")

colnames(BDS_KPI_14_DF) <- COL_NAMES_KPI14

#####
BDS_KPI_14_REGIONAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_14&regional=s")
BDS_KPI_14_TEXT_REGIONAL <- content(BDS_KPI_14_REGIONAL, "text")
BDS_KPI_14_JSON_REGIONAL <- fromJSON(BDS_KPI_14_TEXT_REGIONAL,flatten = TRUE)
BDS_KPI_14_REGIONAL_DF <- as.data.frame(BDS_KPI_14_JSON_REGIONAL)



####################

PONT_ARR_DEP <- bind_cols(BDS_KPI_14_DF$ANO,BDS_KPI_14_DF$AERO,BDS_KPI_14_DF$PONTUALIDADE_ANO,BDS_KPI_01_DF$PONTUALIDADE_ANO)
COL_NAMES_ARR_DEP <- c("ANO","AERO", "PONT.ARR","PONT.DEP")
colnames(PONT_ARR_DEP) <- COL_NAMES_ARR_DEP

PONT_ARR_DEP <- PONT_ARR_DEP %>% filter(ANO==2022)


##########

BDS_KPI_15 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=KPI_15")
BDS_KPI_15_TEXT <- content(BDS_KPI_15, "text")
BDS_KPI_15_JSON <- fromJSON(BDS_KPI_15_TEXT,flatten = TRUE)
BDS_KPI_15_DF <- as.data.frame(BDS_KPI_15_JSON)


#abaixo crio um df para poder fazer a variação entre o ano de 2022 e 2019

VAR15_2022 <- BDS_KPI_15_DF %>% filter(movimentos.ano=="2022") %>% filter(movimentos.total_movimentos>3500)#QUANDO NECESSÁRIO É SÓ SUBSTITUIR O "2000" PELO VALOR NECESSÁRIO
VAR15_2021 <- BDS_KPI_15_DF %>% filter(movimentos.ano=="2021") %>% filter(movimentos.fluxo%in%VAR15_2022$movimentos.fluxo)
VAR15 <- bind_cols(VAR15_2021,VAR15_2022$movimentos.percentual_ano_70,VAR15_2022$movimentos.total_movimentos) %>% 
  #FOI CRIADO O VAR15 PARA CRIAR O LABEL DE VARIAÇÃO 
  transmute(ROTA=movimentos.fluxo,VAR21=movimentos.percentual_ano_70,VAR22=...24,MOVIMENTOS.21=movimentos.total_movimentos, MOVIMENTOS.22=...25 ) %>% 
  mutate(VAR= (VAR22-VAR21)/VAR21, VAR.ANO=(MOVIMENTOS.22-MOVIMENTOS.21)/MOVIMENTOS.21)




##########

BDS_KPI_TOTAL_AZ <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Total&regional=SBAZ")
BDS_KPI_TOTAL_AZ_TEXT <- content(BDS_KPI_TOTAL_AZ, "text")
BDS_KPI_TOTAL_AZ_JSON <- fromJSON(BDS_KPI_TOTAL_AZ_TEXT,flatten = TRUE)
BDS_KPI_TOTAL_AZ_DF <- as.data.frame(BDS_KPI_TOTAL_AZ_JSON)

##########

BDS_KPI_TOTAL_AO <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Total&regional=SBAO")
BDS_KPI_TOTAL_AO_TEXT <- content(BDS_KPI_TOTAL_AO, "text")
BDS_KPI_TOTAL_AO_JSON <- fromJSON(BDS_KPI_TOTAL_AO_TEXT,flatten = TRUE)
BDS_KPI_TOTAL_AO_DF <- as.data.frame(BDS_KPI_TOTAL_AO_JSON)

##########

BDS_KPI_TOTAL_BS <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Total&regional=SBBS")
BDS_KPI_TOTAL_BS_TEXT <- content(BDS_KPI_TOTAL_BS, "text")
BDS_KPI_TOTAL_BS_JSON <- fromJSON(BDS_KPI_TOTAL_BS_TEXT,flatten = TRUE)
BDS_KPI_TOTAL_BS_DF <- as.data.frame(BDS_KPI_TOTAL_BS_JSON)

##########

BDS_KPI_TOTAL_CW <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Total&regional=SBCW")
BDS_KPI_TOTAL_CW_TEXT <- content(BDS_KPI_TOTAL_CW, "text")
BDS_KPI_TOTAL_CW_JSON <- fromJSON(BDS_KPI_TOTAL_CW_TEXT,flatten = TRUE)
BDS_KPI_TOTAL_CW_DF <- as.data.frame(BDS_KPI_TOTAL_CW_JSON)

##########

BDS_KPI_TOTAL_RE <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Total&regional=SBRE")
BDS_KPI_TOTAL_RE_TEXT <- content(BDS_KPI_TOTAL_RE, "text")
BDS_KPI_TOTAL_RE_JSON <- fromJSON(BDS_KPI_TOTAL_RE_TEXT,flatten = TRUE)
BDS_KPI_TOTAL_RE_DF <- as.data.frame(BDS_KPI_TOTAL_RE_JSON)

##########

BDS_KPI_TOTAL_Brasil <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Total&regional=Brasil")
BDS_KPI_TOTAL_Brasil_TEXT <- content(BDS_KPI_TOTAL_Brasil, "text")
BDS_KPI_TOTAL_Brasil_JSON <- fromJSON(BDS_KPI_TOTAL_Brasil_TEXT,flatten = TRUE)
BDS_KPI_TOTAL_Brasil_DF <- as.data.frame(BDS_KPI_TOTAL_Brasil_JSON)

##########

BDS_KPI_TOTAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Total")
BDS_KPI_TOTAL_TEXT <- content(BDS_KPI_TOTAL, "text")
BDS_KPI_TOTAL_JSON <- fromJSON(BDS_KPI_TOTAL_TEXT,flatten = TRUE)
BDS_KPI_TOTAL_DF <- as.data.frame(BDS_KPI_TOTAL_JSON)

#########

BDS_KPI_COMER <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Comercial")
BDS_KPI_COMER_TEXT <- content(BDS_KPI_COMER, "text")
BDS_KPI_COMER_JSON <- fromJSON(BDS_KPI_COMER_TEXT,flatten = TRUE)
BDS_KPI_COMER_DF <- as.data.frame(BDS_KPI_COMER_JSON)

##########

BDS_KPI_GERAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Geral")
BDS_KPI_GERAL_TEXT <- content(BDS_KPI_GERAL, "text")
BDS_KPI_GERAL_JSON <- fromJSON(BDS_KPI_GERAL_TEXT,flatten = TRUE)
BDS_KPI_GERAL_DF <- as.data.frame(BDS_KPI_GERAL_JSON)

#################
COL.NAMES.MOV <- c("ANO", "TOTAL","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")

MOV_GERAL <- BDS_KPI_GERAL_DF %>% select(movimentos.ano, movimentos.total,movimentos.jan:movimentos.dez) %>% 
  group_by(movimentos.ano) %>% summarise(movimentos.total = sum(movimentos.total),
                                         movimentos.jan = sum(movimentos.jan),
                                         movimentos.fev = sum(movimentos.fev),
                                         movimentos.mar = sum(movimentos.mar),
                                         movimentos.abr = sum(movimentos.abr),
                                         movimentos.mai = sum(movimentos.mai),
                                         movimenos.jun = sum(movimentos.jun),
                                         movimentos.jul = sum(movimentos.jul),
                                         movimentos.ago = sum(movimentos.ago),
                                         movimentoss.set = sum(movimentos.set),
                                         movimentos.out = sum(movimentos.out),
                                         movimentos.nov = sum(movimentos.nov),
                                         movimentos.dez = sum(movimentos.dez)) %>% 
  `colnames<-`(COL.NAMES.MOV) %>% pivot_longer(cols = JAN:DEZ,
                                               names_to = "MES",
                                               values_to = "MOV") %>% 
  mutate(ANO=as.factor(ANO),MES= factor(MES, levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ")))


###########

BDS_KPI_MIL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Militar")
BDS_KPI_MIL_TEXT <- content(BDS_KPI_MIL, "text")
BDS_KPI_MIL_JSON <- fromJSON(BDS_KPI_MIL_TEXT,flatten = TRUE)
BDS_KPI_MIL_DF <- as.data.frame(BDS_KPI_MIL_JSON)


#########

BDS_KPI_MEDIA <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Media")
BDS_KPI_MEDIA_TEXT <- content(BDS_KPI_MEDIA, "text")
BDS_KPI_MEDIA_JSON <- fromJSON(BDS_KPI_MEDIA_TEXT,flatten = TRUE)
BDS_KPI_MEDIA_DF <- as.data.frame(BDS_KPI_MEDIA_JSON)

######### 
#BDS PARA MOVIMENTOS DA AVIAÇÃO COMERCIAL DOMÉSTICA (01)

BDS_KPI_COMERCIAL_NAC <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Comercial-Nac")
BDS_KPI_COMERCIAL_NAC_TEXT <- content(BDS_KPI_COMERCIAL_NAC, "text")
BDS_KPI_COMERCIAL_NAC_JSON <- fromJSON(BDS_KPI_COMERCIAL_NAC_TEXT,flatten = TRUE)
BDS_KPI_COMERCIAL_NAC_DF <- as.data.frame(BDS_KPI_COMERCIAL_NAC_JSON) %>% 
  select(movimentos.ano, movimentos.total,movimentos.jan:movimentos.dez)
COL.NAMES.MOV <- c("ANO", "TOTAL","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")
colnames(BDS_KPI_COMERCIAL_NAC_DF) <- COL.NAMES.MOV

#AJUSTES NA BDS PARA CRIAR O GRÁFICO PARA O ANO DE 2022
MOV_COM_DOMESTC <- BDS_KPI_COMERCIAL_NAC_DF %>% 
  pivot_longer(cols = JAN:DEZ,
               names_to = "MES",
               values_to = "MOV") %>% 
  mutate(MES=factor(MES,levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ")), ANO=as.character(ANO)) 
MOV_COM_DOMESTC_2019 <- MOV_COM_DOMESTC %>% filter(ANO=="2019")
MOV_COM_DOMESTC_2022 <- MOV_COM_DOMESTC %>% filter(ANO=="2022")
MOV_COM_DOM <- bind_cols(MOV_COM_DOMESTC_2019,MOV_COM_DOMESTC_2022$MOV) %>% #FOI CRIADO O MOV_COM_DOM PARA CRIAR O LABEL DE VARIAÇÃO 
  transmute(ANO=ANO,TOTAL=TOTAL,MES=MES,MOV19=MOV,MOV22=...5) %>% mutate(VAR= (MOV22-MOV19)/MOV19)






#########
#BDS PARA MOVIMENTOS DA AVIAÇÃO COMERCIAL INTERNACIONAL (02)

BDS_KPI_COMERCIAL_INT <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Comercial-Int")
BDS_KPI_COMERCIAL_INT_TEXT <- content(BDS_KPI_COMERCIAL_INT, "text")
BDS_KPI_COMERCIAL_INT_JSON <- fromJSON(BDS_KPI_COMERCIAL_INT_TEXT,flatten = TRUE)
BDS_KPI_COMERCIAL_INT_DF <- as.data.frame(BDS_KPI_COMERCIAL_INT_JSON)%>% 
  select(movimentos.ano, movimentos.total,movimentos.jan:movimentos.dez)
COL.NAMES.MOV <- c("ANO", "TOTAL","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")
colnames(BDS_KPI_COMERCIAL_INT_DF) <- COL.NAMES.MOV

#AJUSTES NA BDS PARA CRIAR O GRÁFICO PARA O ANO DE 2022
MOV_COM_INT <- BDS_KPI_COMERCIAL_INT_DF %>%
  pivot_longer(cols = JAN:DEZ,
               names_to = "MES",
               values_to = "MOV") %>% 
  mutate(MES=factor(MES,levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ")), ANO=as.character(ANO))
MOV_COM_INT_2019 <- MOV_COM_INT %>% filter(ANO=="2019")
MOV_COM_INT_2022 <- MOV_COM_INT %>% filter(ANO=="2022")
MOV_COM_INT_VAR <- bind_cols(MOV_COM_INT_2019,MOV_COM_INT_2022$MOV) %>% 
  transmute(ANO=ANO,TOTAL=TOTAL,MES=MES,MOV19=MOV,MOV22=...5) %>% mutate(VAR= (MOV22-MOV19)/MOV19)




#########

BDS_KPI_IDBR_06 <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=IDBR_06")
BDS_KPI_IDBR_06_TEXT <- content(BDS_KPI_IDBR_06, "text")
BDS_KPI_IDBR_06_JSON <- fromJSON(BDS_KPI_IDBR_06_TEXT,flatten = TRUE)
BDS_KPI_IDBR_06_DF <- as.data.frame(BDS_KPI_IDBR_06_JSON)

#########

BDS_KPI_MIN_ATRASO <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=MIN_ATRASO")
BDS_KPI_MIN_ATRASO_TEXT <- content(BDS_KPI_MIN_ATRASO, "text")
BDS_KPI_MIN_ATRASO_JSON <- fromJSON(BDS_KPI_MIN_ATRASO_TEXT,flatten = TRUE)
BDS_KPI_MIN_ATRASO_DF <- as.data.frame(BDS_KPI_MIN_ATRASO_JSON)

#########

BDS_KPI_DENSIDADE <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=DENSIDADE")
BDS_KPI_DENSIDADE_TEXT <- content(BDS_KPI_DENSIDADE, "text")
BDS_KPI_DENSIDADE_JSON <- fromJSON(BDS_KPI_DENSIDADE_TEXT,flatten = TRUE)
BDS_KPI_DENSIDADE_DF <- as.data.frame(BDS_KPI_DENSIDADE_JSON)


#####################################################################################################################################################

#criação do conjunto de cores para os gráficos

cores <- c("#B0C4DE",
           "#708090",
           "#4682B4",
           "#191970")

#######################################
#UNIÃO DAS BDS TOTAL(POR FIR) PARA CIAÇÃO DO GRÁFICO "TOTAL DE MOVIMENTOS SISCEAB E POR FIR" (03)


TOTAL_MOV_SISC_FIR <- bind_rows(BDS_KPI_TOTAL_Brasil_DF, 
                                BDS_KPI_TOTAL_BS_DF, 
                                BDS_KPI_TOTAL_CW_DF, 
                                BDS_KPI_TOTAL_RE_DF, 
                                BDS_KPI_TOTAL_AZ_DF, 
                                BDS_KPI_TOTAL_AO_DF) %>% 
  select(movimentos.fir, movimentos.ano, movimentos.total) %>%
  filter(movimentos.ano!='2018')

#MUDANDO O NOME DAS COLUNAS
COL.NAMES.TOTAL <- c("FIR","ANO", "TOTAL") 
colnames(TOTAL_MOV_SISC_FIR) <- COL.NAMES.TOTAL

#AJUSTES NA BDS PARA CRIAR O GRÁFICO
#case_when() substitui o nome dos itens

TOTAL_MOV_SISC_FIR <- TOTAL_MOV_SISC_FIR %>%
mutate(FIR = case_when(FIR == "BRASIL" ~ "SISCEAB",
                         FIR == "SBBS" ~ "FIR Brasília",
                         FIR == "SBCW" ~ "FIR Curitiba",
                         FIR == "SBRE" ~ "FIR Recife",
                         FIR == "SBAZ" ~ "FIR Amazônica",
                         FIR == "SBAO" ~ "FIR Atlântico"), ANO=as.character(ANO)) %>%
  mutate(FIR= factor(FIR))


###
#BDS PARA MOVIMENTOS MENSAL POR FIR
#bind_rows()cola linhas de df diferentes
#transmute()cria ou modifica colunas e exclui as colunas que não foram usadas, diferente do mutate que mantem todas as #colunas

VAR_MES_FIR <- bind_rows(BDS_KPI_TOTAL_Brasil_DF, 
          BDS_KPI_TOTAL_BS_DF, 
          BDS_KPI_TOTAL_CW_DF, 
          BDS_KPI_TOTAL_RE_DF, 
          BDS_KPI_TOTAL_AZ_DF, 
          BDS_KPI_TOTAL_AO_DF) %>% 
  transmute(FIR=movimentos.fir,ANO=movimentos.ano,TOTAL=movimentos.total,
            JAN=movimentos.jan,
            FEV=movimentos.fev,
            MAR=movimentos.mar,
            ABR=movimentos.abr,
            MAI=movimentos.mai,
            JUN=movimentos.jun,
            JUL=movimentos.jul,
            AGO=movimentos.ago,
            SET=movimentos.set,
            OUT=movimentos.out,
            NOV=movimentos.nov,
            DEZ=movimentos.dez) %>% 
  pivot_longer(cols = JAN:DEZ,
               names_to = "MES",
               values_to = "MOV") %>% 
  mutate(MES=factor(MES,levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ"))) %>% 
  mutate(FIR = case_when(FIR == "BRASIL" ~ "SISCEAB",
                         FIR == "SBBS" ~ "FIR Brasília",
                         FIR == "SBCW" ~ "FIR Curitiba",
                         FIR == "SBRE" ~ "FIR Recife",
                         FIR == "SBAZ" ~ "FIR Amazônica",
                         FIR == "SBAO" ~ "FIR Atlântico"), ANO=as.character(ANO)) %>%
  mutate(FIR= factor(FIR, levels = c("FIR Brasília","FIR Curitiba","FIR Recife","FIR Amazônica","FIR Atlântico","SISCEAB")))
  

#########################################

#BDS PARA CRIAÇÃO DO GRÁFICO DE MOVIMENTOS DO ANO POR MES SISCEAB (04)


TOTAL_MOV_MES_SISCEAB <- BDS_KPI_TOTAL_Brasil_DF %>%
  select(movimentos.ano,movimentos.total:movimentos.dez) %>% 
  filter(movimentos.ano!='2018')
colnames(TOTAL_MOV_MES_SISCEAB) <- COL.NAMES.MOV

#AJUSTES NA BDS PARA CRIAR O GRÁFICO
TOTAL_MES_SISCEAB <- TOTAL_MOV_MES_SISCEAB %>%
  pivot_longer(cols = JAN:DEZ,
               names_to = "MES",
               values_to = "MOV") %>% 
  mutate(MES=factor(MES,levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ")), ANO=as.character(ANO))



#########################################
# BDS PARA CRIAÇÃO DO GRÁFICO DE DENSIDADE DO TRÁFEGO POR REGIONAL(05)

BDS_DENSIDADE <- BDS_KPI_DENSIDADE_DF %>% 
  filter(movimentos.ano == "2022") %>% 
  separate(movimentos.chave, into = c("FIR","CHAVE"), sep = "-") %>% 
  select(FIR, movimentos.ano,movimentos.percentual_ano, movimentos.jan:movimentos.dez) %>% 
  mutate(FIR = case_when(FIR == "BRASIL" ~ "SISCEAB",
                         FIR == "SBBS" ~ "CINDACTA I",
                         FIR == "SBCW" ~ "CINDACTA II",
                         FIR == "SBRE" ~ "CINDACTA III",
                         FIR == "SBAZ" ~ "CINDACTA IV",
                         FIR == "SBAO" ~ "FIR Atlântico",
                         FIR == "CRCEA" ~ "CRCEA-SE"))

COL.NAMES.DENSI <- c("FIR","ANO", "PERCENT.ANO","JAN","FEV","MAR","ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ")
colnames(BDS_DENSIDADE) <- COL.NAMES.DENSI

DENSIDADE_C1 <- BDS_DENSIDADE[5,3]
DENSIDADE_C2 <- BDS_DENSIDADE[6,3]
DENSIDADE_C3 <- BDS_DENSIDADE[7,3]
DENSIDADE_C4 <- BDS_DENSIDADE[4,3]
DENSIDADE_SISCEAB <- BDS_DENSIDADE[1,3]
DENSIDADE_CRCEA <- BDS_DENSIDADE[2,3]
DENSIDADE_AO <- BDS_DENSIDADE[3,3]

##########################################
#LAT LONG DOS MAPAS



VERTICES_SETORES_FIR_SET22 <- read_csv("data/VERTICES_RESTANTES.csv")




VERTICES_SBCW <- read_excel("data/VERTICES_SBCW.xlsx") %>% 
  mutate(REGIONAL= "CINDACTA II", DENSIDADE= DENSIDADE_C2)

VERTICES_SBAZ <- read_excel("data/VERTICES_SBAZ.xlsx") %>% 
  mutate(REGIONAL= "CINDACTA IV", DENSIDADE=DENSIDADE_C4)

VERTICES_SBBS <- read_excel("data/VERTICES_SBBS.xlsx") %>% 
  mutate(REGIONAL="CINDACTA I", DENSIDADE=DENSIDADE_C1)

VERTICES_CRCEA_SE <- read_excel("data/VERTICES_CRCEA_SE.xlsx") %>% 
  mutate(REGIONAL="CRCEA-SE", DENSIDADE=DENSIDADE_CRCEA)

VERTICES_SBRE <- read_excel("data/VERTICES_SBRE.xlsx") %>% 
  mutate(REGIONAL="CINDACTA III", DENSIDADE=DENSIDADE_C3)


VERTICES_SBAO_S1 <-read_csv("data/SBAO_S1.csv")
VERTICES_SBAO_S2 <-read_csv("data/SBAO_S2.csv")
VERTICES_SBAO_S3 <-read_csv("data/SBAO_S3.csv")

VERTICES_SBAO <- bind_rows(VERTICES_SBAO_S1,VERTICES_SBAO_S2,VERTICES_SBAO_S3)




# JURISDICAO <- bind_rows(VERTICES_SETORES_FIR_SET22,VERTICES_SBAO)


 JURISDICAO <- bind_rows(VERTICES_SBAZ,VERTICES_SBBS,VERTICES_SBCW,VERTICES_SBRE)


TEXTOJURISDIÇÃO <- data.frame(X=c(-16.34,-27.29,-9.23,-5.54,-20), Y=c(-49.14,-51.41,-39.29,-59.52,-70), 
                              VALOR=c(DENSIDADE_C1,DENSIDADE_C2,DENSIDADE_C3,DENSIDADE_C4, DENSIDADE_SISCEAB))#DF criado para gerar a legenda
TEXTOJURISDIÇÃOCRCEA <- data.frame(X=c(-25), Y=c(-35), VALOR=c(DENSIDADE_CRCEA))
LINHATEXTOJURISDIÇÃOCRCEA <- data.frame(x1=-35, x2= -45.45, y1=-25, y2= -23.33)  
CORESJURISDICAO <- c("#FFD700","#007FFF","#CC0000","#215E21","#4F2F4F","#E6E8FA") #cores do mapa

#############
#BDS PARA PONTUALIDADE

PBWG_BRA_punctuality_ADR3 <- read_csv("data/PBWG-BRA-punctuality_ADR3.csv")


  BDS_PONTUALIDADE_ARR <- PBWG_BRA_punctuality_ADR3 %>% 
    filter(PHASE =="ARR") %>% 
    separate(DATE,into =c("ANO", "M"), sep = "-") %>%
    group_by(APT_GROUP,APT_ICAO, ANO, PHASE) %>% 
     summarise(`(-1e+09.-60]`=sum(`(-1e+09.-60]`),
               `(-60.-55]`=sum(`(-60.-55]`),
               `(-55.-50]`=sum(`(-55.-50]`),
               `(-50.-45]`=sum(`(-50.-45]`),
               `(-45.-40]`=sum(`(-45.-40]`),
               `(-40.-35]`=sum(`(-40.-35]`),
               `(-35.-30]`=sum(`(-35.-30]`),
               `(-30.-25]`=sum(`(-30.-25]`),
               `(-25.-20]`=sum(`(-25.-20]`),
               `(-20.-15]`=sum(`(-20.-15]`),
               `(-15.-10]`=sum(`(-15.-10]`),
               `(-10.-5]`=sum(`(-10.-5]`),
               `(-5.0]`=sum(`(-5.0]`),
               `(0.5]`=sum(`(0.5]`),
               `(5.10]`=sum(`(5.10]`),
               `(10.15]`=sum(`(10.15]`),
               `(15.20]`=sum(`(15.20]`),
               `(20.25]`=sum(`(20.25]`),
               `(25.30]`=sum(`(25.30]`),
               `(30.35]`=sum(`(30.35]`),
               `(35.40]`=sum(`(35.40]`),
               `(40.45]`=sum(`(40.45]`),
               `(45.50]`=sum(`(45.50]`),
               `(50.55]`=sum(`(50.55]`),
               `(55.60]`=sum(`(55.60]`),
               `(60.1e+09]`=sum(`(60.1e+09]`),
               EARLY_M15M05=sum(EARLY_M15M05),
               EARLY_M05M00=sum(EARLY_M05M00), 
               LATE_P00P05=sum(LATE_P00P05),
               LATE_P05P15=sum(LATE_P05P15),
               WITHIN_M05P05=sum(WITHIN_M05P05),
               WITHIN_M15P15=sum(WITHIN_M15P15)) %>% 
    mutate(SOMA=`(-1e+09.-60]`+ `(-60.-55]`+
        `(-55.-50]`+ `(-50.-45]`+
        `(-45.-40]`+ `(-40.-35]`+
        `(-35.-30]`+ `(-30.-25]`+
        `(-25.-20]`+ `(-20.-15]`+
        `(-15.-10]`+`(-10.-5]`+
        `(-5.0]`+`(0.5]`+
        `(5.10]`+`(10.15]`+
        `(15.20]`+ `(20.25]`+
        `(25.30]`+ `(30.35]`+
        `(35.40]`+ `(40.45]`+
        `(45.50]`+ `(50.55]`+
        `(55.60]`+ `(60.1e+09]`,
      EARLY=(`(-1e+09.-60]`+ `(-60.-55]`+
           `(-55.-50]`+ `(-50.-45]`+
           `(-45.-40]`+ `(-40.-35]`+
           `(-35.-30]`+ `(-30.-25]`+
           `(-25.-20]`+ `(-20.-15]`)/SOMA,
           EARLY_15_5=(`(-15.-10]`+`(-10.-5]`)/SOMA,
           WITHIN_5=(`(-5.0]`+`(0.5]`)/SOMA,
           LATE_5_15=(`(5.10]`+`(10.15]`)/SOMA,
           LATE=(`(15.20]`+ `(20.25]`+
           `(25.30]`+ `(30.35]`+
           `(35.40]`+ `(40.45]`+
           `(45.50]`+ `(50.55]`+
           `(55.60]`+ `(60.1e+09]`)/SOMA)%>% 
    pivot_longer(cols = EARLY:LATE
                        , names_to = "SLOT"
                        , values_to = "FLIGHTS") %>% 
    mutate(SLOT= case_when(SLOT=="EARLY"~"Adiantado > 15 min",
                           SLOT=="EARLY_15_5"~"Adiantado de -15 min a -5 min",
                           SLOT=="WITHIN_5"~"Pontual de -5 min a +5 min",
                           SLOT=="LATE_5_15"~"Atrasado de +5 min a +15 min",
                           SLOT=="LATE"~"Atrasado > 15 min")) %>% 
mutate(SLOT=factor(SLOT, levels = c("Adiantado > 15 min",
                                    "Adiantado de -15 min a -5 min",
                                    "Pontual de -5 min a +5 min",
                                    "Atrasado de +5 min a +15 min",
                                    "Atrasado > 15 min")))%>%
    mutate(APT_ICAO=factor(APT_ICAO, levels = c("SBBR","SBCF","SBCG","SBCT","SBFI","SBFL","SBPA",
                                      "SBFZ","SBMO","SBPS","SBRF","SBSV","SBBE","SBCY","SBEG",
                                      "SBGL","SBGR","SBKP","SBRJ","SBSP")))
  
  #conjunto de cores para o gráfico de pontualidade
  
CORESPONT <- c("#1E90FF","#87CEFA","#FFDAB9","#FF8C00","#FF0000")
  
######
  
  BDS_PONTUALIDADE_DEP <- PBWG_BRA_punctuality_ADR3 %>% 
  filter(PHASE =="DEP") %>% 
  separate(DATE,into =c("ANO", "M"), sep = "-") %>%
  group_by(APT_GROUP,APT_ICAO, ANO, PHASE) %>% 
  summarise(`(-1e+09.-60]`=sum(`(-1e+09.-60]`),
            `(-60.-55]`=sum(`(-60.-55]`),
            `(-55.-50]`=sum(`(-55.-50]`),
            `(-50.-45]`=sum(`(-50.-45]`),
            `(-45.-40]`=sum(`(-45.-40]`),
            `(-40.-35]`=sum(`(-40.-35]`),
            `(-35.-30]`=sum(`(-35.-30]`),
            `(-30.-25]`=sum(`(-30.-25]`),
            `(-25.-20]`=sum(`(-25.-20]`),
            `(-20.-15]`=sum(`(-20.-15]`),
            `(-15.-10]`=sum(`(-15.-10]`),
            `(-10.-5]`=sum(`(-10.-5]`),
            `(-5.0]`=sum(`(-5.0]`),
            `(0.5]`=sum(`(0.5]`),
            `(5.10]`=sum(`(5.10]`),
            `(10.15]`=sum(`(10.15]`),
            `(15.20]`=sum(`(15.20]`),
            `(20.25]`=sum(`(20.25]`),
            `(25.30]`=sum(`(25.30]`),
            `(30.35]`=sum(`(30.35]`),
            `(35.40]`=sum(`(35.40]`),
            `(40.45]`=sum(`(40.45]`),
            `(45.50]`=sum(`(45.50]`),
            `(50.55]`=sum(`(50.55]`),
            `(55.60]`=sum(`(55.60]`),
            `(60.1e+09]`=sum(`(60.1e+09]`),
            EARLY_M15M05=sum(EARLY_M15M05),
            EARLY_M05M00=sum(EARLY_M05M00), 
            LATE_P00P05=sum(LATE_P00P05),
            LATE_P05P15=sum(LATE_P05P15),
            WITHIN_M05P05=sum(WITHIN_M05P05),
            WITHIN_M15P15=sum(WITHIN_M15P15)) %>% 
  mutate(SOMA=`(-1e+09.-60]`+ `(-60.-55]`+
           `(-55.-50]`+ `(-50.-45]`+
           `(-45.-40]`+ `(-40.-35]`+
           `(-35.-30]`+ `(-30.-25]`+
           `(-25.-20]`+ `(-20.-15]`+
           `(-15.-10]`+`(-10.-5]`+
           `(-5.0]`+`(0.5]`+
           `(5.10]`+`(10.15]`+
           `(15.20]`+ `(20.25]`+
           `(25.30]`+ `(30.35]`+
           `(35.40]`+ `(40.45]`+
           `(45.50]`+ `(50.55]`+
           `(55.60]`+ `(60.1e+09]`,
         EARLY=(`(-1e+09.-60]`+ `(-60.-55]`+
                  `(-55.-50]`+ `(-50.-45]`+
                  `(-45.-40]`+ `(-40.-35]`+
                  `(-35.-30]`+ `(-30.-25]`+
                  `(-25.-20]`+ `(-20.-15]`)/SOMA,
         EARLY_15_5=(`(-15.-10]`+`(-10.-5]`)/SOMA,
         WITHIN_5=(`(-5.0]`+`(0.5]`)/SOMA,
         LATE_5_15=(`(5.10]`+`(10.15]`)/SOMA,
         LATE=(`(15.20]`+ `(20.25]`+
                 `(25.30]`+ `(30.35]`+
                 `(35.40]`+ `(40.45]`+
                 `(45.50]`+ `(50.55]`+
                 `(55.60]`+ `(60.1e+09]`)/SOMA)%>% 
  pivot_longer(cols = EARLY:LATE
               , names_to = "SLOT"
               , values_to = "FLIGHTS") %>% 
  mutate(SLOT= case_when(SLOT=="EARLY"~"Adiantado > 15 min",
                           SLOT=="EARLY_15_5"~"Adiantado de -15 min a -5 min",
                           SLOT=="WITHIN_5"~"Pontual de -5 min a +5 min",
                           SLOT=="LATE_5_15"~"Atrasado de +5 min a +15 min",
                           SLOT=="LATE"~"Atrasado > 15 min")) %>% 
mutate(SLOT=factor(SLOT, levels = c("Adiantado > 15 min",
                                    "Adiantado de -15 min a -5 min",
                                    "Pontual de -5 min a +5 min",
                                    "Atrasado de +5 min a +15 min",
                                    "Atrasado > 15 min")))%>%
  mutate(APT_ICAO=factor(APT_ICAO, levels = c("SBBR","SBCF","SBCG","SBCT","SBFI","SBFL","SBPA",
                                      "SBFZ","SBMO","SBPS","SBRF","SBSV","SBBE","SBCY","SBEG",
                                      "SBGL","SBGR","SBKP","SBRJ","SBSP")))




###########
#BDS ATCO

EVOLUCAO_ATCO <- read_excel("data/EVOLUCAO_ATCO.xlsx") %>% 
  pivot_longer(cols=ATCO_OPERACIONAL:ATCO_NAO_OPERACIONAL,names_to = "OPERACIONALIDADE",values_to = "QTD")



#####################
# EPLIS

EPLIS <- read_excel("data/EPLIS.xlsx") %>% 
  mutate(PCT=QTD/sum(QTD))


BDS_KPI_TOTAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Total")
BDS_KPI_TOTAL_TEXT <- content(BDS_KPI_TOTAL, "text")
BDS_KPI_TOTAL_JSON <- fromJSON(BDS_KPI_TOTAL_TEXT,flatten = TRUE)
BDS_KPI_TOTAL_DF <- as.data.frame(BDS_KPI_TOTAL_JSON)


##########################################
BDS_KPI_COMER <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Comercial")
BDS_KPI_COMER_TEXT <- content(BDS_KPI_COMER, "text")
BDS_KPI_COMER_JSON <- fromJSON(BDS_KPI_COMER_TEXT,flatten = TRUE)
BDS_KPI_COMER_DF <- as.data.frame(BDS_KPI_COMER_JSON)
BDS.COMER <- BDS_KPI_COMER_DF %>% select(movimentos.ano, movimentos.aero: movimentos.dez) %>% 
  mutate(TIPO= "Comercial",REGIONAL = case_when(movimentos.aero=="SBBE"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBBI"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBBR"~"CINDACTA I",
                                                                                                                                      movimentos.aero=="SBCF"~"CINDACTA I",
                                                                                                                                      movimentos.aero=="SBCG"~"CINDACTA I",
                                                                                                                                      movimentos.aero=="SBCO"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBCT"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBCY"~"CINDACTA I",
                                                                                                                                      movimentos.aero=="SBEG"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBFI"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBFL"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBBE"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBFN"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBFZ"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBGL"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBGR"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBKP"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBME"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBMN"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBMO"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBMT"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBNT"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBPA"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBPS"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBSV"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBPV"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBRB"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBRF"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBRJ"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBSC"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBSJ"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBSL"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBSM"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBSP"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBYS"~"CINDACTA I"))


BDS_KPI_GERAL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Geral")
BDS_KPI_GERAL_TEXT <- content(BDS_KPI_GERAL, "text")
BDS_KPI_GERAL_JSON <- fromJSON(BDS_KPI_GERAL_TEXT,flatten = TRUE)
BDS_KPI_GERAL_DF <- as.data.frame(BDS_KPI_GERAL_JSON)
BDS.GERAL <- BDS_KPI_GERAL_DF %>% select(movimentos.ano, movimentos.aero: movimentos.dez) %>% mutate(TIPO= "Geral",REGIONAL = case_when(movimentos.aero=="SBBE"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBBI"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBBR"~"CINDACTA I",
                                                                                                                                      movimentos.aero=="SBCF"~"CINDACTA I",
                                                                                                                                      movimentos.aero=="SBCG"~"CINDACTA I",
                                                                                                                                      movimentos.aero=="SBCO"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBCT"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBCY"~"CINDACTA I",
                                                                                                                                      movimentos.aero=="SBEG"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBFI"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBFL"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBBE"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBFN"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBFZ"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBGL"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBGR"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBKP"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBME"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBMN"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBMO"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBMT"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBNT"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBPA"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBPS"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBSV"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBPV"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBRB"~"CINDACTA IV",
                                                                                                                                      movimentos.aero=="SBRF"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBRJ"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBSC"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBSJ"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBSL"~"CINDACTA III",
                                                                                                                                      movimentos.aero=="SBSM"~"CINDACTA II",
                                                                                                                                      movimentos.aero=="SBSP"~"CRCEA-SE",
                                                                                                                                      movimentos.aero=="SBYS"~"CINDACTA I"))



BDS_KPI_MIL <- GET("http://siatfm.cgna.intraer/api/performance?apiUser=silveiralss&apiToken=7a11719421134986058a25ea58a3b002e2c185d5&area=Militar")
BDS_KPI_MIL_TEXT <- content(BDS_KPI_MIL, "text")
BDS_KPI_MIL_JSON <- fromJSON(BDS_KPI_MIL_TEXT,flatten = TRUE)
BDS_KPI_MIL_DF <- as.data.frame(BDS_KPI_MIL_JSON)
BDS.MIL <- BDS_KPI_MIL_DF %>% select(movimentos.ano, movimentos.aero: movimentos.dez) %>% mutate(TIPO= "Militar",REGIONAL = case_when(movimentos.aero=="SBBE"~"CINDACTA IV",
                                                                                                                      movimentos.aero=="SBBI"~"CINDACTA II",
                                                                                                                      movimentos.aero=="SBBR"~"CINDACTA I",
                                                                                                                      movimentos.aero=="SBCF"~"CINDACTA I",
                                                                                                                      movimentos.aero=="SBCG"~"CINDACTA I",
                                                                                                                      movimentos.aero=="SBCO"~"CINDACTA II",
                                                                                                                      movimentos.aero=="SBCT"~"CINDACTA II",
                                                                                                                      movimentos.aero=="SBCY"~"CINDACTA I",
                                                                                                                      movimentos.aero=="SBEG"~"CINDACTA IV",
                                                                                                                      movimentos.aero=="SBFI"~"CINDACTA II",
                                                                                                                      movimentos.aero=="SBFL"~"CINDACTA II",
                                                                                                                      movimentos.aero=="SBBE"~"CINDACTA IV",
                                                                                                                      movimentos.aero=="SBFN"~"CINDACTA III",
                                                                                                                      movimentos.aero=="SBFZ"~"CINDACTA III",
                                                                                                                      movimentos.aero=="SBGL"~"CRCEA-SE",
                                                                                                                      movimentos.aero=="SBGR"~"CRCEA-SE",
                                                                                                                      movimentos.aero=="SBKP"~"CRCEA-SE",
                                                                                                                      movimentos.aero=="SBME"~"CINDACTA II",
                                                                                                                      movimentos.aero=="SBMN"~"CINDACTA IV",
                                                                                                                      movimentos.aero=="SBMO"~"CINDACTA III",
                                                                                                                      movimentos.aero=="SBMT"~"CRCEA-SE",
                                                                                                                      movimentos.aero=="SBNT"~"CINDACTA III",
                                                                                                                      movimentos.aero=="SBPA"~"CINDACTA II",
                                                                                                                      movimentos.aero=="SBPS"~"CINDACTA III",
                                                                                                                      movimentos.aero=="SBSV"~"CINDACTA III",
                                                                                                                      movimentos.aero=="SBPV"~"CINDACTA IV",
                                                                                                                      movimentos.aero=="SBRB"~"CINDACTA IV",
                                                                                                                      movimentos.aero=="SBRF"~"CINDACTA III",
                                                                                                                      movimentos.aero=="SBRJ"~"CRCEA-SE",
                                                                                                                      movimentos.aero=="SBSC"~"CINDACTA II",
                                                                                                                      movimentos.aero=="SBSJ"~"CRCEA-SE",
                                                                                                                      movimentos.aero=="SBSL"~"CINDACTA III",
                                                                                                                      movimentos.aero=="SBSM"~"CINDACTA II",
                                                                                                                      movimentos.aero=="SBSP"~"CRCEA-SE",
                                                                                                                      movimentos.aero=="SBYS"~"CINDACTA I"))





PARTICIPACAO.AERO <- bind_rows(BDS.MIL, BDS.GERAL,BDS.COMER) %>% 
  group_by(movimentos.ano, REGIONAL, TIPO, movimentos.aero) %>% 
  summarise(TOTAL=sum(movimentos.total),
            JAN=sum(movimentos.jan),
            FEV=sum(movimentos.fev),
            MAR= sum(movimentos.mar),
            ABR=sum(movimentos.abr),
            MAI=sum(movimentos.mai),
            JUN=sum(movimentos.jun),
            JUL=sum(movimentos.jul),
            AGO=sum(movimentos.ago),
            SET=sum(movimentos.set),
            OUT=sum(movimentos.out),
            NOV=sum(movimentos.nov),
            DEZ=sum(movimentos.dez))

PARTICIPACAO.TOTAL <- bind_rows(BDS.MIL, BDS.GERAL,BDS.COMER) %>% 
  group_by(movimentos.ano, REGIONAL, TIPO) %>% 
  summarise(QTD=sum(movimentos.total),
            JAN=sum(movimentos.jan),
            FEV=sum(movimentos.fev),
            MAR= sum(movimentos.mar),
            ABR=sum(movimentos.abr),
            MAI=sum(movimentos.mai),
            JUN=sum(movimentos.jun),
            JUL=sum(movimentos.jul),
            AGO=sum(movimentos.ago),
            SET=sum(movimentos.set),
            OUT=sum(movimentos.out),
            NOV=sum(movimentos.nov),
            DEZ=sum(movimentos.dez)) %>% 
  select(movimentos.ano, REGIONAL,TIPO, QTD) %>% 
  mutate(TOTAL=sum(QTD)) %>% 
  mutate(PRC=round(QTD/TOTAL,digits = 2))

#####################################################

VERTICES_TMA_BRASIL <- read_excel("data/VERTICES_TMA_BRASIL.xlsx")

TMA_SBWA <- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWA")
TMA_SBWQ<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWQ")
TMA_SBWN<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWN")
TMA_SBWX<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWX")
TMA_SBXK<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXK")
TMA_SBWB<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWB")
TMA_SBXJ<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXJ")
TMA_SBXD<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXD")
TMA_SBWS<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWS")
TMA_SBXE<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXE")
TMA_SBWZ<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWZ")
TMA_SBXT<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXT")
TMA_SBWF<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWF")
TMA_SBXM<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXM")
TMA_SBXA<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXA")
TMA_SBXS<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXS")
TMA_SBWL<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWL")
TMA_SBWK<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWK")
TMA_SBWR<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWR")
TMA_SBXW<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXW")
TMA_SBXU<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXU")
TMA_SBWH<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWH")
TMA_SBXR<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXR")
TMA_SBWE<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWE")
TMA_SBWJ<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWJ")
TMA_SBXQ<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXQ")
TMA_SBWU<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWU")
TMA_SBXO<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXO")
TMA_SBXG<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXG")
TMA_SBXP<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXP")
TMA_SBWT<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWT")
TMA_SBXF<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXF")
TMA_SBWP<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWP")
TMA_SBWM<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWM")
TMA_SBXL<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXL")
TMA_SBWI<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWI")
TMA_SBXN<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXN")
TMA_SBWG<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWG")
TMA_SBWY<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWY")
TMA_SBWV<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBWV")
TMA_SBXB<- VERTICES_TMA_BRASIL %>% dplyr::filter(ident == "SBXB")


####################
#bds do gráfico de média móvel 

Dados_Base34_2022 <- read_excel("data/Dados_Base34_2022.xlsx", 
                                col_types = c("date", "text", "numeric"))


```


```{r echo=FALSE, message=FALSE, warning=FALSE}

ANO.RELATORIO <- year(Sys.Date())-1

```





# 2 GRÁFICO MOVIMENTO DA AVIAÇÃO COMERCIAL DOMÉSTICA

```{r echo=FALSE, warning=FALSE, message=FALSE,fig.width=15,fig.height=8}
#gráfico MOVIMENTO DA AVIAÇÃO COMERCIAL DOMÉSTICA (1)
#AJUSTAR A BDS PARA REPLICAR O GRÁFICO PARA OUTROS ANOS

BDS_VAR_2019_DOM <- MOV_COM_DOMESTC %>% filter(ANO %in% c(2019), MES=="JAN")
BDS_VAR_2022_DOM <- MOV_COM_DOMESTC %>% filter(ANO %in% c(ANO.RELATORIO), MES=="JAN")
BDS_VAR_ANO_DOM <- bind_rows(BDS_VAR_2019_DOM,BDS_VAR_2022_DOM) %>% 
  transmute(ANO=ANO, TOTAL=TOTAL,VAR=(BDS_VAR_2022_DOM$TOTAL-BDS_VAR_2019_DOM$TOTAL)/BDS_VAR_2019_DOM$TOTAL)

GFVARANO <-  ggplot(BDS_VAR_ANO_DOM)+                                                                                                 
  geom_col(aes(x=ANO, y=TOTAL, fill = ANO),width = .9, position = position_dodge(preserve = "single"))+                
  scale_y_continuous(limits = c(0,1500000),labels = comma_format(big.mark = "."))+ 
  scale_x_discrete(expand = expansion(add = .7))+
  geom_richtext(aes(x=ANO, y=290000, label= format(TOTAL,big.mark="."), group=ANO),size=5.5, position = position_dodge(width = .9), angle=90)+
  theme_classic() + 
  theme(panel.background=element_rect(fill = "#F0F8FF")
  ) +
  labs(caption = "  ", x = NULL, y = NULL   
  ) +
  theme(legend.position = "none",
        plot.caption = element_text(size = 28))+
  scale_fill_manual(values = cores)                 




GFVARMES <- 
  MOV_COM_DOMESTC %>% filter(ANO %in% c(2019, ANO.RELATORIO)) %>%
  ggplot()+
  geom_col(aes(x=MES, y=MOV, fill = ANO), position = position_dodge(preserve = "single"))+
  scale_y_continuous(limits = c(0,150000),labels = comma_format(big.mark = ".")) +
  coord_cartesian(xlim = c(1,12))+
  geom_richtext(aes(x=MES, y=ifelse(MOV>99999,30000,28500), label = ifelse(MOV>999,format(MOV,big.mark="."),MOV), group=ANO),size=3, position = position_dodge(width = .9), angle=90)+
    theme_classic()+
  theme(legend.title    = element_text(size = 8) 
        ,legend.text     = element_text(size = 14)
        ,legend.key.size = unit(0.5, "cm")
  ) +
  labs(x = NULL, y = "Movimentos - aviação comercial doméstica"
       ,fill = "ANO") +
  theme(legend.position = "bottom",
        legend.title=element_blank(),
        axis.title.y = element_text(size = 15))+
  scale_fill_manual(values = cores)


#######################
MOV_COM_DOM_VAR <-    MOV_COM_DOM %>% 
  transmute(ANO = MES,VAR=VAR) %>% 
  mutate(ANO= factor(ANO, levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ")),
         COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0)))


  
GFVARDOM_MES <- 
    ggplot(MOV_COM_DOM_VAR)+
  geom_col(aes(x = ANO, y = VAR, fill = COR), 
           na.rm = TRUE, color = "black",width = 0.30) +
  theme_minimal()+
  geom_hline(yintercept = 0) +
  scale_y_continuous(limits=c(-.3,.3),labels = scales::label_percent(scale = 100))+
    scale_x_discrete(breaks = NULL)+
  coord_cartesian(xlim = c(1,12))+
  guides(fill = FALSE) +
    geom_text(aes(x = ANO, y = VAR, label=scales::percent(VAR,accuracy = 0.1),vjust = ifelse(VAR < 0, 1.25, -0.25)),size= 3)+
  labs(title= "Mensal",x = NULL, y = "Var. 2019/2022") +
  scale_fill_manual(values = c("firebrick", "dodgerblue4"))+
    theme(panel.spacing = unit(1, "cm", data = NULL),
          plot.title = element_text(size = 18,
                                    face = "bold",
                                    hjust = 0.5),
          axis.title.y = element_text(size = 15))


GFVARDOM_ANO <- 
  ggplot(BDS_VAR_ANO_DOM %>% filter(ANO==ANO.RELATORIO) %>% 
                                      mutate(COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0))))+
  geom_col(aes(x = ANO, y = VAR, fill = COR), 
           na.rm = TRUE, color = "black",width = 0.3) +
  theme_minimal()+
  geom_hline(yintercept = 0) +
  scale_y_continuous(breaks=NULL,limits=c(-.4,.4),labels = scales::label_percent(scale = 100))+
  scale_x_discrete(breaks = NULL,expand = expansion(add = 1.5))+
  guides(fill = FALSE) +
  geom_text(aes(x = ANO, y = VAR, label=scales::percent(VAR,accuracy = 0.1),vjust = ifelse(VAR < 0, 1.25, -0.25)),size=3)+
  labs(title= "Anual",x = NULL, y = NULL) +
  scale_fill_manual(values = c("firebrick","dodgerblue4"))+
  theme(panel.spacing = unit(1, "cm", data = NULL),
        plot.title = element_text(size = 18,
                                  face = "bold",
                                  hjust = 0.5))
  
  grid.arrange(GFVARDOM_MES,GFVARDOM_ANO,GFVARMES,GFVARANO, ncol=2,widths=c(4,1),heights= c(1.4,4)) %>% 
ggsave(filename = "imagens/gf1.png", height = 18,width=25, units = "cm")

```


#3 GRÁFICO MOVIMENTO AVIAÇÃO COMERCIAL INTERNACIONAL

```{r echo=FALSE, warning=FALSE, message=FALSE,fig.width=15,fig.height=8}

#GRÁFICO MOVIMENTO AVIAÇÃO COMERCIAL INTERNACIONAL (2)
#AJUSTAR A BDS PARA REPLICAR O GRÁFICO PARA OUTROS ANOS

BDS_VAR_2019_INT <- MOV_COM_INT %>% filter(ANO %in% c(2019), MES=="JAN")
BDS_VAR_2022_INT <- MOV_COM_INT %>% filter(ANO %in% c(ANO.RELATORIO), MES=="JAN")
BDS_VAR_ANO_INT <- bind_rows(BDS_VAR_2019_INT,BDS_VAR_2022_INT) %>% 
  transmute(ANO=ANO, TOTAL=TOTAL,VAR=(BDS_VAR_2022_INT$TOTAL-BDS_VAR_2019_INT$TOTAL)/BDS_VAR_2019_INT$TOTAL) 

GFVARANO_INT <-  
  ggplot(BDS_VAR_ANO_INT)+                                                                                                 
  geom_col(aes(x=ANO, y=TOTAL, fill = ANO),width = .9, position = position_dodge(preserve = "single"))+                
  scale_y_continuous(limits = c(0,180000),labels = comma_format(big.mark = "."))+ 
  scale_x_discrete(expand = expansion(add = .7))+
  geom_richtext(aes(x=ANO, y=ifelse(TOTAL>99999,32000,30000), label= format(TOTAL,big.mark="."), group=ANO),size=5.5, position = position_dodge(width = .9), angle=90)+
  theme_classic() + 
  theme(panel.background=element_rect(fill = "#F0F8FF")
  ) +
  labs(caption = "  ", x = NULL, y = NULL   
  ) +
  theme(legend.position = "none",
        plot.caption = element_text(size = 34))+
  scale_fill_manual(values = cores)


  GFVARMES_INT <- 
    MOV_COM_INT %>% filter(ANO %in% c(2019, ANO.RELATORIO)) %>%
    ggplot()+
    geom_col(aes(x=MES, y=MOV, fill = ANO), position = position_dodge(preserve = "single"))+
    scale_y_continuous(limits = c(0,16000),labels = comma_format(big.mark = ".")) +
    coord_cartesian(xlim = c(1,12))+
    geom_richtext(aes(x=MES, y=ifelse(MOV>9999,3000,2800), label = ifelse(MOV>999,format(MOV,big.mark="."),MOV), group=ANO),size=3, position = position_dodge(width = .9), angle=90)+
    theme_classic()+
    theme(legend.title    = element_text(size = 8) 
          ,legend.text     = element_text(size = 14)
          ,legend.key.size = unit(0.5, "cm")
    ) +
    labs( x = NULL, y = "Movimentos - aviação comercial internacional"
         ,fill = "ANO") +
    theme(legend.position = "bottom",
          legend.title=element_blank(),
          axis.title.y = element_text(size = 15))+
    scale_fill_manual(values = cores)             



    MOV_COM_INT_VAR2 <-    MOV_COM_INT_VAR %>% 
      transmute(ANO = MES,VAR=VAR) %>% 
      mutate(ANO= factor(ANO, levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ")),
             COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0)))
    
    
    
    GFVARINT_MES <- 
      ggplot(MOV_COM_INT_VAR2)+
      geom_col(aes(x = ANO, y = VAR, fill = COR), 
               na.rm = TRUE, color = "black",width = 0.30) +
      theme_minimal()+
      geom_hline(yintercept = 0) +
      scale_y_continuous(limits=c(-.6,.6),labels = scales::label_percent(scale = 100))+
      scale_x_discrete(breaks = NULL)+
      coord_cartesian(xlim = c(1,12))+
      guides(fill = FALSE) +
      geom_text(aes(x = ANO, y = VAR, label=scales::percent(VAR,accuracy = 0.1),vjust = ifelse(VAR < 0, 1.25, -0.25)),size= 3)+
      labs(title= "Mensal",x = NULL, y = "Var. 2019/2022") +
      scale_fill_manual(values = c("firebrick", "dodgerblue4"))+
      theme(panel.spacing = unit(1, "cm", data = NULL),
            plot.title = element_text(size = 18,
                                      face = "bold",
                                      hjust = 0.5),
            axis.title.y = element_text(size = 15))
    
    
    GFVARINT_ANO <- 
      ggplot(BDS_VAR_ANO_INT %>% filter(ANO==ANO.RELATORIO) %>% 
               mutate(COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0))))+
      geom_col(aes(x = ANO, y = VAR, fill = COR), 
               na.rm = TRUE, color = "black",width = 0.30) +
      theme_minimal()+
      geom_hline(yintercept = 0) +
      scale_y_continuous(breaks=NULL,limits=c(-.6,.6),labels = scales::label_percent(scale = 100))+
      scale_x_discrete(breaks = NULL,expand = expansion(add = 1.5))+
      guides(fill = FALSE) +
      geom_text(aes(x = ANO, y = VAR, label=scales::percent(VAR,accuracy = 0.1),vjust = ifelse(VAR < 0, 1.25, -0.25)),size=3)+
      labs(title= "Anual",x = NULL, y = NULL) +
      scale_fill_manual(values = c("firebrick", "dodgerblue4"))+
      theme(panel.spacing = unit(1, "cm", data = NULL),
            plot.title = element_text(size = 18,
                                      face = "bold",
                                      hjust = 0.5))
    
    grid.arrange(GFVARINT_MES,GFVARINT_ANO,GFVARMES_INT,GFVARANO_INT, ncol=2,widths=c(4,1),heights= c(1.4,4)) %>% 
ggsave(filename = "imagens/gf2.png",height = 18,width=25, units = "cm")

```



# 4 GRÁFICO DE MOVIMENTO DA AVIAÇÃO GERAL

```{r echo=FALSE, message=FALSE, warning=FALSE}

BDS_VAR_2019_GERAL <- MOV_GERAL %>% filter(ANO %in% c(2019), MES=="JAN")
BDS_VAR_2022_GERAL <- MOV_GERAL %>% filter(ANO %in% c(ANO.RELATORIO), MES=="JAN")
BDS_VAR_ANO_GERAL <- bind_rows(BDS_VAR_2019_GERAL,BDS_VAR_2022_GERAL) %>% 
  transmute(ANO=as.factor(ANO), TOTAL=TOTAL,VAR=(BDS_VAR_2022_GERAL$TOTAL-BDS_VAR_2019_GERAL$TOTAL)/BDS_VAR_2019_GERAL$TOTAL)

BDS_GERAL_VAR <- bind_cols(MOV_GERAL %>% filter(ANO %in% c(2019)),MOV_GERAL %>% filter(ANO %in% c(ANO.RELATORIO)) %>% select(MOV)) %>% 
  transmute(TOTAL=TOTAL,ANO=MES,MOV19=MOV...4,MOV22=MOV...5) %>% mutate(VAR= (MOV22-MOV19)/MOV19)%>% 
  mutate(ANO= factor(ANO, levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ")),
         COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0)))



GFVARANO_GERAL <-  
  ggplot(BDS_VAR_ANO_GERAL)+                                                                                                 
  geom_col(aes(x=ANO, y=TOTAL, fill = ANO),width = .9, position = position_dodge(preserve = "single"))+                
  scale_y_continuous(labels = comma_format(big.mark = "."))+ 
  scale_x_discrete(expand = expansion(add = .7))+
  geom_richtext(aes(x=ANO, y=78000, label= format(TOTAL,big.mark="."), group=ANO),size=5.5, position = position_dodge(width = .9), angle=90)+
  theme_classic() + 
  theme(panel.background=element_rect(fill = "#F0F8FF")
  ) +
  labs(caption = "  ", x = NULL, y = NULL   
  ) +
  theme(legend.position = "none",
        plot.caption = element_text(size = 28))+
  scale_fill_manual(values = cores)


GFVARMES_GERAL <- 
  MOV_GERAL %>% filter(ANO %in% c(2019, ANO.RELATORIO)) %>%
  ggplot()+
  geom_col(aes(x=MES, y=MOV, fill = ANO), position = position_dodge(preserve = "single"))+
  scale_y_continuous(labels = comma_format(big.mark = ".")) +
  coord_cartesian(xlim = c(1,12))+
  geom_richtext(aes(x=MES, y=8000, label = ifelse(MOV>999,format(MOV,big.mark="."),MOV), group=ANO),size=3, position = position_dodge(width = .9), angle=90)+
  theme_classic()+
  theme(legend.title    = element_text(size = 8)
        ,legend.text     = element_text(size = 12)
        ,legend.key.size = unit(0.3, "cm"),
        axis.title.y = element_text(size = 15)
  ) +
  labs( x = NULL, y = "Movimentos - aviação geral"
       ,fill = "ANO") +
  theme(legend.position = "bottom",
        legend.title=element_blank(),
        plot.caption = element_text(hjust = .65,
                                    face = "bold"))+
  scale_fill_manual(values = cores)             







GFVARGERAL_MES <- 
  ggplot(BDS_GERAL_VAR)+
  geom_col(aes(x = ANO, y = VAR, fill = COR), 
           na.rm = TRUE, color = "black",width = 0.30) +
  theme_minimal()+
  geom_hline(yintercept = 0) +
  scale_y_continuous(limits=c(-.3,.3),labels = scales::label_percent(scale = 100))+
  scale_x_discrete(breaks = NULL)+
  coord_cartesian(xlim = c(1,12))+
  guides(fill = FALSE) +
  geom_text(aes(x = ANO, y = VAR, label=scales::percent(VAR,accuracy = 0.1),vjust = ifelse(VAR < 0, 1.25, -0.25)),size= 3)+
  labs(title= "Mensal",x = NULL, y = "Var. 2019/2022") +
  scale_fill_manual(values = c("firebrick", "dodgerblue4"))+
  theme(panel.spacing = unit(1, "cm", data = NULL),
        plot.title = element_text(size = 18,
                                  face = "bold",
                                  hjust = 0.5),
        axis.title.y = element_text(size = 15))



GFVARGERAL_ANO <- 
  ggplot(BDS_VAR_ANO_GERAL %>% filter(ANO==ANO.RELATORIO) %>% 
           mutate(COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0))))+
  geom_col(aes(x = ANO, y = VAR, fill = COR), 
           na.rm = TRUE, color = "black",width = 0.30) +
  theme_minimal()+
  geom_hline(yintercept = 0) +
  scale_y_continuous(breaks=NULL,limits=c(-1.5,1.5),labels = scales::label_percent(scale = 100))+
  scale_x_discrete(breaks = NULL,expand = expansion(add = 1.5))+
  guides(fill = FALSE) +
  geom_text(aes(x = ANO, y = VAR, label=scales::percent(VAR,accuracy = 0.1),vjust = ifelse(VAR < 0, 1.25, -0.25)),size=3.5)+
  labs(title= "Anual",x = NULL, y = NULL) +
  scale_fill_manual(values = c("dodgerblue4","firebrick"))+
  theme(panel.spacing = unit(1, "cm", data = NULL),
        plot.title = element_text(size = 18,
                                  face = "bold",
                                  hjust = 0.5))


grid.arrange(GFVARGERAL_MES,GFVARGERAL_ANO,GFVARMES_GERAL,GFVARANO_GERAL, ncol=2,widths=c(4,1),heights= c(1.4,4))%>% 
  ggsave(filename = "imagens/gf49.png",height = 18,width=25, units = "cm")



```




##4.1 GRÁFICO COMPARATIVO POR MÊS DE TOTAL DE OPERAÇÕES ARR E DEP NO SISCEAB

```{r echo=FALSE, warning=FALSE, message=FALSE,fig.width=15,fig.height=8}
#GRÁFICO COMPARATIVO POR MÊS DE TOTAL DE OPERAÇÕES ARR E DEP NO SISCEAB (03)
BDS_ANO_2019_SIS <- TOTAL_MES_SISCEAB %>% filter(ANO %in% c(2019), MES=="JAN")
BDS_ANO_2022_SIS <- TOTAL_MES_SISCEAB %>% filter(ANO %in% c(2022), MES=="JAN")
BDS_VAR_ANO_SIS <- bind_rows(BDS_ANO_2019_SIS,BDS_ANO_2022_SIS) %>% 
  transmute(ANO=ANO, TOTAL=TOTAL,VAR=(BDS_ANO_2022_SIS$TOTAL-BDS_ANO_2019_SIS$TOTAL)/BDS_ANO_2019_SIS$TOTAL)

GFVARANO_SIS <-  
ggplot(BDS_VAR_ANO_SIS)+                                                                                                 
  geom_col(aes(x=ANO, y=TOTAL, fill = ANO),width = .9, position = position_dodge(preserve = "single"))+                
  scale_y_continuous(limits = c(0,1700000),labels = comma_format(big.mark = "."))+ 
  scale_x_discrete(expand = expansion(add = .7))+
  geom_richtext(aes(x=ANO, y=300000, label= format(TOTAL,big.mark="."), group=ANO),size=5.5, position = position_dodge(width = .9), angle=90)+
  theme_classic() + 
  theme(panel.background=element_rect(fill = "#F0F8FF")
  ) +
  labs(caption = "  ", x = NULL, y = NULL   
  ) +
  theme(legend.position = "none",
        plot.caption = element_text(size = 28))+
  scale_fill_manual(values =cores)


GFVARMES_SIS <- 
TOTAL_MES_SISCEAB %>% filter(ANO %in% c(2019, 2022)) %>%
  ggplot()+
  geom_col(aes(x=MES, y=MOV, fill = ANO), position = position_dodge(preserve = "single"))+
  scale_y_continuous(limits = c(0,160000),labels = comma_format(big.mark = ".")) +
  coord_cartesian(xlim = c(1,12.5))+
  geom_richtext(aes(x=MES, y=32000, label = ifelse(MOV>999,format(MOV,big.mark="."),MOV) , group=ANO),size=3, position = position_dodge(width = .9), angle=90)+
  theme_classic()+
  theme(legend.title    = element_text(size = 8)
        ,legend.key.size = unit(0.3, "cm")
  ) +
  labs( x = NULL, y = "Movimentos - total SISCEAB"
       ,fill = "ANO") +
  theme(legend.position = "bottom",
        legend.title=element_blank(),
        legend.text = element_text(size = 14),
        axis.title.y = element_text(size = 15))+
  scale_fill_manual(values = cores)




 
TOTAL_MES_2019_SIS <- TOTAL_MES_SISCEAB %>% filter(ANO=="2019")
TOTAL_MES_2022_SIS <- TOTAL_MES_SISCEAB %>% filter(ANO=="2022")
TOTALMES_SIS <- bind_cols(TOTAL_MES_2019_SIS,TOTAL_MES_2022_SIS$MOV) %>% #FOI CRIADO O MOV_COM_DOM PARA CRIAR O LABEL DE VARIAÇÃO 
  transmute(ANO=ANO,TOTAL=TOTAL,MES=MES,MOV19=MOV,MOV22=...5) %>% mutate(VAR= (MOV22-MOV19)/MOV19)




MOV_VAR_SIS <-    TOTALMES_SIS %>% 
  transmute(ANO = MES,VAR=VAR) %>% 
  mutate(ANO= factor(ANO, levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ")),
         COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0)))



GFVARDOM_MES_SIS <- 
ggplot(MOV_VAR_SIS)+
  geom_col(aes(x = ANO, y = VAR, fill = COR), 
           na.rm = TRUE, color = "black",width = 0.30) +
  theme_minimal()+
  geom_hline(yintercept = 0) +
  scale_y_continuous(limits=c(-.3,.3),labels = scales::label_percent(scale = 100))+
  scale_x_discrete(breaks = NULL)+
  coord_cartesian(xlim = c(1,12.5))+
  guides(fill = FALSE) +
  geom_text(aes(x = ANO, y = VAR, label=scales::percent(VAR,accuracy = 0.1),vjust = ifelse(VAR < 0, 1.25, -0.25)),size= 3)+
  labs(title= "Mensal",x = NULL, y = "Var. 2019/2022") +
  scale_fill_manual(values = c("firebrick", "dodgerblue4"))+
  theme(panel.spacing = unit(1, "cm", data = NULL),
        plot.title = element_text(size = 18,
                                  face = "bold",
                                  hjust = 0.5),
        axis.title.y = element_text(size = 15))


GFVARDOM_ANO <- 
  ggplot(BDS_VAR_ANO_SIS %>% filter(ANO=="2022") %>% 
           mutate(COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0))))+
  geom_col(aes(x = ANO, y = VAR, fill = COR), 
           na.rm = TRUE, color = "black",width = 0.30) +
  theme_minimal()+
  geom_hline(yintercept = 0) +
  scale_y_continuous(breaks=NULL,limits=c(-.3,.3),labels = scales::label_percent(scale = 100))+
  scale_x_discrete(breaks = NULL,expand = expansion(add = 1.5))+
  guides(fill = FALSE) +
  geom_text(aes(x = ANO, y = VAR, label=scales::percent(VAR,accuracy = 0.1),vjust = ifelse(VAR < 0, 1.25, -0.25)),size=3)+
  labs(title= "Anual",x = NULL, y = NULL) +
  scale_fill_manual(values = c("dodgerblue4","firebrick"))+
  theme(panel.spacing = unit(1, "cm", data = NULL),
        plot.title = element_text(size = 18,
                                  face = "bold",
                                  hjust = 0.5))


  grid.arrange(GFVARDOM_MES_SIS,GFVARDOM_ANO,GFVARMES_SIS,GFVARANO_SIS, ncol=2,widths=c(4,1),heights= c(1.4,4)) %>% 
ggsave(filename = "imagens/gf3.png",height = 18,width=25, units = "cm")

```


#5 GRÁFICO DE MOVIMENTOS FIR

```{r echo=FALSE, warning=FALSE, message=FALSE,fig.width=15,fig.height=8}

#GRÁFICO DE MOVIMENTOS  FIR (4)



GFVAR_FIR <- 
  TOTAL_MOV_SISC_FIR%>% filter(ANO %in%c(2019,2022)& FIR!="SISCEAB")%>%
  mutate(FIR=factor(FIR,levels = c("SISCEAB","FIR Atlântico", "FIR Amazônica","FIR Recife", "FIR Curitiba","FIR Brasília"))) %>% 
  ggplot()+
  geom_col(aes(x=FIR, y=TOTAL, fill = ANO), position = "dodge", width = .3)+
  scale_y_continuous(breaks = NULL,limits = c(0,1200000))+
  
  geom_label(aes(x=FIR, y=900000,group=ANO, label = format(TOTAL, big.mark=".")), size = 3,
             hjust = 0.5,
             position = position_dodge(width = 0.3),angle = 90)+
  theme_minimal() +
  theme(legend.title    = element_text(size = 8) 
        ,legend.text     = element_text(size = 8)
        ,legend.key.size = unit(0.3, "cm")
  ) +
  labs(title = "Anual ", x = NULL, y = NULL
       ,fill = "ANO") +
  theme(legend.position = "bottom",
        legend.title=element_blank(),
        legend.text     = element_text(size = 14),
        plot.title = element_text(size = 15,
                                  face = "bold",
                                  hjust = 0.5))+
  scale_fill_manual(values = cores)+
  coord_flip()




BDS_ANO_2019_FIR <- TOTAL_MOV_SISC_FIR %>% filter(ANO %in% c(2019))
BDS_ANO_2022_FIR <- TOTAL_MOV_SISC_FIR %>% filter(ANO %in% c(2022))
BDS_VAR_ANO_FIR <- bind_cols(BDS_ANO_2019_FIR,BDS_ANO_2022_FIR) %>% 
  transmute(FIR=FIR...1, TOTAL19=TOTAL...3,TOTAL22= TOTAL...6, VAR=(TOTAL22-TOTAL19)/TOTAL19) %>% 
  mutate(COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0)))%>%
  mutate(FIR=factor(FIR,levels = c("SISCEAB","FIR Brasília", "FIR Curitiba", "FIR Recife", "FIR Amazônica","FIR Atlântico")))


GFVAR_FIR_ANO <- 
BDS_VAR_ANO_FIR %>% filter(FIR!="SISCEAB") %>%
  mutate(FIR=factor(FIR,levels = c("FIR Atlântico","FIR Amazônica","FIR Recife", "FIR Curitiba","FIR Brasília"))) %>%
  ggplot()+
  geom_col(aes(x = FIR, y = VAR, fill = COR), 
           na.rm = TRUE, color = "black",width = 0.20) +
  theme_void()+
  geom_hline(yintercept = 0) +
  scale_y_continuous(limits=c(-1.8,1.5),labels = scales::label_percent(scale = 100))+
  scale_x_discrete(breaks = NULL)+
  guides(fill = FALSE) +
  geom_text(aes(x = FIR, y = VAR, label=scales::percent(VAR,accuracy = 0.1),hjust = ifelse(VAR < 0, 1.25, -0.25)),size= 3.5)+
  labs(caption= "  ",title= "Var. 2019/2022",x = NULL, y = NULL) +
  scale_fill_manual(values = c("firebrick", "dodgerblue4"))+
  theme(plot.title = element_text(size = 15,
                                  face = "bold",
                                  hjust = 0.5),
        plot.caption = element_text(size = 31))+
  coord_flip()



GFVAR_FIR_MES <- 
VAR_MES_FIR %>% filter(ANO=="2022"&FIR!="SISCEAB") %>% 
  
  ggplot()+
  geom_line(aes(x=MES, y=MOV,group=FIR, color=FIR),size=1.1)+
  scale_y_continuous(labels = comma_format(big.mark = ".", decimal.mark = ","),breaks = seq(0, 60000, by = 5000), limits = c(0,58000))+
  scale_color_manual(values = CORESJURISDICAO)+
  theme_classic() +
  labs(title= "Mensal", x = NULL, y = "Movimentos - FIR"
       ,fill = NULL) +
  theme(legend.position = "bottom",
        legend.title=element_blank(),
        legend.key.size = unit(7,"mm"),
        legend.text     = element_text(size = 14),
        plot.title = element_text(size = 15,
                                  face = "bold",
                                  hjust = 0.5),
        axis.title.y = element_text(size = 15))+
  scale_fill_manual(values = CORESJURISDICAO)


grid.arrange(GFVAR_FIR_MES,GFVAR_FIR,GFVAR_FIR_ANO, ncol=3,widths=c(3,1,1)) %>% 
ggsave(filename = "imagens/gf4.png", height = 18,width=28, units = "cm")

```

#6 MAPA DE DENSIDADE

```{r echo=FALSE, message=FALSE, warning=FALSE}

#GRÁFICO DE DENSIDADE (5)

ggplot(data = read_state())+
  geom_sf()+
  geom_polygon(data = JURISDICAO, aes(x=LONGITUDE,y = LATITUDE, fill=REGIONAL),color="#666666",alpha=0.5)+
   geom_polygon(data = VERTICES_CRCEA_SE, aes(x=LONGITUDE,y = LATITUDE, fill=REGIONAL),color="#666666",alpha=0.8)+
   geom_point(data = TEXTOJURISDIÇÃO, aes(x=Y, y=X))+
   geom_segment(LINHATEXTOJURISDIÇÃOCRCEA,mapping=aes(x=x1, y=y1, xend=x2, yend=y2))+
   geom_label(data = TEXTOJURISDIÇÃO,aes(x=Y,y = X, label = VALOR),size=4,label.padding = unit(0.20, "lines"),label.r = unit(0.5, "lines"))+
   geom_label(data = TEXTOJURISDIÇÃOCRCEA,aes(x=Y,y = X, label = VALOR),size=4,label.padding = unit(0.20, "lines"),label.r = unit(0.5, "lines"))+
   geom_label(aes(x=-70, y=-24, label="SISCEAB"),label.r = unit(0.5, "lines"))+
  theme_void()+
  scale_fill_manual(values = CORESJURISDICAO)

ggsave(filename = "imagens/gf5.png", height = 10,width = 15, units = "cm")

```

#7 PONTUALIDADE DE PARTIDA

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=10, fig.width=18}


#PONTUALIDADE DE PARTIDA KPI-01(6A)

BDS_PONT_2021 <- BDS_KPI_01_DF %>% filter(ANO %in% c(2021))
BDS_PONT_2022 <- BDS_KPI_01_DF %>% filter(ANO %in% c(2022))
BDS_VAR_PONT <- bind_cols(BDS_PONT_2021,BDS_PONT_2022) %>% 
  transmute(PONTUALIDADE_21=PONTUALIDADE_ANO...2, AERO=AERO...4,
            PONTUALIDADE_22= PONTUALIDADE_ANO...18, VAR=(PONTUALIDADE_22-PONTUALIDADE_21)/100) %>% 
  mutate(COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0))) %>% 
  mutate(AERO=factor(AERO, levels = c("SBBR","SBCF","SBCG","SBCT","SBFI","SBFL","SBPA",
                     "SBFZ","SBMO","SBPS","SBRF","SBSV","SBBE","SBCY","SBEG",
                     "SBGL","SBGR","SBKP","SBRJ","SBSP")))

VELOCIMETRO <- data.frame(PONTUALIDADE=c("PONT", "DIF"), MEDIA=c(mean(BDS_VAR_PONT$PONTUALIDADE_22),100-mean(BDS_VAR_PONT$PONTUALIDADE_22)))



GFFF <-
    ggplot(BDS_KPI_01_DF %>% filter(ANO!="2023" & ANO!="2019"))+
  geom_col(aes(x=AERO, y=PONTUALIDADE_ANO, fill = as.factor(ANO)), position = "dodge")+
  geom_hline(aes(yintercept = 80,  lty='Meta (80%)'),color="red")+
  scale_linetype(name = NULL)+
  facet_grid(cols = vars(REGIONAL),switch= "y", scales = "free_x", space = "free_x")+
  geom_text(data= BDS_KPI_01_DF %>% filter(ANO%in%c("2020")),aes(x=AERO,
  y=PONTUALIDADE_ANO, label =      percent(round(PONTUALIDADE_ANO,2), 
          scale= 1,accuracy = 0.1), group = ANO),size = 3.2, fontface="bold",
            hjust = -0.1, vjust=-1.8
            ,position = position_dodge(width = 0.9),angle = 90)+
  geom_text(data= BDS_KPI_01_DF %>% filter(ANO%in%c( "2021")),aes(x=AERO,
  y=PONTUALIDADE_ANO, label =      percent(round(PONTUALIDADE_ANO,2),
         scale= 1,accuracy = 0.1), group = ANO),size = 3.2, fontface="bold",
            hjust = -0.1
            ,position = position_dodge(width = 0.9),angle = 90)+
  geom_text(data= BDS_KPI_01_DF %>% filter(ANO%in%c("2022")),
            aes(x=AERO, y=PONTUALIDADE_ANO, label =      percent(round(PONTUALIDADE_ANO,2),
                scale= 1,accuracy = 0.1), group = ANO),size = 3.2,
            hjust = -0.1, vjust=2.4, fontface="bold"
            ,position = position_dodge(width = 0.9),angle = 90)+
  coord_cartesian(ylim = c(70, 100), expand = FALSE)+
  scale_y_continuous(limits = c(-10,100), labels = percent_format(scale=1))+
  scale_fill_manual(values = cores)+
  labs(fill=NULL, x = NULL, y = "Pontualidade de partida")+
  theme(legend.position = "bottom"
        ,legend.text     = element_text(size = 12),
        axis.text.x= element_text(size = 12),
        axis.title.y = element_text(size = 18),
        strip.text = element_text(size = 15),
        )

GFPONT_VAR <- 
  ggplot(BDS_VAR_PONT)+
  geom_col(aes(x = AERO, y = VAR, fill = COR), 
           na.rm = TRUE, color = "black",width = 0.35) +
  theme_minimal()+
  geom_hline(yintercept = 0) +
  scale_y_continuous(limits=c(-.3,.3),labels = scales::label_percent(scale = 100))+
  coord_cartesian(xlim = c(1.05,19.8))+
  guides(fill = "none") +
  geom_text(aes(x = AERO, y = VAR, label=scales::percent(VAR,accuracy = 0.1),vjust = ifelse(VAR < 0, 1.25, -0.25)),size= 4)+
  labs(x = NULL, y = "Dif. 2021/2022") +
  scale_fill_manual(values = c("firebrick", "dodgerblue4"))+
  theme(axis.text.x = element_blank(),
        axis.title.y = element_text(size = 15))

# GF_MEDIA <- 
#   ggplot(BDS_VAR_PONT)+
#   geom_image(aes(x=5,5),image="imagens/pontualidade.png",size=.5)+
#   geom_text(aes(x = 5, y = 5, label=percent(mean(PONTUALIDADE_22),scale = 1)),size=8, vjust=2.3)+
#   geom_text(aes(x = 5, y = 5, label="Média anual"),size=8, vjust=-2)+
#   theme_void()
#   



GFPONT_VAR + GFFF +plot_layout(ncol=1,heights = c(1.4,3)) 
ggsave(filename = "imagens/gf6.png", height = 22,width = 35, units = "cm")

```

##7A PONTUALIDADE DE PARTIDA

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=10, fig.width=18}
  


BDS_PONT_REG_2021 <- BDS_KPI_01_REGIONAL_DF %>% filter(movimentos.ano %in% c(2021))
BDS_PONT_REG_2022 <- BDS_KPI_01_REGIONAL_DF %>% filter(movimentos.ano %in% c(2022))
BDS_VAR_PONT_REG <- bind_cols(BDS_PONT_REG_2021,BDS_PONT_REG_2022) %>% 
  transmute(PONTUALIDADE_REG_21=movimentos.percentual_ano...6, AERO=movimentos.aero...8,
            PONTUALIDADE_REG_22= movimentos.percentual_ano...27, VAR=(PONTUALIDADE_REG_22-PONTUALIDADE_REG_21)/100) %>% 
  mutate(COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0))) %>% 
  mutate(AERO=factor(AERO, levels = c("SISCEAB","CINDACTA I","CINDACTA II", "CINDACTA III", "CINDACTA IV", "CRCEA-SE")))


P.REG.VAR<-ggplot(BDS_VAR_PONT_REG)+
  geom_col(aes(x = AERO, y = VAR, fill = COR), 
           na.rm = TRUE, color = "black",width = 0.25) +
  theme_minimal()+
  geom_hline(yintercept = 0) +
  scale_y_continuous(limits=c(-.3,.3),labels = scales::label_percent(scale = 100))+
  coord_cartesian(xlim = c(1.2,5.6))+
  guides(fill = "none") +
  geom_text(aes(x = AERO, y = VAR, label=scales::percent(VAR,accuracy = 0.1),vjust = ifelse(VAR < 0, 1.25, -0.25)),size= 4,fontface="bold")+
  labs(x = NULL, y = "Dif. 2021/2022") +
  scale_fill_manual(values = c("firebrick", "dodgerblue4"))+
  theme(axis.text.x = element_blank(),
        axis.title.y = element_text(size = 15))



P.REG<-BDS_KPI_01_REGIONAL_DF %>% filter(movimentos.ano%in%c(2020,2021,2022)&movimentos.aero!="SISCEAB") %>%
ggplot()+
  geom_col(aes(x=movimentos.aero, y=movimentos.percentual_ano, fill = as.factor(movimentos.ano)), position = "dodge",width = 0.8)+
  geom_hline(aes(yintercept = 80,  lty='Meta (80%)'),color="red")+
  scale_linetype(name = NULL)+
  geom_text(aes(x=movimentos.aero, y=movimentos.percentual_ano, label = scales::percent(movimentos.percentual_ano, accuracy = 0.1,scale = 1), 
                group = movimentos.ano),size = 4,vjust=-1,
            position = position_dodge(width = 0.8), fontface="bold")+
   coord_cartesian(ylim = c(75, 95), expand = FALSE)+
  theme_classic()+
  labs( x = NULL, y = NULL
       ,fill = "ANO") +
  theme(legend.position = "bottom",
        legend.title=element_blank()
        ,legend.text     = element_text(size = 12)
        ,legend.key.size = unit(0.5, "cm"),
        plot.subtitle = element_text(size = 12, color = "#8B0000"),
        axis.text.x= element_text(size = 15),
        axis.title.y = element_text(size = 18))+
  scale_y_continuous(labels = NULL, limits = c(0,100))+
  scale_fill_manual(values = cores)


P.SIS<-BDS_KPI_01_REGIONAL_DF %>% filter(movimentos.ano%in%c(2020,2021,2022)&movimentos.aero=="SISCEAB") %>%
  ggplot()+
  geom_col(aes(x=movimentos.aero, y=movimentos.percentual_ano, fill = as.factor(movimentos.ano)), position = "dodge",width = .5)+
  geom_hline(yintercept = 80,col="red") +
  geom_text(aes(x=movimentos.aero, y=movimentos.percentual_ano, label = scales::percent(movimentos.percentual_ano, accuracy = 0.1,scale = 1), 
                group = movimentos.ano),size = 4,vjust=-1,
            position = position_dodge(width = 0.5),fontface="bold")+
  coord_cartesian(ylim = c(75, 95), expand = FALSE)+
  theme_classic() +
  labs(caption=" ",x = NULL, y = "Pontualidade de partida"
        ,fill = "ANO") +
  theme(panel.background=element_rect(fill = "#F0F8FF"),
    legend.position = "none",
    plot.caption = element_text(size = 32),
        legend.title=element_blank()
        ,legend.text     = element_text(size = 12)
        ,legend.key.size = unit(0.5, "cm"),
        plot.subtitle = element_text(size = 12, color = "#8B0000"),
        axis.text.x= element_text(size = 15),
        axis.title.y = element_text(size = 18))+
  scale_y_continuous( limits = c(0,100), labels = percent_format(scale=1))+
  scale_fill_manual(values = cores)

SPACE <- plot_spacer()+
  theme_void()

l2 = grid.arrange(P.SIS,SPACE,P.REG, ncol=3,widths=c(.5,0.08,2),heights= c(1.4))
grid.arrange(P.REG.VAR,l2, nrow=2,heights= c(1.4,4)) %>% 
ggsave(filename = "imagens/gf6A.png", height = 22,width = 35, units = "cm")
```


#8 PONTUALIDADE DE CHEGADA

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=15, fig.width=18}
#PONTUALIDADE DE chegada KPI-14(8)

BDS_PONT_2021_CHEGADA <- BDS_KPI_14_DF %>% filter(ANO %in% c(2021))
BDS_PONT_2022_CHEGADA <- BDS_KPI_14_DF %>% filter(ANO %in% c(2022))
BDS_VAR_PONT_CHEGADA <- bind_cols(BDS_PONT_2021_CHEGADA,BDS_PONT_2022_CHEGADA) %>% 
  transmute(PONTUALIDADE_21=PONTUALIDADE_ANO...2, AERO=AERO...4,
            PONTUALIDADE_22= PONTUALIDADE_ANO...18, VAR=(PONTUALIDADE_22-PONTUALIDADE_21)/100) %>% 
  mutate(COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0))) %>% 
  mutate(AERO=factor(AERO, levels = c("SBBR","SBCF","SBCG","SBCT","SBFI","SBFL","SBPA",
                                      "SBFZ","SBMO","SBPS","SBRF","SBSV","SBBE","SBCY","SBEG",
                                      "SBGL","SBGR","SBKP","SBRJ","SBSP"))) #%>% 
  #filter(AERO!= "SBCG")

VELOCIMETRO_CHEGADA <- data.frame(PONTUALIDADE=c("PONT", "DIF"), 
                          MEDIA=c(mean(BDS_VAR_PONT_CHEGADA$PONTUALIDADE_22),
                                  100-mean(BDS_VAR_PONT_CHEGADA$PONTUALIDADE_22)))


GFFF_CHEGADA <- ggplot(BDS_KPI_14_DF %>% filter(ANO!="2023" & ANO!="2019"))+
  geom_col(aes(x=AERO, y=PONTUALIDADE_ANO, fill = as.factor(ANO)), position = "dodge")+
  geom_hline(aes(yintercept = 80,  lty='Meta (80%)'),color="red")+
  scale_linetype(name = NULL)+
  facet_grid(cols = vars(REGIONAL),switch= "y", scales = "free_x", space = "free_x")+
  geom_text(data= BDS_KPI_14_DF %>% filter(ANO%in%c("2020")),aes(x=AERO,
  y=PONTUALIDADE_ANO, label =      percent(round(PONTUALIDADE_ANO,2), 
          scale= 1,accuracy = 0.1), group = ANO),size = 3.2, fontface="bold",
            hjust = -.1, vjust=-1.8
            ,position = position_dodge(width = 0.9),angle = 90)+
  geom_text(data= BDS_KPI_14_DF %>% filter(ANO%in%c( "2021")),aes(x=AERO,
  y=PONTUALIDADE_ANO, label =      percent(round(PONTUALIDADE_ANO,2),
         scale= 1,accuracy = 0.1), group = ANO),size = 3.2, fontface="bold",
            hjust = -0.1
            ,position = position_dodge(width = 0.9),angle = 90)+
  geom_text(data= BDS_KPI_14_DF %>% filter(ANO%in%c("2022")),
            aes(x=AERO, y=PONTUALIDADE_ANO, label =      percent(round(PONTUALIDADE_ANO,2),
                scale= 1,accuracy = 0.1), group = ANO),size = 3.2,
            hjust = -0.1, vjust=2.4, fontface="bold"
            ,position = position_dodge(width = 0.9),angle = 90)+
  coord_cartesian(ylim = c(50, 90), expand = FALSE)+
  scale_y_continuous(limits = c(-10,100), labels = percent_format(scale=1))+
  scale_fill_manual(values = cores)+
  labs(fill=NULL, x = NULL, y = "Pontualidade de chegada")+
  theme(legend.position = "bottom"
        ,legend.text     = element_text(size = 12),
        axis.text.x= element_text(size = 11),
        axis.title.y = element_text(size = 18),
        strip.text = element_text(size = 12))


GFPONT_VAR_CHEGADA <- 
  ggplot(BDS_VAR_PONT_CHEGADA)+
  geom_col(aes(x = AERO, y = VAR, fill = COR), 
           na.rm = TRUE, color = "black",width = 0.35) +
  theme_minimal()+
  geom_hline(yintercept = 0) +
  scale_y_continuous(limits=c(-.3,.3),labels = scales::label_percent(scale = 100))+
  coord_cartesian(xlim = c(1.05,19.8))+
  guides(fill = "none") +
  geom_text(aes(x = AERO, y = VAR, label=scales::percent(VAR,accuracy = 0.1),vjust = ifelse(VAR < 0, 1.25, -0.25)),size= 3)+
  labs(x = NULL, y = "Dif. 2021/2022") +
  scale_fill_manual(values = c("firebrick", "dodgerblue4"))+
  theme(axis.text.x = element_blank(),
        axis.title.y = element_text(size = 14))

# GF_MEDIA_CHEGADA <- 
#   ggplot(BDS_VAR_PONT_CHEGADA)+
#   geom_image(aes(x=5,5),image="imagens/pontualidade.png",size=.5)+
#   geom_text(aes(x = 5, y = 5, label=percent(mean(PONTUALIDADE_22),scale = 1)),size=8, vjust=2.3)+
#   geom_text(aes(x = 5, y = 5, label="Média anual"),size=8, vjust=-2)+
#   theme_void()
  
 


  

#SPACE <- plot_spacer()


GFPONT_VAR_CHEGADA+GFFF_CHEGADA+plot_layout(ncol = 1,heights = c(1.4,3))



ggsave(filename = "imagens/gf8.png", height = 22,width=35, units = "cm")

```




##8.1 PONTUALIDADE DE CHEGADA

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=9, fig.width=18}


BDS_PONT_REG_2021C <- BDS_KPI_14_REGIONAL_DF %>% filter(movimentos.ano %in% c(2021))
BDS_PONT_REG_2022C <- BDS_KPI_14_REGIONAL_DF %>% filter(movimentos.ano %in% c(2022))
BDS_VAR_PONT_REG_C <- bind_cols(BDS_PONT_REG_2021C,BDS_PONT_REG_2022C) %>% 
  transmute(PONTUALIDADE_REG_21=movimentos.percentual_ano...6, AERO=movimentos.aero...8,
            PONTUALIDADE_REG_22= movimentos.percentual_ano...27, VAR=(PONTUALIDADE_REG_22-PONTUALIDADE_REG_21)/100) %>% 
  mutate(COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0))) %>% 
  mutate(AERO=factor(AERO, levels = c("SISCEAB","CINDACTA I","CINDACTA II", "CINDACTA III", "CINDACTA IV", "CRCEA-SE")))


PC.REG.VAR<-ggplot(BDS_VAR_PONT_REG_C)+
  geom_col(aes(x = AERO, y = VAR, fill = COR), 
           na.rm = TRUE, color = "black",width = 0.25) +
  theme_minimal()+
  geom_hline(yintercept = 0) +
  scale_y_continuous(limits=c(-.3,.3),labels = scales::label_percent(scale = 100))+
  coord_cartesian(xlim = c(1.3,5.6))+
  guides(fill = "none") +
  geom_text(aes(x = AERO, y = VAR, label=scales::percent(VAR,accuracy = 0.1),vjust = ifelse(VAR < 0, 1.25, -0.25)),size= 4,fontface="bold")+
  labs(x = NULL, y = "Dif. 2021/2022") +
  scale_fill_manual(values = c("firebrick", "dodgerblue4"))+
  theme(axis.text.x = element_blank(),
        axis.title.y = element_text(size = 15))




PC.REG<-BDS_KPI_14_REGIONAL_DF %>% filter(movimentos.ano%in%c(2020,2021,2022)&movimentos.aero!="SISCEAB") %>%
ggplot()+
  geom_col(aes(x=movimentos.aero, y=movimentos.percentual_ano, fill = as.factor(movimentos.ano)), position = "dodge",width = .8)+
  geom_hline(aes(yintercept = 80,  lty='Meta (80%)'),color="red")+
  scale_linetype(name = NULL)+
  geom_text(aes(x=movimentos.aero, y=movimentos.percentual_ano, label = scales::percent(movimentos.percentual_ano, accuracy = 0.1,scale = 1), 
                group = movimentos.ano),size = 4,vjust=-1,
            position = position_dodge(width = 0.8), fontface="bold")+
   coord_cartesian(ylim = c(0, 100), expand = FALSE)+
  theme_classic() +
  labs( x = NULL, y = NULL
       ,fill = "ANO") +
  theme(legend.position = "bottom",
        legend.title=element_blank()
        ,legend.text     = element_text(size = 12)
        ,legend.key.size = unit(0.5, "cm"),
        plot.subtitle = element_text(size = 12, color = "#8B0000"),
        axis.text.x= element_text(size = 15),
        axis.title.y = element_text(size = 18))+
  scale_y_continuous(labels = NULL, limits = c(0,100))+
  scale_fill_manual(values = cores)


PC.SIS<-BDS_KPI_14_REGIONAL_DF %>% filter(movimentos.ano%in%c(2020,2021,2022)&movimentos.aero=="SISCEAB") %>%
  ggplot()+
  geom_col(aes(x=movimentos.aero, y=movimentos.percentual_ano, fill = as.factor(movimentos.ano)), position = "dodge",width = .5)+
  geom_hline(yintercept = 80,col="red") +
  geom_text(aes(x=movimentos.aero, y=movimentos.percentual_ano, label = scales::percent(movimentos.percentual_ano, accuracy = 0.1,scale = 1), 
                group = movimentos.ano),size = 4,vjust=-1,
            position = position_dodge(width = 0.5),fontface="bold")+
  coord_cartesian(ylim = c(0, 100), expand = FALSE)+
  theme_classic() +
  labs(caption=" ",x = NULL, y = "Pontualidade de chegada"
        ,fill = "ANO") +
  theme(panel.background=element_rect(fill = "#F0F8FF"),
    legend.position = "none",
    plot.caption = element_text(size = 32),
        legend.title=element_blank()
        ,legend.text     = element_text(size = 12)
        ,legend.key.size = unit(0.5, "cm"),
        plot.subtitle = element_text(size = 12, color = "#8B0000"),
        axis.text.x= element_text(size = 15),
        axis.title.y = element_text(size = 18))+
  scale_y_continuous( limits = c(0,100), breaks =c(25,50,70,80), labels = percent_format(scale=1))+
  scale_fill_manual(values = cores)



l3 = grid.arrange(PC.SIS,SPACE,PC.REG, ncol=3,widths=c(.5,0.08,2),heights= c(1.4))
grid.arrange(PC.REG.VAR,l3, nrow=2,heights= c(1.4,4)) %>% 
ggsave(filename = "imagens/gf8A.png", height = 22,width = 35, units = "cm")



```




## 8.2 DEP e ARR

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.width=10,fig.height=8}


ggplot(PONT_ARR_DEP, aes(x=PONT.ARR, y= PONT.DEP))+
  geom_image(data = PONT_ARR_DEP,
             aes(x=PONT.ARR, y= PONT.DEP),color="#191970",
                 image="imagens.criacao/twr3.png", size=0.025)+
  geom_hline(aes(yintercept = 80,  lty='Meta (80%)'),color="red")+
  geom_vline(xintercept = 80, color="red")+
  scale_y_continuous(labels = scales::label_percent(scale = 1,accuracy = 1),breaks = c(70,75,80,85,90,95,100), limits = c(75,90))+
  scale_x_continuous(labels = scales::label_percent(scale = 1,accuracy = 1), limits = c(55,80))+
  geom_text_repel(label = PONT_ARR_DEP$AERO,nudge_y = .1,size=3)+
  labs( x = "Pontualidade de chegada", y = "Pontualidade de partida") +
  theme_light()+
  theme(legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(size = 15,
                                  face = "bold",
                                  hjust = 0.5),
        plot.subtitle = element_text(size = 12, color = "#8B0000"),
        plot.caption = element_text(hjust = .5,
                                    face = "bold"),
        axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12))

ggsave(filename = "imagens/gf12b.png", height = 12,width = 20, units = "cm")


```




#9 PONTUALIDADE DE PARTIDA SBGR

```{r echo=FALSE, message=FALSE, warning=FALSE}

#PONTUALIDADE DE PARTIDA SBGR(10)

BDS_KPI_01_DF %>% filter(AERO=="SBGR" & ANO=="2022") %>% 
  pivot_longer(cols = JAN:DEZ,
               names_to = "MES",
               values_to = "PONT") %>%
  mutate(MES=factor(MES,levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ"))) %>% 
  ggplot(aes(x = MES, y = PONT, fill = as.factor(ANO)))+
  geom_col(position=position_dodge(preserve = "single"), width = .7) +
   labs(fill="Ano") +
  scale_y_continuous(labels = scales::label_percent(scale = 1), limits = c(0,100))+
  coord_cartesian(ylim = c(50, 95), expand = FALSE)+
  geom_text(aes( y = PONT, label = scales::percent(PONT, accuracy = 0.1, scale = 1), group = ANO), vjust=-.5, position = position_dodge(width=.9), size = 3, color = "black", fontface="bold")+
  scale_fill_manual(values = "#191970")+
  labs( x = NULL, y = "Pontualidade de partida - SBGR") +
  theme_classic()+
  theme(legend.position = "none",
        legend.title=element_blank(),
    plot.title = element_text(size = 18,
                              face = "bold",
                              hjust = 0.5),
    plot.subtitle = element_text(size = 12, color = "#8B0000"),
    plot.caption = element_text(hjust = .5,
                                face = "bold"))

ggsave(filename = "imagens/gf10.png", height = 8,width = 18, units = "cm")
```



#10 PONTUALIDADE DE PARTIDA SBSP

```{r echo=FALSE, warning=FALSE, message=FALSE}
#PONTUALIDADE DE PARTIDA SBSP(11)

BDS_KPI_01_DF %>% filter(AERO=="SBSP" & ANO==2022) %>% 
  pivot_longer(cols = JAN:DEZ,
               names_to = "MES",
               values_to = "PONT") %>%
  mutate(MES=factor(MES,levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ"))) %>% 
  ggplot(aes(x = MES, y = PONT, fill = as.factor(ANO)))+
  geom_col(position=position_dodge(preserve = "single"), width = .7) +
    labs(fill="Ano") +
  scale_y_continuous(labels = scales::label_percent(scale = 1), limits = c(0,100))+
  coord_cartesian(ylim = c(50, 100), expand = FALSE)+
  geom_text(aes( y = PONT, label = scales::percent(PONT, accuracy = .1,scale = 1), group = ANO),vjust=-.5, position = position_dodge(width=.9), size = 3, color = "black", fontface="bold")+
  scale_fill_manual(values = "#191970")+
  labs( x = NULL, y = "Pontualidade de partida - SBSP") +
  theme_classic()+
  theme(legend.position = "none",
        legend.title=element_blank(),
    plot.title = element_text(size = 18,
                              face = "bold",
                              hjust = 0.5),
    plot.subtitle = element_text(size = 12, color = "#8B0000"),
    plot.caption = element_text(hjust = .5,
                                face = "bold"))

ggsave(filename = "imagens/gf11.png", height = 8,width = 18, units = "cm")

```




#11 PONTUALIDADE DE CHEGADA SBGR

```{r echo=FALSE, warning=FALSE, message=FALSE}
#PONTUALIDADE DE CHEGADA SBGR(13)
  
  BDS_KPI_14_DF %>% filter(AERO=="SBGR" & ANO==2022) %>% 
    pivot_longer(cols = JAN:DEZ,
                 names_to = "MES",
                 values_to = "PONT") %>%
    mutate(MES=factor(MES,levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ"))) %>% 
    ggplot(aes(x = MES, y = PONT, fill = as.factor(ANO)))+
    geom_col(position=position_dodge(preserve = "single"),width = .7) +
    scale_y_continuous(labels = scales::label_percent(scale = 1), limits = c(0,100))+
    geom_text(aes( y = PONT, label = scales::percent(PONT, accuracy = .1, scale = 1), group = ANO), vjust=-.5, position = position_dodge(width=.9), size = 3, color = "black", fontface="bold")+
    scale_fill_manual(values = "#191970")+
    labs( x = NULL, y = "Pontualidade de chegada - SBGR") +
    theme_classic()+
    theme(legend.position = "none",
        legend.title=element_blank(),
    plot.title = element_text(size = 18,
                              face = "bold",
                              hjust = 0.5),
    plot.subtitle = element_text(size = 12, color = "#8B0000"),
    plot.caption = element_text(hjust = .5,
                                face = "bold"))

ggsave(filename = "imagens/gf13.png", height = 8,width = 18, units = "cm")

```



##11.1 PONTUALIDADE DE CHEGADA SBSP

```{r echo=FALSE, warning=FALSE, message=FALSE}
#PONTUALIDADE DE CHEGADA SBGR(13)
  
  BDS_KPI_14_DF %>% filter(AERO=="SBSP" & ANO==2022) %>% 
    pivot_longer(cols = JAN:DEZ,
                 names_to = "MES",
                 values_to = "PONT") %>%
    mutate(MES=factor(MES,levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ"))) %>% 
    ggplot(aes(x = MES, y = PONT, fill = as.factor(ANO)))+
    geom_col(position=position_dodge(preserve = "single"),width = .7) +
    scale_y_continuous(labels = scales::label_percent(scale = 1), limits = c(0,100))+
    geom_text(aes( y = PONT, label = scales::percent(PONT, accuracy = .1, scale = 1), group = ANO), vjust=-.5, position = position_dodge(width=.9), size = 3, color = "black", fontface="bold")+
    scale_fill_manual(values = "#191970")+
    labs( x = NULL, y = "Pontualidade de chegada - SBSP") +
    theme_classic()+
    theme(legend.position = "none",
        legend.title=element_blank(),
    plot.title = element_text(size = 18,
                              face = "bold",
                              hjust = 0.5),
    plot.subtitle = element_text(size = 12, color = "#8B0000"),
    plot.caption = element_text(hjust = .5,
                                face = "bold"))

ggsave(filename = "imagens/gf13B.png", height = 8,width = 18, units = "cm")

```



#12 Pontualidade ARR em 2022

```{r echo=FALSE, message=FALSE, warning=FALSE}

#Pontualidade ARR em 2022(41)



ggplot(BDS_PONTUALIDADE_ARR %>% filter(ANO=="2022"), aes(x = APT_ICAO, y = FLIGHTS, fill = SLOT))+
  geom_col(position = position_stack(reverse = TRUE))+
    facet_grid(rows = vars(APT_GROUP),switch= "y", scales = "free_y", space = "free_y")+
  scale_fill_manual(values = CORESPONT)+
  scale_y_continuous(labels = scales::label_percent())+
  geom_label(aes(x = APT_ICAO, y = FLIGHTS, label = scales::percent(FLIGHTS,accuracy = 1) ),fill="white",label.padding = unit(0.15,"lines"),size = 3, position = position_stack(vjust = .8,reverse = TRUE),show.legend = FALSE, fontface="bold")+
  coord_flip()+
  theme_bw()+
  labs( y = NULL, x = "Pontualidade de chegada"
        ,fill = NULL)+
  theme(legend.position = "bottom",
        legend.justification = c("center", "top"),
        legend.title=element_blank(),
        legend.text     = element_text(size = 6)
        ,legend.key.size = unit(0.3, "cm"),
        plot.title = element_text(size = 18L,
                                  face = "bold",
                                  hjust = 0.5),
        plot.subtitle = element_text(size = 12, color = "#8B0000"),
        plot.caption = element_text(hjust = .5,
                                    face = "bold"))
  
ggsave(filename = "imagens/gf41.png", height = 21,width =18, units = "cm")
```



# 13 Pontualidade DEP em 2022

```{r echo=FALSE, message=FALSE, warning=FALSE}

#Pontualidade DEP em 2022(42)
ggplot(BDS_PONTUALIDADE_DEP %>% filter(ANO=="2022"), aes(x = APT_ICAO, y = FLIGHTS, fill = SLOT))+
            geom_col(position = position_stack(reverse = TRUE))+
  facet_grid(rows = vars(APT_GROUP),switch= "y", scales = "free_y", space = "free_y")+
            scale_fill_manual(values = CORESPONT)+
            scale_y_continuous(labels = scales::label_percent())+
            coord_flip()+
            geom_label(aes(x = APT_ICAO, y = FLIGHTS, label = scales::percent(FLIGHTS,accuracy = 1)),fill="white",label.padding = unit(0.15,"lines"),size = 3, position = position_stack(vjust = .8,reverse = TRUE), show.legend = FALSE, fontface="bold")+
            theme_bw()+
            labs( x = "Pontualidade de partida", y = NULL
                 ,fill = NULL)+
            theme(legend.position = "bottom",
                  legend.justification = c("center", "top"),
                  legend.title=element_blank(),
                  legend.text     = element_text(size = 6)
                  ,legend.key.size = unit(0.3, "cm"),
                  plot.title = element_text(size = 18L,
                                            face = "bold",
                                            hjust = 0.5),
                  plot.subtitle = element_text(size = 12, color = "#8B0000"),
                  plot.caption = element_text(hjust = .5,
                                              face = "bold"))

ggsave(filename = "imagens/gf42.png", height = 21,width =18, units = "cm")
```



# 14 MÉDIA MÓVEL

```{r echo=FALSE, message=FALSE, warning=FALSE}

Dados_Base34_2022 <-Dados_Base34_2022  %>%
  mutate( ROLLSEV = rollmean(x=Total, k=7, fill = NA))

Dados_Base34_2022 %>% ggplot(aes(x=Data)) +
  #geom_point(aes(y = Total), color= "#4682B4",size=.5) +
  geom_line(aes(y = ROLLSEV), color = "royalblue4") +
  scale_y_continuous(limits = c(0,7000))+
  labs( x = NULL, y = "Média móvel diária - 7 dias") +
  theme_bw()


ggsave(filename = "imagens/gf48.png", height = 9,width = 17, units = "cm")

```






# 15 DEP e ARR REGIONAL

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.width=10,fig.height=8}


BDS_DEP.ARR_REG <- bind_cols(BDS_KPI_01_REGIONAL_DF$movimentos.ano,BDS_KPI_01_REGIONAL_DF$movimentos.aero, BDS_KPI_01_REGIONAL_DF$movimentos.percentual_ano,BDS_KPI_14_REGIONAL_DF$movimentos.percentual_ano)%>%
  transmute(ANO=...1,REGIONAL=...2,DEP=...3,ARR=...4)%>% filter(ANO=="2022")






ggplot(BDS_DEP.ARR_REG, aes(x=ARR, y= DEP))+
  geom_image(data = BDS_DEP.ARR_REG,
             aes(x=ARR, y= DEP),color="#191970",
                 image="imagens.criacao/twr3.png", size=0.025)+
  geom_hline(aes(yintercept = 80,  lty='Meta (80%)'),color="red")+
  geom_vline(xintercept = 80, color="red")+
  scale_y_continuous(labels = scales::label_percent(scale = 1,accuracy = 1),breaks = c(70,75,80,85,90,95,100), limits = c(75,90))+
  scale_x_continuous(labels = scales::label_percent(scale = 1,accuracy = 1), limits = c(55,80))+
  geom_text_repel(label = BDS_DEP.ARR_REG$REGIONAL,nudge_y = .1,size=3)+
  labs( x = "Pontualidade de chegada", y = "Pontualidade de partida") +
  theme_light()+
  theme(legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(size = 15,
                                  face = "bold",
                                  hjust = 0.5),
        plot.subtitle = element_text(size = 12, color = "#8B0000"),
        plot.caption = element_text(hjust = .5,
                                    face = "bold"),
        axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12))

ggsave(filename = "imagens/gf12C.png", height = 12,width = 20, units = "cm")


```


#16 TAXIOUT 

```{r echo=FALSE, warning=FALSE, message=FALSE,fig.height=11, fig.width=15}
#TAXIOUT SBGR 2022(16)



BDS_TAXIOUT_2021 <- BDS_KPI_02_DF %>% filter(movimentos.ano %in% c(2021))%>%
  mutate(movimentos.regiao=factor(movimentos.regiao, levels = c("CINDACTA I", "CINDACTA II","CINDACTA III", "CINDACTA IV", "CRCEA-SE"))) %>% 
  arrange(movimentos.aero)
BDS_TAXIOUT_2022 <- BDS_KPI_02_DF %>% filter(movimentos.ano %in% c(2022)) %>%
  mutate(movimentos.regiao=factor(movimentos.regiao, levels = c("CINDACTA I", "CINDACTA II","CINDACTA III", "CINDACTA IV", "CRCEA-SE"))) %>% 
  arrange(movimentos.aero)
BDS_VAR_TAXIOUT <- bind_cols(BDS_TAXIOUT_2021,BDS_TAXIOUT_2022) %>% 
  transmute(PONTUALIDADE_21=movimentos.percentual_ano...6, AERO=movimentos.aero...8,
            PONTUALIDADE_22= movimentos.percentual_ano...27, VAR=(PONTUALIDADE_22-PONTUALIDADE_21)/PONTUALIDADE_21) %>% 
  mutate(COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0))) %>% 
  mutate(AERO=factor(AERO, levels = c("SBBR","SBCF","SBCG","SBCT","SBFI","SBFL","SBPA",
                                      "SBFZ","SBMO","SBPS","SBRF","SBSV","SBBE","SBCY","SBEG",
                                      "SBGL","SBGR","SBKP","SBRJ","SBSP")))
# 



GFTAXIOUT <-
    ggplot(BDS_KPI_02_DF %>% filter(movimentos.ano!="2023" & movimentos.ano!="2019"))+
  geom_col(aes(x=movimentos.aero,y =movimentos.percentual_ano, fill = as.factor(movimentos.ano)),
           position = "dodge")+
geom_hline(aes(yintercept = 3,  lty='Meta (3 min)'),color="red")+
  scale_linetype(name = NULL)+
  facet_grid(cols = vars(movimentos.regiao),switch= "y", scales = "free_x", space = "free_x")+
  geom_text(data= BDS_KPI_02_DF %>% filter(movimentos.ano%in%c("2020")),aes(x=movimentos.aero,
 y=movimentos.percentual_ano, label =      movimentos.percentual_ano, group = movimentos.ano),size = 3.2,
            hjust = -0.3, vjust=-1.5
            ,position = position_dodge(width = 0.9),angle = 90,fontface="bold")+
geom_text(data= BDS_KPI_02_DF %>% filter(movimentos.ano%in%c("2021")),aes(x=movimentos.aero,
y=movimentos.percentual_ano, label =      movimentos.percentual_ano, group = movimentos.ano),size = 3.2,
          hjust = -0.3, vjust=0.5
          ,position = position_dodge(width = 0.9),angle = 90,fontface="bold")+
  geom_text(data= BDS_KPI_02_DF %>% filter(movimentos.ano%in%c("2022")),aes(x=movimentos.aero,
y=movimentos.percentual_ano, label =     movimentos.percentual_ano, group = movimentos.ano),size = 3.2,
            hjust = -0.1, vjust=2.5
            ,position = position_dodge(width = 0.9),angle = 90, fontface="bold")+
  coord_cartesian(ylim = c(1, 5.5), expand = FALSE)+
  scale_y_continuous(limits = c(-10,100))+
  scale_fill_manual(values = cores)+
  labs(fill=NULL, x = NULL, y = "Tempo adicional de taxi-out (min)")+
  theme(legend.position = "bottom",
        axis.text.x= element_text(size = 12),
        axis.title.y = element_text(size = 18),
        strip.text = element_text(size = 12)
  )

GFVARTAXIOUT <- 
  ggplot(BDS_VAR_TAXIOUT)+
  geom_col(aes(x = AERO, y = VAR, fill = COR), 
           na.rm = TRUE, color = "black",width = 0.35) +
  theme_minimal()+
  geom_hline(yintercept = 0)+
   scale_y_continuous(limits=c(-1,1),labels = scales::label_percent(scale = 100))+
  coord_cartesian(xlim = c(1.05,19.8))+
  guides(fill = "none") +
  geom_text(aes(x = AERO, y = VAR, label=scales::percent(VAR,accuracy = 0.1),
                vjust = ifelse(VAR < 0, 1.25, -0.25)),size= 4)+
  labs(x = NULL, y = "Var. 2021/2022") +
  scale_fill_manual(values = c("dodgerblue4","firebrick"))+
  theme(axis.text.x = element_blank(),
        axis.title.y = element_text(size = 15))






GFVARTAXIOUT + GFTAXIOUT+plot_layout(ncol=1,heights = c(1.4,3)) 
ggsave(filename = "imagens/gf16.png", height = 22,width = 28, units = "cm")

```





#17 GRÁFICO DE TEMPO ADICIONAL DE TAXI-OUT POR REGIONAL

```{r echo=FALSE, warning=FALSE, message=FALSE,fig.height=9, fig.width=18}

#GRÁFICO DE TEMPO ADICIONAL DE TAXI-OUT POR REGIONAL(17)







BDS_To_REG_2021 <- BDS_KPI_02_REGIONAL_DF %>% filter(movimentos.ano %in% c(2021))
BDS_TO_REG_2022 <- BDS_KPI_02_REGIONAL_DF %>% filter(movimentos.ano %in% c(2022))
BDS_VAR_TO_REG <- bind_cols(BDS_To_REG_2021,BDS_TO_REG_2022) %>% 
  transmute(PERCENT_REG_21=movimentos.percentual_ano...6, AERO=movimentos.aero...8,
            PERCENT_REG_22= movimentos.percentual_ano...27, VAR=(PERCENT_REG_22-PERCENT_REG_21)/PERCENT_REG_21) %>% 
  mutate(COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0))) %>% 
  mutate(AERO=factor(AERO, levels = c("SISCEAB","CINDACTA I","CINDACTA II", "CINDACTA III", "CINDACTA IV", "CRCEA-SE")))


TO.REG.VAR<-ggplot(BDS_VAR_TO_REG)+
  geom_col(aes(x = AERO, y = VAR, fill = COR), 
           na.rm = TRUE, color = "black",width = 0.25) +
  theme_minimal()+
  geom_hline(yintercept = 0) +
  scale_y_continuous(limits=c(-.5,.5),labels = scales::label_percent(scale = 100))+
  coord_cartesian(xlim = c(1.2,5.6))+
  guides(fill = "none") +
  geom_text(aes(x = AERO, y = VAR, label=scales::percent(VAR,accuracy = 0.1),vjust = ifelse(VAR < 0, 1.25, -0.25)),size= 4,fontface="bold")+
  labs(x = NULL, y = "Var. 2021/2022") +
  scale_fill_manual(values = c("dodgerblue4","firebrick"))+
  theme(axis.text.x = element_blank(),
        axis.title.y = element_text(size = 15))





#####




TO.REG<-BDS_KPI_02_REGIONAL_DF %>% filter(movimentos.ano%in%c(2020,2021,2022)&movimentos.aero!="SISCEAB") %>%
ggplot()+
  geom_col(aes(x=movimentos.aero, y=movimentos.percentual_ano, fill = as.factor(movimentos.ano)), position = "dodge",width = .6)+
  geom_hline(aes(yintercept = 3,  lty='Meta (3 min)'),color="red")+
  scale_linetype(name = NULL)+
  geom_text(aes(x=movimentos.aero, y=movimentos.percentual_ano, label = movimentos.percentual_ano, 
                group = movimentos.ano),size = 4,vjust=-1,
            position = position_dodge(width = 0.6), fontface="bold")+
   coord_cartesian(ylim = c(1, 4.5), expand = FALSE)+
  theme_classic() +
  labs( x = NULL, y = NULL
       ,fill = "ANO") +
  theme(legend.position = "bottom",
        legend.title=element_blank()
        ,legend.text     = element_text(size = 12)
        ,legend.key.size = unit(0.5, "cm"),
        plot.subtitle = element_text(size = 12, color = "#8B0000"),
        axis.text.x= element_text(size = 15),
        axis.title.y = element_text(size = 18))+
  scale_y_continuous(labels = NULL, limits = c(0,100))+
  scale_fill_manual(values = cores)


TO.SIS<-BDS_KPI_02_REGIONAL_DF %>% filter(movimentos.ano%in%c(2020,2021,2022)&movimentos.aero=="SISCEAB") %>%
  ggplot()+
  geom_col(aes(x=movimentos.aero, y=movimentos.percentual_ano, fill = as.factor(movimentos.ano)), position = "dodge",width = .6)+
  geom_hline(aes(yintercept = 3,  lty='Meta'),color="red")+
  scale_linetype(name = NULL)+
  geom_text(aes(x=movimentos.aero, y=movimentos.percentual_ano, label = movimentos.percentual_ano, 
                group = movimentos.ano),size = 5,vjust=-1,
            position = position_dodge(width = 0.5),fontface="bold")+
  coord_cartesian(ylim = c(1, 4.5), expand = FALSE)+
  theme_classic() +
  labs(caption=" ",x = NULL, y = "Tempo adicional de taxi-out (min)"
        ,fill = "ANO") +
  theme(panel.background=element_rect(fill = "#F0F8FF"),
    legend.position = "none",
    plot.caption = element_text(size = 32),
        legend.title=element_blank()
        ,legend.text     = element_text(size = 12)
        ,legend.key.size = unit(0.5, "cm"),
        plot.subtitle = element_text(size = 12, color = "#8B0000"),
        axis.text.x= element_text(size = 15),
        axis.title.y = element_text(size = 18))+
  scale_y_continuous(limits = c(0,100))+
  scale_fill_manual(values = cores)



l4 = grid.arrange(TO.SIS,SPACE,TO.REG, ncol=3,widths=c(.5,0.08,2),heights= c(1.5))
grid.arrange(TO.REG.VAR,l4, nrow=2,heights= c(1.3,4)) %>% 
ggsave(filename = "imagens/gf17.png", height = 22,width = 35, units = "cm")


```






#18 TAXI-IN 2022

```{r echo=FALSE, warning=FALSE, message=FALSE,fig.height=11, fig.width=15}
#TAXI-IN SBGR 2022(20)

BDS_TAXIIN_2021 <- BDS_KPI_13_DF %>% filter(movimentos.ano %in% c(2021))%>%
  mutate(movimentos.regiao=factor(movimentos.regiao, levels = c("CINDACTA I", "CINDACTA II","CINDACTA III", "CINDACTA IV", "CRCEA-SE"))) %>% 
   arrange(movimentos.regiao)
BDS_TAXIIN_2022 <- BDS_KPI_13_DF %>% filter(movimentos.ano %in% c(2022)) %>%
  mutate(movimentos.regiao=factor(movimentos.regiao, levels = c("CINDACTA I", "CINDACTA II","CINDACTA III", "CINDACTA IV", "CRCEA-SE"))) %>% 
   arrange(movimentos.regiao)
BDS_VAR_TAXIIN <- bind_cols(BDS_TAXIIN_2021,BDS_TAXIIN_2022) %>% 
  transmute(PONTUALIDADE_21=movimentos.percentual_ano...6, AERO=movimentos.aero...8,
            PONTUALIDADE_22= movimentos.percentual_ano...27, VAR=(PONTUALIDADE_22-PONTUALIDADE_21)/PONTUALIDADE_21) %>% 
  mutate(COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0))) %>% 
  mutate(AERO=factor(AERO, levels = c("SBBR","SBCF","SBCG","SBCT","SBFI","SBFL","SBPA",
                                      "SBFZ","SBMO","SBPS","SBRF","SBSV","SBBE","SBCY","SBEG",
                                      "SBGL","SBGR","SBKP","SBRJ","SBSP")))

VELOCIMETROTAXIIN <- data.frame(PONTUALIDADE=c("PONT", "DIF"), 
                                 MEDIA=c(mean(BDS_VAR_TAXIOUT$PONTUALIDADE_22),
                                         100-mean(BDS_VAR_TAXIOUT$PONTUALIDADE_22)))



GFTAXIIN <-
    ggplot(BDS_KPI_13_DF %>% filter(movimentos.ano!="2023" & movimentos.ano!="2019"))+
  geom_col(aes(x=movimentos.aero,y =movimentos.percentual_ano, fill = as.factor(movimentos.ano)),
           position = "dodge")+
  geom_hline(aes(yintercept = 3,  lty='Meta (3 min)'),color="red")+
  scale_linetype(name = NULL)+
  facet_grid(cols = vars(movimentos.regiao),switch= "y", scales = "free_x", space = "free_x")+
  geom_text(data=BDS_KPI_13_DF %>% filter(movimentos.ano%in%c("2020")),aes(x=movimentos.aero,
 y=movimentos.percentual_ano, label =  movimentos.percentual_ano, group = movimentos.ano),size = 2.5,
 hjust = -0.3,vjust=-1.7
            ,position = position_dodge(width = 0.9),angle = 90,fontface="bold")+
  geom_text(data= BDS_KPI_13_DF %>% filter(movimentos.ano%in%c("2021")),aes(x=movimentos.aero,
 y=movimentos.percentual_ano, label =  movimentos.percentual_ano, group = movimentos.ano),size = 2.5,
            hjust = -0.3, vjust=0.5
            ,position = position_dodge(width = 0.9),angle = 90,fontface="bold")+
  geom_text(data= BDS_KPI_13_DF %>% filter(movimentos.ano%in%c("2022")),aes(x=movimentos.aero,
y=movimentos.percentual_ano, label =   movimentos.percentual_ano, group = movimentos.ano),size = 2.5,
            hjust = -0.1, vjust=2.5
            ,position = position_dodge(width = 0.9),angle = 90, fontface="bold")+
  coord_cartesian(ylim = c(0, 4), expand = FALSE)+
  scale_y_continuous(limits = c(-10,100))+
  scale_fill_manual(values = cores)+
  labs(fill=NULL, x = NULL, y = "Tempo adicional de taxi-in (min)")+
  theme(legend.position = "bottom",
        axis.text.x= element_text(size = 12),
        axis.title.y = element_text(size = 15),
        strip.text = element_text(size = 12)
  )

GFVARTAXIIN <- 
  ggplot(BDS_VAR_TAXIIN)+
  geom_col(aes(x = AERO, y = VAR, fill = COR), 
           na.rm = TRUE, color = "black",width = 0.35) +
  theme_minimal()+
  geom_hline(yintercept = 0)+
  scale_y_continuous(limits=c(-.5,.5),labels = scales::label_percent(scale = 100))+
  coord_cartesian(xlim = c(1.05,19.8))+
  guides(fill = "none") +
  geom_text(aes(x = AERO, y = VAR, label=scales::percent(VAR,accuracy = 0.1),
                vjust = ifelse(VAR < 0, 1.25, -0.25)),size= 3,fontface="bold")+
  labs(x = NULL, y = "Var. 2021/2022") +
  scale_fill_manual(values = c("dodgerblue4","firebrick"))+
  theme(axis.text.x = element_blank(),
        axis.title.y = element_text(size = 15))









GFVARTAXIIN+ GFTAXIIN+ plot_layout(ncol=1,heights = c(1.4,3))


ggsave(filename = "imagens/gf20.png", height = 22,width = 28, units = "cm")

```



#19 GRÁFICO DE TEMPO ADICIONAL DE TAXI-IN POR REGIONAL

```{r echo=FALSE, warning=FALSE, message=FALSE,fig.height=9, fig.width=18}

 
 ###################
 
 
 BDS_TI_REG_2021 <- BDS_KPI_13_REGIONAL_DF %>% filter(movimentos.ano %in% c(2021))
BDS_TI_REG_2022 <- BDS_KPI_13_REGIONAL_DF %>% filter(movimentos.ano %in% c(2022))
BDS_VAR_TI_REG <- bind_cols(BDS_TI_REG_2021,BDS_TI_REG_2022) %>% 
  transmute(PERCENT_REG_21=movimentos.percentual_ano...6, AERO=movimentos.aero...8,
            PERCENT_REG_22= movimentos.percentual_ano...27, VAR=(PERCENT_REG_22-PERCENT_REG_21)/PERCENT_REG_21) %>% 
  mutate(COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0))) %>% 
  mutate(AERO=factor(AERO, levels = c("SISCEAB","CINDACTA I","CINDACTA II", "CINDACTA III", "CINDACTA IV", "CRCEA-SE")))


TI.REG.VAR<-ggplot(BDS_VAR_TI_REG)+
  geom_col(aes(x = AERO, y = VAR, fill = COR), 
           na.rm = TRUE, color = "black",width = 0.25) +
  theme_minimal()+
  geom_hline(yintercept = 0) +
  scale_y_continuous(limits=c(-.3,.3),labels = scales::label_percent(scale = 100))+
  coord_cartesian(xlim = c(1.2,5.6))+
  guides(fill = "none") +
  geom_text(aes(x = AERO, y = VAR, label=scales::percent(VAR,accuracy = 0.1),vjust = ifelse(VAR < 0, 1.25, -0.25)),size= 4,fontface="bold")+
  labs(x = NULL, y = "Var. 2021/2022") +
  scale_fill_manual(values = c("dodgerblue4","firebrick"))+
  theme(axis.text.x = element_blank(),
        axis.title.y = element_text(size = 15))





#####




TI.REG<-BDS_KPI_13_REGIONAL_DF %>% filter(movimentos.ano%in%c(2020,2021,2022)&movimentos.aero!="SISCEAB") %>%
ggplot()+
  geom_col(aes(x=movimentos.aero, y=movimentos.percentual_ano, fill = as.factor(movimentos.ano)), position = "dodge",width = .6)+
  geom_hline(aes(yintercept = 3,  lty='Meta (3 min)'),color="red")+
  scale_linetype(name = NULL)+
  geom_text(aes(x=movimentos.aero, y=movimentos.percentual_ano, label = movimentos.percentual_ano, 
                group = movimentos.ano),size = 4,vjust=-1,
            position = position_dodge(width = 0.6), fontface="bold")+
   coord_cartesian(ylim = c(1, 4.5), expand = FALSE)+
  theme_classic() +
  labs( x = NULL, y = NULL
       ,fill = "ANO") +
  theme(legend.position = "bottom",
        legend.title=element_blank()
        ,legend.text     = element_text(size = 12)
        ,legend.key.size = unit(0.5, "cm"),
        plot.subtitle = element_text(size = 12, color = "#8B0000"),
        axis.text.x= element_text(size = 15),
        axis.title.y = element_text(size = 18))+
  scale_y_continuous(labels = NULL, limits = c(0,100))+
  scale_fill_manual(values = cores)


TI.SIS<-BDS_KPI_13_REGIONAL_DF %>% filter(movimentos.ano%in%c(2020,2021,2022)&movimentos.aero=="SISCEAB") %>%
  ggplot()+
  geom_col(aes(x=movimentos.aero, y=movimentos.percentual_ano, fill = as.factor(movimentos.ano)), position = "dodge",width = .6)+
  geom_hline(aes(yintercept = 3,  lty='Meta'),color="red")+
  scale_linetype(name = NULL)+
  geom_text(aes(x=movimentos.aero, y=movimentos.percentual_ano, label = movimentos.percentual_ano, 
                group = movimentos.ano),size = 5,vjust=-1,
            position = position_dodge(width = 0.5),fontface="bold")+
  coord_cartesian(ylim = c(1, 4.5), expand = FALSE)+
  theme_classic() +
  labs(caption=" ",x = NULL, y = "Tempo adicional de taxi-in (min)"
        ,fill = "ANO") +
  theme(panel.background=element_rect(fill = "#F0F8FF"),
    legend.position = "none",
    plot.caption = element_text(size = 32),
        legend.title=element_blank()
        ,legend.text     = element_text(size = 12)
        ,legend.key.size = unit(0.5, "cm"),
        plot.subtitle = element_text(size = 12, color = "#8B0000"),
        axis.text.x= element_text(size = 15),
        axis.title.y = element_text(size = 18))+
  scale_y_continuous(limits = c(0,100))+
  scale_fill_manual(values = cores)



l5 = grid.arrange(TI.SIS,SPACE,TI.REG, ncol=3,widths=c(.5,0.08,2),heights= c(1.5))
grid.arrange(TI.REG.VAR,l5, nrow=2,heights= c(1.3,4)) %>% 
ggsave(filename = "imagens/gf21.png", height = 22,width = 35, units = "cm")

 
 
 
 
 
```




#20 GRÁFICO DE TEMPO ADICIONAL DE TAXI-IN/OUT POR AEROPORTO

```{r echo=FALSE, warning=FALSE, message=FALSE,fig.height=9, fig.width=18}

BDS_TAXIINOUT2_2022 <- BDS_KPI_02_DF %>% filter(movimentos.ano %in% c(2022))%>%
  mutate(movimentos.regiao=factor(movimentos.regiao, levels = c("CINDACTA I", "CINDACTA II","CINDACTA III", "CINDACTA IV", "CRCEA-SE"))) %>% 
  arrange(movimentos.aero)





BDS_TAXIINOUT1_2022 <- BDS_KPI_13_DF %>% filter(movimentos.ano ==2022) %>%
  mutate(movimentos.regiao=factor(movimentos.regiao, levels = c("CINDACTA I", "CINDACTA II","CINDACTA III", "CINDACTA IV", "CRCEA-SE"))) %>% 
  arrange(movimentos.aero)


TAXI_IN_OUT_AERO <- bind_cols(BDS_TAXIINOUT2_2022,BDS_TAXIINOUT1_2022) %>% 
  transmute(REGIONAL=movimentos.regiao...7, AERO=movimentos.aero...8,
            TAXIIN= movimentos.percentual_ano...27, TAXIOUT=movimentos.percentual_ano...6)%>%
  pivot_longer(cols = TAXIIN:TAXIOUT,
                                                              names_to = "IN_OUT",
                                                              values_to = "ADICIONAL")%>% 
   mutate(AERO=factor(AERO, levels = c("SBBR","SBCF","SBCG","SBCT","SBFI","SBFL","SBPA",
                                      "SBFZ","SBMO","SBPS","SBRF","SBSV","SBBE","SBCY","SBEG",
                                      "SBGL","SBGR","SBKP","SBRJ","SBSP")))%>%
  arrange(AERO)



















TAXI_IN_OUT_AERO %>%
  ggplot()+
  geom_col(aes(x=AERO, y=ADICIONAL, fill = IN_OUT), position = "dodge")+
  facet_grid(cols = vars(REGIONAL),switch= "y", scales = "free_x", space = "free_x") +
  geom_hline(aes(yintercept = 3,  lty='Meta (3 min)'),color="red")+
  scale_linetype(name = NULL)+
  geom_text(aes(x=AERO, y=ADICIONAL, label = ADICIONAL, 
                group = IN_OUT),size = 3,vjust=-1,hjust=0.5,
            position = position_dodge(width = 0.9), fontface="bold")+
  coord_cartesian(ylim = c(0, 6), expand = FALSE)+
  labs( x = NULL, y = "Tempo adicional de taxi-in / out (min)"
        ,fill = "ANO") +
  theme(legend.position = "bottom",
        legend.title=element_blank()
        ,legend.text     = element_text(size = 12)
        ,legend.key.size = unit(0.5, "cm"),
        plot.subtitle = element_text(size = 12, color = "#8B0000"),
        axis.text.x= element_text(size = 12),
        axis.title.y = element_text(size = 18))+
  scale_y_continuous(limits = c(0,100))+
  scale_fill_manual(values = cores, labels=c("TAXI-IN", "TAXI-OUT"))
ggsave(filename = "imagens/gf24B.png", height = 22,width = 35, units = "cm")
```




##20.1 GRÁFICO DE TEMPO ADICIONAL DE TAXI-IN/OUT POR REGIONAL

```{r echo=FALSE, warning=FALSE, message=FALSE,fig.height=9, fig.width=18}
#GRÁFICO DE TEMPO ADICIONAL DE TAXI-IN/OUT POR REGIONAL(24)







TAXI_INOUT1_REGIONAL.2022 <- BDS_KPI_02_REGIONAL_DF %>% filter(movimentos.ano %in% c(2022))





TAXI_INOUT2_REGIONAL2022 <- BDS_KPI_13_REGIONAL_DF %>% filter(movimentos.ano ==2022) 


TAXI_IN_OUT_REGIONAL <- bind_cols(TAXI_INOUT2_REGIONAL2022,TAXI_INOUT1_REGIONAL.2022) %>% 
  transmute(REGIONAL=movimentos.aero...8, TAXIIN= movimentos.percentual_ano...6, TAXIOUT=movimentos.percentual_ano...27)%>%
  pivot_longer(cols = TAXIIN:TAXIOUT,
                                                              names_to = "IN_OUT",
                                                              values_to = "ADICIONAL")
















 TIO.REG<-TAXI_IN_OUT_REGIONAL %>% filter(REGIONAL!="SISCEAB") %>%
   ggplot()+
   geom_col(aes(x=REGIONAL, y=ADICIONAL, fill = IN_OUT), position = "dodge",width = .5)+
   geom_hline(aes(yintercept = 3,  lty='Meta (3 min)'),color="red")+
   scale_linetype(name = NULL)+
   geom_text(aes(x=REGIONAL, y=ADICIONAL, label = ADICIONAL,
                 group = IN_OUT),size = 5,vjust=-1,
             position = position_dodge(width = 0.5),fontface="bold")+
   coord_cartesian(ylim = c(0, 5), expand = FALSE)+
   theme_classic()+
   labs( x = NULL, y = NULL
         ,fill = "ANO") +
   theme(legend.position = "bottom",
         legend.title=element_blank()
         ,legend.text     = element_text(size = 12)
         ,legend.key.size = unit(0.5, "cm"),
         plot.subtitle = element_text(size = 12, color = "#8B0000"),
         axis.text.x= element_text(size = 15),
         axis.title.y = element_text(size = 18))+
   scale_y_continuous(labels = NULL, limits = c(0,100))+
   scale_fill_manual(values = cores, labels=c("TAXI-IN", "TAXI-OUT"))


 TIO.SIS<-TAXI_IN_OUT_REGIONAL %>% filter(REGIONAL=="SISCEAB") %>%
   ggplot()+
   geom_col(aes(x=REGIONAL, y=ADICIONAL, fill = IN_OUT), position = "dodge",width = .5)+
   geom_hline(aes(yintercept = 3,  lty='Meta'),color="red")+
   scale_linetype(name = NULL)+
   geom_text(aes(x=REGIONAL, y=ADICIONAL, label = ADICIONAL,
                 group = IN_OUT),size = 5,vjust=-1,
             position = position_dodge(width = 0.5),fontface="bold")+
   coord_cartesian(ylim = c(0, 5), expand = FALSE)+
   theme_classic() +
   labs(caption=" ",x = NULL, y = "Tempo adicional de taxi-in / out (min)"
        ,fill = "ANO") +
   theme(panel.background=element_rect(fill = "#F0F8FF"),
         legend.position = "none",
         plot.caption = element_text(size = 32),
         legend.title=element_blank()
         ,legend.text     = element_text(size = 12)
         ,legend.key.size = unit(0.5, "cm"),
         plot.subtitle = element_text(size = 12, color = "#8B0000"),
         axis.text.x= element_text(size = 15),
         axis.title.y = element_text(size = 18))+
   scale_y_continuous(limits = c(0,100))+
   scale_fill_manual(values = cores)


  grid.arrange(TIO.SIS,SPACE,TIO.REG, ncol=3,widths=c(0.7,0.2,3)) %>%
 ggsave(filename = "imagens/gf24.png", height = 22,width = 35, units = "cm")

```



#21 Rotas mais voadas em 2022 

```{r echo=FALSE, message=FALSE, warning=FALSE}
#Rotas mais voadas em 2022(40)


BDS_15_2021_FIR <- BDS_KPI_15_DF %>% filter(movimentos.ano %in% c(2021))%>%
  group_by(movimentos.fluxo)%>%group_by(movimentos.fluxo)%>%
  arrange(movimentos.fluxo)
BDS_15_2022_FIR <- BDS_KPI_15_DF %>% filter(movimentos.ano %in% c(2022))%>%
  group_by(movimentos.fluxo)%>%group_by(movimentos.fluxo)%>%
  arrange(movimentos.fluxo)

BDS_VAR_15_FIR <- bind_cols(BDS_15_2021_FIR,BDS_15_2022_FIR) %>% 
mutate(VAR=(movimentos.total_movimentos...32-movimentos.total_movimentos...9)/movimentos.total_movimentos...9)%>% mutate(COR = as.factor(ifelse(VAR > 0, yes = 1, no = 0)))

COLOCACAO <- data.frame(COLOCACAO=c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20))



GFVAR_ROTA <- BDS_VAR_15_FIR %>% filter(movimentos.total_movimentos...32>4400)%>%
ggplot()+
  geom_col(aes(x = reorder(movimentos.fluxo...8, movimentos.total_movimentos...32), y = VAR, fill = COR), 
           na.rm = TRUE, color = "black",width = 0.20) +
  theme_void()+
  geom_hline(yintercept = 0) +
  scale_y_continuous(limits=c(-1.8,1.5),labels = scales::label_percent(scale = 100))+
  scale_x_discrete(breaks = NULL)+
  guides(fill = FALSE) +
  geom_text(aes(x = movimentos.fluxo...8, y = VAR, label=scales::percent(VAR,accuracy = 0.1),hjust = ifelse(VAR < 0, 1.25, -0.25)),size= 3.5)+
  labs(title= "Var. 2021/2022",x = NULL, y = NULL) +
  scale_fill_manual(values = c("dodgerblue4","firebrick"))+
  theme(plot.title = element_text(size = 15,
                                  face = "bold",
                                  hjust = 0.5),
        plot.caption = element_text(size = 31))+coord_flip()





GF_ROTA <- ggplot(BDS_VAR_15_FIR%>% filter(movimentos.total_movimentos...32>4400) ,
         aes(x=movimentos.fluxo...31,y=movimentos.total_movimentos...32))+
  geom_col(aes(reorder(movimentos.fluxo...31,movimentos.total_movimentos...32),
               movimentos.total_movimentos...32), fill = "#191970")+
    geom_label(aes(x = movimentos.fluxo...31, y = movimentos.total_movimentos...32,
                   label =format(movimentos.total_movimentos...32,big.mark=".") ),
               color = "#112446",hjust=1.5, size=3) +
   geom_text(aes(x = 20:1, y = -200,
                   label =1:20),
               color = "#112446",hjust=1.5, size=3)+
  scale_y_continuous(limits=c(-500,19000), labels = NULL)+
  labs(y = NULL, x = "Rotas mais voadas", title = " ") +
  theme_classic() +
  theme(plot.title = element_text(size = 10),
        axis.title.y = element_text(size = 15),
        axis.title.x = element_text(size = 15,
                                    face = "bold"))+
  coord_flip()

grid.arrange(GF_ROTA,GFVAR_ROTA, ncol=2,widths=c(3,1.5)) %>%
ggsave(filename = "imagens/gf40.png", height = 25, width = 22, units = "cm")

```


#TEMPO ADICIONAL EM TMA

##22.1 TEMPO ADICIONAL EM TMA

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=9, fig.width=18}

#Tempo adicional em TMA em 2021(33)







##############


BDS_KPI08_C40_C100 %>% filter(ANO=="2022") %>% 
  pivot_longer(cols = PONTUALIDADE_ANO_C40:PONTUALIDADE_ANO_C100,
               names_to = "C40_C100",
               values_to = "ADICIONAL") %>% 
  ggplot(aes(x = AERO, y = ADICIONAL, fill = as.factor(C40_C100)))+
  geom_col(position=position_dodge(preserve = "single")) +
  geom_hline(aes(yintercept = 4,  lty='Meta (4 min)'),color="red")+
  scale_linetype(name = NULL)+
  facet_grid(cols = vars(REGIONAL),switch= "y", scales = "free_x", space = "free_x") +
  geom_text(aes( y = ADICIONAL, label = ADICIONAL),vjust=-.5, position = position_dodge(width=.9), size = 5, color = "black", fontface="bold")+
  scale_y_continuous(limits = c(0,6))+
  scale_fill_manual(values = c("#B0C4DE","#4682B4"),labels=c("C100", "C40"))+
  labs(fill=NULL,x = NULL, y = "Tempo adicional em TMA (min)") +
  theme(legend.position = "bottom",
    plot.title = element_text(size = 18,
                              face = "bold",
                              hjust = 0.5),
    plot.caption = element_text(hjust = .5,
                                face = "bold"),
    axis.title.y = element_text(size = 18),
    axis.text.x = element_text(size = 15)
    ,legend.text     = element_text(size = 12))
ggsave(filename = "imagens/gf33.png", height = 22,width = 35, units = "cm")
```



##22.2 TEMPO ADICIONAL EM TMA SBGR

```{r echo=FALSE, message=FALSE, warning=FALSE}

#Tempo adicional em TMA mensal em SBGR (34)
 
  
  
  
  BDS_KPI_08_MES %>% filter(AERO%in%c("SBGR_40","SBGR_100"), ANO=="2022") %>% 
    mutate(MES=factor(MES,levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ")), ANO=as.character(ANO)) %>% 
    ggplot(aes(x = MES, y = ADICIONAL, fill = as.factor(AERO)))+
    geom_col(position=position_dodge(preserve = "single")) +
  geom_hline(aes(yintercept = 4,  lty='Meta (4 min)'),color="red")+
  scale_linetype(name = NULL)+
    geom_text(aes(x = MES, y = ADICIONAL, label = ADICIONAL),vjust=-.5, position = position_dodge(width=.9), size = 3, color = "black")+
    scale_y_continuous(limits = c(0,6))+
    scale_fill_manual(values = c("#B0C4DE","#4682B4"),labels=c("C100", "C40"))+
    labs(fill=NULL, x = NULL, y = "Tempo adicional em TMA - SBGR (min)") +
    theme_classic()+
    theme(legend.position = "bottom",
      plot.title = element_text(size = 18,
                                face = "bold",
                                hjust = 0.5),
      plot.caption = element_text(hjust = .5,
                                  face = "bold"))
ggsave(filename = "imagens/gf34.png", height = 15, units = "cm")

```


##22.3 TEMPO ADICIONAL EM TMA SBSP

```{r echo=FALSE, message=FALSE, warning=FALSE}

#Tempo adicional em TMA mensal em SBSP (34)
 
  
  
  
  BDS_KPI_08_MES %>% filter(AERO%in%c("SBSP_40","SBSP_100"), ANO=="2022") %>% 
    mutate(MES=factor(MES,levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ")), ANO=as.character(ANO)) %>% 
    ggplot(aes(x = MES, y = ADICIONAL, fill = as.factor(AERO)))+
    geom_col(position=position_dodge(preserve = "single")) +
  geom_hline(aes(yintercept = 4,  lty='Meta (4 min)'),color="red")+
  scale_linetype(name = NULL)+
    geom_text(aes(x = MES, y = ADICIONAL, label = ADICIONAL),vjust=-.5, position = position_dodge(width=.9), size = 3, color = "black")+
    scale_y_continuous(limits = c(0,10))+
    scale_fill_manual(values = c("#B0C4DE","#4682B4"),labels=c("C100", "C40"))+
    labs(fill=NULL, x = NULL, y = "Tempo adicional em TMA - SBSP (min)") +
    theme_classic()+
    theme(legend.position = "bottom",
      plot.title = element_text(size = 18,
                                face = "bold",
                                hjust = 0.5),
      plot.caption = element_text(hjust = .5,
                                  face = "bold"))
ggsave(filename = "imagens/gf34B.png", height = 15, units = "cm")

```





##22.4 TEMPO ADICIONAL EM TMA SBCF

```{r echo=FALSE, message=FALSE, warning=FALSE}

#Tempo adicional em TMA mensal em SBCF (35)
  
  
  
  BDS_KPI_08_MES %>% filter(AERO%in%c("SBCF_40","SBCF_100")&ANO=="2022") %>% 
    mutate(MES=factor(MES,levels = c("JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ")), ANO=as.character(ANO)) %>% 
    ggplot(aes(x = MES, y = ADICIONAL, fill = as.factor(AERO)))+
    geom_col(position=position_dodge(preserve = "single")) +
  geom_hline(aes(yintercept = 4,  lty='Meta (4 min)'),color="red")+
  scale_linetype(name = NULL)+
    geom_text(aes( y = ADICIONAL, label = ADICIONAL),vjust=-.5, position = position_dodge(width=.9), size = 3, color = "black")+
    scale_y_continuous(limits = c(0,5))+
    scale_fill_manual(values = c("#B0C4DE","#4682B4"),labels=c("C100", "C40"))+
    labs(fill=NULL, x = NULL, y = "Tempo adicional em TMA - SBCF (min)") +
  theme_classic()+
    theme(legend.position = "bottom",
      plot.title = element_text(size = 18,
                                face = "bold",
                                hjust = 0.5),
      plot.caption = element_text(hjust = .5,
                                  face = "bold"))
ggsave(filename = "imagens/gf35.png", height = 15, units = "cm")

```



##22.5 TEMPO ADICIONAL EM TMA REGIONAL

```{r echo=FALSE, message=FALSE, warning=FALSE}
#Tempo adicional em TMA por Regional e SISCEAB em 2021 (36)



GFTAD_TMA_SIS <- BDS_KPI08_C40_C100_REGIONAL %>% filter(ANO=="2022"& AERO=="SISCEAB") %>%
  ggplot(aes(x = AERO, y = ADICIONAL, fill = as.factor(C40_100)))+
    geom_col(position=position_dodge(preserve = "single"))+
  geom_hline(aes(yintercept = 4,  lty='Meta (4 min)'),color="red")+
  scale_linetype(name = NULL)+
    geom_text(aes( y = ADICIONAL, label = ADICIONAL),vjust=-.5, position = position_dodge(width=.9), size = 4, color = "black")+
    scale_y_continuous(limits = c(0,5))+
    scale_fill_manual(values = c("#B0C4DE","#4682B4"),labels=c("C100", "C40"))+
    labs(fill=NULL, x = NULL, y = "Tempo adicional em TMA (min)") +
    theme_classic()+
    theme(legend.position = "none",
      plot.title = element_text(size = 18,
                                face = "bold",
                                hjust = 0.5),
      plot.caption = element_text(hjust = .5,
                                  face = "bold"))









GFTAD_TMA_REG <-BDS_KPI08_C40_C100_REGIONAL %>% filter(ANO=="2022"& AERO!="CINDACTA IV" & AERO!="SISCEAB") %>%
  ggplot(aes(x = AERO, y = ADICIONAL, fill = as.factor(C40_100)))+
    geom_col(position=position_dodge(preserve = "single"))+
  geom_hline(aes(yintercept = 4,  lty='Meta (4 min)'),color="red")+
  scale_linetype(name = NULL)+
    geom_text(aes( y = ADICIONAL, label = ADICIONAL),vjust=-.5, position = position_dodge(width=.9), size = 4, color = "black")+
    scale_y_continuous(limits = c(0,5),labels = NULL)+
    scale_fill_manual(values = c("#B0C4DE","#4682B4"),labels=c("C100", "C40"))+
    labs(fill=NULL, x = NULL, y = NULL) +
    theme_classic()+
    theme(legend.position = "bottom",
      plot.title = element_text(size = 18,
                                face = "bold",
                                hjust = 0.5),
      plot.caption = element_text(hjust = .5,
                                  face = "bold"))



GFTAD_TMA_SIS + GFTAD_TMA_REG+plot_layout(ncol=2,widths = c(.7,3))
ggsave(filename = "imagens/gf36.png", height = 15,width = 25, units = "cm")

```
## 22.6 TEMPO ADICIONAL EM TMA C40 COM VAR

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=10, fig.width=18}




BDS_VAR_C40_C100_2021_DOM <- BDS_KPI08_C40_C100 %>% filter(ANO %in% c(2021))%>%
  mutate(PONTUALIDADE_ANO_C40_21=PONTUALIDADE_ANO_C40, PONTUALIDADE_ANO_C100_21=PONTUALIDADE_ANO_C100)
BDS_VAR_C40_C100_2022_DOM <- BDS_KPI08_C40_C100 %>% filter(ANO %in% c(2022))%>%
  mutate(PONTUALIDADE_ANO_C40_22=PONTUALIDADE_ANO_C40, PONTUALIDADE_ANO_C100_22=PONTUALIDADE_ANO_C100)
BDS_VAR_C40_C100_DOM <- bind_cols(BDS_VAR_C40_C100_2021_DOM$REGIONAL,
                                  BDS_VAR_C40_C100_2021_DOM$AERO,
                                  BDS_VAR_C40_C100_2021_DOM$PONTUALIDADE_ANO_C40_21,
                                  BDS_VAR_C40_C100_2021_DOM$PONTUALIDADE_ANO_C100_21,
                                  BDS_VAR_C40_C100_2022_DOM$PONTUALIDADE_ANO_C40_22,
                                  BDS_VAR_C40_C100_2022_DOM$PONTUALIDADE_ANO_C100_22) %>% 

  mutate(VARC40=(...5-...3)/...3,
VARC100=(...6-...4)/...4)%>%
  mutate(CORC40 = as.factor(ifelse(VARC40 > 0, yes = 1, no = 0)), CORC100 = as.factor(ifelse(VARC100 > 0, yes = 1, no = 0)))%>%
  mutate(...2=factor(...2, levels = c("SBBR","SBCF","SBCT","SBFL","SBPA",
                                      "SBRF","SBSV",
                                      "SBGL","SBGR","SBKP","SBRJ","SBSP")))
            

GFVARC40 <-
  ggplot(BDS_VAR_C40_C100_DOM)+ 
  
  geom_col(aes(x = ...2, y = VARC40, fill = CORC40), 
           na.rm = TRUE, color = "black",width = 0.35) +
  theme_minimal()+
  geom_hline(yintercept = 0) +
  scale_y_continuous(limits=c(-1,1),labels = scales::label_percent(scale = 100))+
  #coord_cartesian(xlim = c(1.05,19.8))+
  guides(fill = "none") +
  geom_text(aes(x = ...2, y = VARC40, label=scales::percent(VARC40,accuracy = 0.1),vjust = ifelse(VARC40 < 0, 1.25, -0.25)),size= 5)+
  labs(x = NULL, y = "Var. 2021/2022") +
  scale_fill_manual(values = c("dodgerblue4","firebrick"))+
  theme(axis.text.x = element_blank(),
        axis.title.y = element_text(size = 15))






GFVARCC40 <- ggplot(data=BDS_KPI08_C40_C100%>%filter(ANO!=2023) )+
  geom_col(aes(x = AERO, y = PONTUALIDADE_ANO_C40,fill = as.factor(ANO)),
           position="dodge")+
  facet_grid(cols = vars(REGIONAL),switch= "y", scales = "free_x", space = "free_x")+
  geom_hline(data=BDS_KPI08_C40_C100 ,
             aes(yintercept = 4,  lty='Meta (4 min)'),color="red")+
  scale_linetype(name = NULL)+
  geom_text(data=BDS_KPI08_C40_C100%>%filter(ANO!=2023),aes(x=AERO,y=PONTUALIDADE_ANO_C40, 
                label =      PONTUALIDADE_ANO_C40,
                group = ANO),size = 5, fontface="bold",
            hjust = 0.5, vjust=-.5
            ,position = position_dodge(width = 0.9))+
  #scale_y_continuous(limits = c(0,6))+
  scale_fill_manual(values=c("#B0C4DE","#4682B4"))+
  labs(fill=NULL,x = NULL, y = "Tempo adicional em TMA (min) - C-40") +
  theme(legend.position = "bottom",
        plot.title = element_text(size = 18,
                                  face = "bold",
                                  hjust = 0.5),
        plot.caption = element_text(hjust = .5,
                                    face = "bold"),
        axis.title.y = element_text(size = 18),
        axis.text.x = element_text(size = 15)
        ,legend.text     = element_text(size = 12))



GFVARC40 + GFVARCC40 +plot_layout(ncol=1,heights = c(1.4,3)) 
ggsave(filename = "imagens/gf52.png", height = 22,width = 35, units = "cm")

```



## 22.7 TEMPO ADICIONAL EM TMA C100 COM VAR

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=10, fig.width=18}






GFVARC100 <-
  ggplot(BDS_VAR_C40_C100_DOM)+ 
  
  geom_col(aes(x = ...2, y = VARC100, fill = CORC100), 
           na.rm = TRUE, color = "black",width = 0.35) +
  theme_minimal()+
  geom_hline(yintercept = 0) +
  scale_y_continuous(limits=c(-1,1),labels = scales::label_percent(scale = 100))+
  #coord_cartesian(xlim = c(1.05,19.8))+
  guides(fill = "none") +
  geom_text(aes(x = ...2, y = VARC100, label=scales::percent(VARC100,accuracy = 0.1),vjust = ifelse(VARC100 < 0, 1.25, -0.25)),size= 5)+
  labs(x = NULL, y = "Var. 2021/2022") +
  scale_fill_manual(values = c( "dodgerblue4","firebrick"))+
  theme(axis.text.x = element_blank(),
        axis.title.y = element_text(size = 15))






GFVARCC100 <- ggplot(data=BDS_KPI08_C40_C100%>%filter(ANO!=2023) )+
  geom_col(aes(x = AERO, y = PONTUALIDADE_ANO_C100,fill = as.factor(ANO)),
           position="dodge")+
  facet_grid(cols = vars(REGIONAL),switch= "y", scales = "free_x", space = "free_x")+
  geom_hline(data=BDS_KPI08_C40_C100 ,
             aes(yintercept = 4,  lty='Meta (4 min)'),color="red")+
  scale_linetype(name = NULL)+
  geom_text(data=BDS_KPI08_C40_C100%>%filter(ANO!=2023),aes(x=AERO,y=PONTUALIDADE_ANO_C100, 
                label =      PONTUALIDADE_ANO_C100,
                group = ANO),size = 5, fontface="bold",
            hjust = 0.5, vjust=-.5
            ,position = position_dodge(width = 0.9))+
  #scale_y_continuous(limits = c(0,6))+
  scale_fill_manual(values=c("#B0C4DE","#4682B4"))+
  labs(fill=NULL,x = NULL, y = "Tempo adicional em TMA (min) - C-100") +
  theme(legend.position = "bottom",
        plot.title = element_text(size = 18,
                                  face = "bold",
                                  hjust = 0.5),
        plot.caption = element_text(hjust = .5,
                                    face = "bold"),
        axis.title.y = element_text(size = 18),
        axis.text.x = element_text(size = 15)
        ,legend.text     = element_text(size = 12))



GFVARC100 + GFVARCC100 +plot_layout(ncol=1,heights = c(1.4,3)) 
ggsave(filename = "imagens/gf53.png", height = 22,width = 35, units = "cm")

```


#Horas de LOGIN X horas de escala

#23.1 Horas de LOGIN X horas de escala ACC

```{r echo=FALSE, message=FALSE, warning=FALSE}

#Horas de LOGIN X horas de escala(37) IDBR 06












IDBR_06_VAR_ACC21 <- BDS_IDBR_06_ACC_DF%>%filter(movimentos.ano==2021)
  IDBR_06_VAR_ACC22 <- BDS_IDBR_06_ACC_DF%>%filter(movimentos.ano==2022)
  IDBR_06_VAR_ACC <- bind_cols(IDBR_06_VAR_ACC21$movimentos.aero,IDBR_06_VAR_ACC21$movimentos.percentual_ano,
                              IDBR_06_VAR_ACC22$movimentos.percentual_ano )%>%
  mutate(VAR=(...3-...2)/...2)%>%
    mutate(CORC = as.factor(ifelse(VAR > 0, yes = 1, no = 0)))
  



GFVARIDBR6 <-IDBR_06_VAR_ACC%>%filter(...1!="BRASIL",...1!="CRCEA-SE")%>%
  ggplot()+
  geom_col(aes(x = ...1, y = VAR, fill = CORC),
           na.rm = TRUE, color = "black",width = 0.35) +
  theme_minimal()+
  geom_hline(yintercept = 0) +
  scale_y_continuous(limits=c(-1,1),labels = scales::label_percent(scale = 100))+
  #coord_cartesian(xlim = c(1.05,19.8))+
  guides(fill = "none") +
  geom_text(aes(x = ...1, y = VAR, label=scales::percent(VAR,accuracy = 0.1),vjust = ifelse(VAR < 0, 1.25, -0.25)),size= 4)+
  labs(x = NULL, y = "Var. 2021/2022") +
  scale_fill_manual(values = c( "dodgerblue4","firebrick"))+
  theme(axis.text.x = element_blank(),
        axis.title.y = element_text(size = 15))







BDS_IDBR_06_ACC_DF %>% filter(movimentos.percentual_ano>=0&movimentos.regiao!="BRASIL"& movimentos.regiao!="CRCEA-SE") %>% 
  mutate(movimentos.aero=case_when(movimentos.aero=="SBBS"~"ACC-BS",
                                   movimentos.aero=="SBCW"~"ACC-CW",
                                   movimentos.aero=="SBRE"~"ACC-RE",
                                   movimentos.aero=="SBAZ"~"ACC-AZ",
                                   movimentos.aero=="SBAO"~"ACC-AO")) %>%
ggplot()+
  geom_col(aes(x=movimentos.aero, y=movimentos.percentual_ano, fill = as.factor(movimentos.ano)), position = "dodge")+
  facet_grid(cols = vars(movimentos.regiao),switch= "y", scales = "free_x", space = "free_x") +
  geom_text(aes(x=movimentos.aero, y=movimentos.percentual_ano, label = scales::percent(movimentos.percentual_ano, accuracy = 1,scale = 1), group = movimentos.ano),size = 3,
            vjust = -0.4,
            position = position_dodge(width = 0.9))+
  labs( x = NULL, y = "Horas de login X horas de escala - ACC"
       ,fill = "ANO") +
  theme(legend.position = "bottom",
        legend.title=element_blank()
        ,legend.text     = element_text(size = 8)
        ,legend.key.size = unit(0.3, "cm"),
        plot.title = element_text(size = 18L,
                                  face = "bold",
                                  hjust = 0.5),
        plot.subtitle = element_text(size = 12, color = "#8B0000"),
        plot.caption = element_text(hjust = .5,
                                    face = "bold"))+
  scale_y_continuous(labels = NULL, limits = c(0,100))+
  scale_fill_manual(values = cores)
ggsave(filename = "imagens/gf37.png",height = 15,width = 22, units = "cm")
```

## 23.2 Horas de LOGIN X horas de escala APP

```{r echo=FALSE, message=FALSE, warning=FALSE}

#Horas de LOGIN X horas de escala APP (38)

#creiei o teste para resolver a falta dos dados de 2021 do APP RF

linha.APP.RF.2021 = data.table::data.table (movimentos.ano = 2021,
                          movimentos.percentual_ano = 0,
                          movimentos.regiao = "CINDACTA III",
                          movimentos.aero = "APP RF")

IDBRTESTE <- BDS_IDBR_06_APP_DF  %>% select(movimentos.ano, movimentos.percentual_ano,movimentos.regiao,movimentos.aero)
  IDBRFINAL <- bind_rows(IDBRTESTE,linha.APP.RF.2021)


# PARA O PRÓXIMO ANO USAR A BDS _IDBR_06_APP_DF


IDBRFINAL  %>% 
  filter(movimentos.ano%in% c("2021","2022")) %>% 
   ggplot()+
  geom_col(aes(x=movimentos.aero, y=movimentos.percentual_ano, fill = as.factor(movimentos.ano)), position = "dodge")+
  facet_grid(cols = vars(movimentos.regiao),switch= "y", scales = "free_x", space = "free_x") +
  geom_text(aes(x=movimentos.aero, y=movimentos.percentual_ano, label = scales::percent(movimentos.percentual_ano, accuracy = 1,scale = 1), group = movimentos.ano),size = 3,
            vjust = -0.4,
            position = position_dodge(width = 0.9))+
  labs( x = NULL, y = "Horas de login X horas de escala - APP"
       ,fill = "ANO") +
  theme(legend.position = "bottom",
        legend.title=element_blank()
        ,legend.text     = element_text(size = 8)
        ,legend.key.size = unit(0.3, "cm"),
        plot.title = element_text(size = 18L,
                                  face = "bold",
                                  hjust = 0.5),
        plot.subtitle = element_text(size = 12, color = "#8B0000"),
        plot.caption = element_text(hjust = .5,
                                    face = "bold"))+
  scale_y_continuous(labels = NULL, limits = c(0,100))+
  scale_fill_manual(values = cores)
ggsave(filename = "imagens/gf38.png",height = 15,width = 22, units = "cm")
```

## 23.3 Horas de LOGIN X horas de escala TWR

```{r echo=FALSE, message=FALSE, warning=FALSE}
#Horas de LOGIN X horas de escala por TWR(39)



#creiei o teste para resolver a falta dos dados de 2021 do APP RF

linha.twr.RF.2021 = data.table::data.table (movimentos.ano = 2021,
                          movimentos.percentual_ano = 0,
                          movimentos.regiao = "CINDACTA III",
                          movimentos.aero = "SBRF")

IDBRTESTETWR <- BDS_IDBR_06_TWR_DF  %>% select(movimentos.ano, movimentos.percentual_ano,movimentos.regiao,movimentos.aero)
  IDBRFINALTWR <- bind_rows(IDBRTESTETWR,linha.twr.RF.2021)


# PARA O PRÓXIMO ANO USAR A BDS _IDBR_06_APP_DF




IDBRFINALTWR %>% 
  filter(movimentos.ano%in% c("2022")) %>% 
  ggplot()+
  geom_col(aes(x=movimentos.aero, y=movimentos.percentual_ano, fill = as.factor(movimentos.ano)), position = "dodge")+
  facet_grid(cols = vars(movimentos.regiao),switch= "y", scales = "free_x",space = "free_x") +
  geom_text(aes(x=movimentos.aero, y=movimentos.percentual_ano, label = scales::percent(movimentos.percentual_ano, accuracy = 1,scale = 1), group = movimentos.ano),size = 3,
            vjust = -0.4,
            position = position_dodge(width = 0.9))+
  labs( x = NULL, y = "Horas de login X horas de escala TWR"
       ,fill = "ANO") +
  theme(legend.position = "bottom",
        legend.title=element_blank()
        ,legend.text     = element_text(size = 8)
        ,legend.key.size = unit(0.3, "cm"),
        plot.title = element_text(size = 18L,
                                  face = "bold",
                                  hjust = 0.5),
        plot.caption = element_text(hjust = .5,
                                    face = "bold"))+
  scale_y_continuous(labels = NULL, limits = c(0,100))+
  scale_fill_manual(values = "#708090")
ggsave(filename = "imagens/gf39.png",height = 15,width = 22, units = "cm")

```

# MAPAS CHS


## 24.1 MAPA SETOR SBBS

```{r echo=FALSE, message=FALSE, warning=FALSE}
#Capacidade Horária de Setor FIR SBBS (28)




PONT_TEXTO_BS <- data.frame(Y=c(-22.16,-21.35,-22.05,-20.03,-20.23,-20.33,-17.23,-17.35,-13.37,-14.30,-14.51,-16.48,-17.50,-18.51,-17.37,-20.20,-22.17),
                            X=c(-45.62,-46.08,-47.29,-46.30,-47.58,-49.30,-48.46,-51.46,-52.14,-49.37,-46.10,-46.39,-47.01,-45.23,-43.35,-44.50,-48.56), 
                            SETOR=c("BS-1","BS-2","BS-3","BS-4","BS-5","BS-6","BS-7","BS-8","BS-9","BS-10","BS-11","BS-12","BS-13","BS-14","BS-15","BS-16","BS-17")
                            ,CHS=c(46,46,46,47,47,48,47,49,49,49,49,47,47,46,45,46,47))








#Capacidade Horária de Setor FIR SBBS

VERTICES_SETORES_FIR_SBBS <- VERTICES_SETORES_FIR_SET22 %>% filter(str_detect(ident,"SBBS"))
ggplot()+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 1"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 2"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 3"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 4"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 5"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 6"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 7"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 8"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 9"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 10"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 11"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 12"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 13"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 14"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 15"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 16"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 17"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_text(data = PONT_TEXTO_BS,aes(x=X,y = Y,label= CHS), size=5,hjust=1)+
  geom_text(data = PONT_TEXTO_BS,aes(x=X,y = Y,label= SETOR), size=3,vjust=2.1)+
  theme_void()+
  labs( x = NULL, y = NULL)+
  theme(plot.title = element_text(size = 18,
                                  face = "bold",
                                  hjust = 0.5),
        plot.subtitle = element_text(size = 12, color = "#8B0000"),
       )
ggsave(filename = "imagens/gf28.png", height = 15, units = "cm")
```


##24.2 MAPA SETOR SBCW

```{r echo=FALSE, message=FALSE, warning=FALSE}


#CAPACIDADE POR SETOR CW(29)


PONT_TEXTO_CW <- data.frame(Y=c(-31.56,-29.42,-27.58,-28.41,-25.37,-26.27,-24.51,-22.30,-22.22,-23.50,-26.10,-24.22,-23.15,-21.35,-19.08,-20.04,-22.34,-25.23,-24.40,-26.45),
                            X=c(-51.09,-54.21,-51.14,-48.19,-47.23,-45.50,-43.05,-40.46,-44.03,-47.35,-48.60,-48.40,-49.34,-52.06,-53.45,-56.41,-54.22,-52.49,-50.34,-50.09), 
                            SETOR=c("CW-1","CW-2","CW-3","CW-4","CW-5","CW-6","CW-6F","CW-7","CW-8","CW-9","CW-9F","CW-10","CW-11","CW-12","CW-13","CW-14","CW-15","CW-16","CW-17","CW-18"),
                            CHS=c(44,44,48,49,48,44,"*",49,48,48,"*",48,44,44,44,49,49,49,44,48))







VERTICES_SETORES_FIR_SBCW <- VERTICES_SETORES_FIR_SET22 %>% filter(str_detect(ident,"SBCW"))
ggplot()+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 1"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 2"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 03"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 4"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 05"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 6"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 6F"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 7"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 8"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 9"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 9F"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 10"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 11"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 12"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 13"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 14"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 15"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 16"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 17"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 18"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_text(data = PONT_TEXTO_CW,aes(x=X,y = Y,label= SETOR), size=3,vjust=2.1)+
  geom_text(data = PONT_TEXTO_CW,aes(x=X,y = Y,label= CHS), size=5)+
  theme_void()+
  labs( x = NULL, y = NULL)+
  theme(plot.title = element_text(size = 18,
                                  face = "bold",
                                  hjust = 0.5),
        plot.subtitle = element_text(size = 12, color = "#8B0000")      )
ggsave(filename = "imagens/gf29.png", height = 15, units = "cm")

```


## 24.3 MAPA SETOR SBRE

```{r echo=FALSE, message=FALSE, warning=FALSE}

#SETORES RE (30)


PONT_TEXTO_RE <- data.frame(Y=c(-2.08,-4.38,-5.01,-6.04,-8.08,-9.07,-9.56,-11.29,-11.27,-13.29,-13.27,-15.29,-16.59,-18.29,-19.10),
                            X=c(-38.14,-34.07,-39.51,-36.06,-43.08,-39.59,-36.15,-37.46,-45.20,-42.44,-38.47,-41.01,-39.11,-41.22,-39.26), 
                            SETOR=c("RE-1","RE-2","RE-3","RE-4","RE-5","RE-6","RE-7","RE-8","RE-9","RE-10","RE-11","RE-12","RE-13","RE-14","RE-15"),
                            CHS=c(40,33,38,34,29,27,48,48,33,33,56,37,20,55,56))



VERTICES_SETORES_FIR_SBRE <- VERTICES_SETORES_FIR_SET22 %>% filter(str_detect(ident,"SBRE"))
ggplot()+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 1"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 2"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 3"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 4"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 5"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 6"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 7"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 8"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 9"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 10"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 11"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 12"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 13"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 14"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 15"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
 geom_text(data = PONT_TEXTO_RE,aes(x=X,y = Y,label= CHS), size=5,hjust=1)+
  geom_text(data = PONT_TEXTO_RE,aes(x=X,y = Y,label= SETOR), size=3,vjust=2.1)+
  theme_void()+
  labs( x = NULL, y = NULL)+
  theme(plot.title = element_text(size = 18,
                                  face = "bold",
                                  hjust = 0.5),
        plot.subtitle = element_text(size = 12, color = "#8B0000")
        )
ggsave(filename = "imagens/gf30.png", height = 15, units = "cm")
```


## 24.4 MAPA SETOR SBAZ

```{r echo=FALSE, message=FALSE, warning=FALSE}

#SETORES AZ(31)

PONT_TEXTO_AZ <- data.frame(Y=c(-6.59,-2.11,-0.25,-1.34,-7.35,-11.16,-7.33,-4.57,0.26,-2.12,-5.30,-8.42,-9.53,-12.30,-15.25),
                            X=c(-47.07,-45.58,-51.34,-55.08,-51.17,-55.05,-59.32,-56.54,-60.59,-65.29,-70.28,-67.36,-62.30,-59.20,-55.49), 
                            SETOR=c("AZ-1","AZ-2","AZ-3","AZ-4","AZ-5","AZ-6","AZ-7","AZ-8","AZ-9","AZ-10","AZ-11","AZ-12","AZ-13","AZ-14","AZ-15"),
                            CHS=c(29,49,27,26,26,23,33,31,22,19,26,27,25,27,46))



VERTICES_SETORES_FIR_SBAZ <- VERTICES_SETORES_FIR_SET22 %>% filter(str_detect(ident,"SBAZ"))
ggplot()+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 1"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 2"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 3"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 4"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 5"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 6"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 7"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 8"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 9"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 10"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 11"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 12"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 13"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 14"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 15"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_text(data = PONT_TEXTO_AZ,aes(x=X,y = Y,label= CHS), size=5,hjust=1)+
  geom_text(data = PONT_TEXTO_AZ,aes(x=X,y = Y,label= SETOR), size=3,vjust=2.1)+
  theme_void()+
  labs( x = NULL, y = NULL)+
  theme(plot.title = element_text(size = 18,
                                  face = "bold",
                                  hjust = 0.5),
        plot.subtitle = element_text(size = 12, color = "#8B0000"),
        )
ggsave(filename = "imagens/gf31.png", height = 15, units = "cm")
```

##24.5 MAPA SETOR SBAO

```{r echo=FALSE, message=FALSE, warning=FALSE}

# SETORES AO (32)



PONT_TEXTO_AO <- data.frame(Y=c(5,1.5,-26.00),
                            X=c(-36,-31.01,-27.14), 
                            SETOR=c("AO-1","AO-2","AO-3"),
                            CHS=c(13,18,13))

# c(2.24,4.50,2.31,0.42,-0.04,-3.56,-12.51,-26.00,-10.27),
#                             X=c(-44.14,-37.37,-35.05,-34.09,-31.01,-28.59,-34.53,-27.14,-19.05)

VERTICES_SETORES_FIR_SBAO <- VERTICES_SBAO
ggplot()+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAO %>% filter(nam=="SECTOR 1A"),aes(x=LONGITUDE,y = LATITUDE),fill ="#DCDCDC", colour= "#A9A9A9",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAO %>% filter(nam=="SECTOR 1B"),aes(x=LONGITUDE,y = LATITUDE),fill ="#DCDCDC", colour= "#A9A9A9",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAO %>% filter(nam=="SECTOR 1C"),aes(x=LONGITUDE,y = LATITUDE),fill ="#DCDCDC", colour= "#A9A9A9",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAO %>% filter(nam=="SECTOR 2A"),aes(x=LONGITUDE,y = LATITUDE),fill ="#DCDCDC", colour= "#A9A9A9",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAO %>% filter(nam=="SECTOR 2B"),aes(x=LONGITUDE,y = LATITUDE),fill ="#DCDCDC", colour= "#A9A9A9",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAO %>% filter(nam=="SECTOR 2C"),aes(x=LONGITUDE,y = LATITUDE),fill ="#DCDCDC", colour= "#A9A9A9",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAO %>% filter(nam=="SECTOR 3A"),aes(x=LONGITUDE,y = LATITUDE),fill ="#DCDCDC", colour= "#A9A9A9",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAO %>% filter(nam=="SECTOR 3B"),aes(x=LONGITUDE,y = LATITUDE),fill ="#DCDCDC", colour= "#A9A9A9",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAO %>% filter(nam=="SECTOR 3C"),aes(x=LONGITUDE,y = LATITUDE),fill ="#DCDCDC", colour= "#A9A9A9",alpha=0.5)+
geom_text(data = PONT_TEXTO_AO,aes(x=X,y = Y,label= CHS), size=5,hjust=1)+
  geom_text(data = PONT_TEXTO_AO,aes(x=X,y = Y,label= SETOR), size=3,vjust=2.1)+
  theme_void()+
  labs( x = NULL, y = NULL)+
  theme(plot.title = element_text(size = 18,
                                  face = "bold",
                                  hjust = 0.5),
        plot.subtitle = element_text(size = 12, color = "#8B0000")
        )
ggsave(filename = "imagens/gf32.png", height = 15, units = "cm")
```



# MAPAS de FIR


## 25.1 MAPA SETOR SBBS

```{r echo=FALSE, message=FALSE, warning=FALSE}
#Capacidade Horária de Setor FIR SBBS (28)




PONT_TEXTO_FIRBS <- data.frame(Y=c(-22.16,-21.35,-22.05,-20.03,-20.23,-20.33,-17.23,-17.35,-13.37,-14.30,-14.51,-16.48,-17.50,-18.51,-17.37,-20.20,-22.17),
                            X=c(-45.62,-46.08,-47.29,-46.30,-47.58,-49.30,-48.46,-51.46,-52.14,-49.37,-46.10,-46.39,-47.01,-45.23,-43.35,-44.50,-48.56), 
                            SETOR=c("BS-1","BS-2","BS-3","BS-4","BS-5","BS-6","BS-7","BS-8","BS-9","BS-10","BS-11","BS-12","BS-13","BS-14","BS-15","BS-16","BS-17"))








#Capacidade Horária de Setor FIR SBBS

VERTICES_SETORES_FIR_SBBS <- VERTICES_SETORES_FIR_SET22 %>% filter(str_detect(ident,"SBBS"))
ggplot()+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 1"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 2"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 3"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 4"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 5"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 6"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 7"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 8"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 9"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 10"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 11"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 12"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 13"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 14"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 15"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 16"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBBS %>% filter(nam=="SECTOR 17"),aes(x=LONGITUDE,y = LATITUDE),fill ="#FFFF99", colour= "#BDB76B",alpha=0.5)+
  geom_text(data = PONT_TEXTO_FIRBS,aes(x=X,y = Y,label= SETOR), size=3,vjust=2.1)+
  theme_void()+
  labs( x = NULL, y = NULL)+
  theme(plot.title = element_text(size = 18,
                                  face = "bold",
                                  hjust = 0.5),
        plot.subtitle = element_text(size = 12, color = "#8B0000"),
       )
ggsave(filename = "imagens/gf33.png", height = 15, units = "cm")
```


##25.2 MAPA SETOR SBCW

```{r echo=FALSE, message=FALSE, warning=FALSE}


#CAPACIDADE POR SETOR CW(29)


PONT_TEXTO_FIRCW <- data.frame(Y=c(-31.56,-29.42,-27.58,-28.41,-25.37,-26.27,-24.51,-22.30,-22.22,-23.50,-26.10,-24.22,-23.15,-21.35,-19.08,-20.04,-22.34,-25.23,-24.40,-26.45),
                            X=c(-51.09,-54.21,-51.14,-48.19,-47.23,-45.50,-43.05,-40.46,-44.03,-47.35,-48.60,-48.40,-49.34,-52.06,-53.45,-56.41,-54.22,-52.49,-50.34,-50.09), 
                            SETOR=c("CW-1","CW-2","CW-3","CW-4","CW-5","CW-6","CW-6F","CW-7","CW-8","CW-9","CW-9F","CW-10","CW-11","CW-12","CW-13","CW-14","CW-15","CW-16","CW-17","CW-18"))







VERTICES_SETORES_FIR_SBCW <- VERTICES_SETORES_FIR_SET22 %>% filter(str_detect(ident,"SBCW"))
ggplot()+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 1"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 2"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 03"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 4"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 05"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 6"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 6F"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 7"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 8"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 9"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 9F"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 10"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 11"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 12"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 13"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 14"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 15"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 16"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 17"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBCW %>% filter(nam=="SECTOR 18"),aes(x=LONGITUDE,y = LATITUDE),fill ="#007FFF", colour= "#4169E1",alpha=0.5)+
  geom_text(data = PONT_TEXTO_FIRCW,aes(x=X,y = Y,label= SETOR), size=3,vjust=2.1)+
  theme_void()+
  labs( x = NULL, y = NULL)+
  theme(plot.title = element_text(size = 18,
                                  face = "bold",
                                  hjust = 0.5),
        plot.subtitle = element_text(size = 12, color = "#8B0000")      )
ggsave(filename = "imagens/gf34.png", height = 15, units = "cm")

```


## 25.3 MAPA SETOR SBRE

```{r echo=FALSE, message=FALSE, warning=FALSE}

#SETORES RE (30)


PONT_TEXTO_FIRRE <- data.frame(Y=c(-2.08,-4.38,-5.01,-6.04,-8.08,-9.07,-9.56,-11.29,-11.27,-13.29,-13.27,-15.29,-16.59,-18.29,-19.10),
                            X=c(-38.14,-34.07,-39.51,-36.06,-43.08,-39.59,-36.15,-37.46,-45.20,-42.44,-38.47,-41.01,-39.11,-41.22,-39.26), 
                            SETOR=c("RE-1","RE-2","RE-3","RE-4","RE-5","RE-6","RE-7","RE-8","RE-9","RE-10","RE-11","RE-12","RE-13","RE-14","RE-15"))



VERTICES_SETORES_FIR_SBRE <- VERTICES_SETORES_FIR_SET22 %>% filter(str_detect(ident,"SBRE"))
ggplot()+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 1"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 2"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 3"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 4"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 5"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 6"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 7"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 8"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 9"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 10"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 11"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 12"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 13"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 14"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBRE %>% filter(nam=="SECTOR 15"),aes(x=LONGITUDE,y = LATITUDE),fill ="#CC0000", colour= "#DC143C",alpha=0.5)+
  geom_text(data = PONT_TEXTO_FIRRE,aes(x=X,y = Y,label= SETOR), size=3,vjust=2.1)+
  theme_void()+
  labs( x = NULL, y = NULL)+
  theme(plot.title = element_text(size = 18,
                                  face = "bold",
                                  hjust = 0.5),
        plot.subtitle = element_text(size = 12, color = "#8B0000")
        )
ggsave(filename = "imagens/gf35.png", height = 15, units = "cm")
```


## 25.4 MAPA SETOR SBAZ

```{r echo=FALSE, message=FALSE, warning=FALSE}

#SETORES AZ(31)

PONT_TEXTO_FIRAZ <- data.frame(Y=c(-6.59,-2.11,-0.25,-1.34,-7.35,-11.16,-7.33,-4.57,0.26,-2.12,-5.30,-8.42,-9.53,-12.30,-15.25),
                            X=c(-47.07,-45.58,-51.34,-55.08,-51.17,-55.05,-59.32,-56.54,-60.59,-65.29,-70.28,-67.36,-62.30,-59.20,-55.49), 
                            SETOR=c("AZ-1","AZ-2","AZ-3","AZ-4","AZ-5","AZ-6","AZ-7","AZ-8","AZ-9","AZ-10","AZ-11","AZ-12","AZ-13","AZ-14","AZ-15"))



VERTICES_SETORES_FIR_SBAZ <- VERTICES_SETORES_FIR_SET22 %>% filter(str_detect(ident,"SBAZ"))
ggplot()+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 1"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 2"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 3"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 4"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 5"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 6"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 7"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 8"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 9"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 10"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 11"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 12"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 13"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 14"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAZ %>% filter(nam=="SECTOR 15"),aes(x=LONGITUDE,y = LATITUDE),fill ="#215E21", colour= "#2E8B57",alpha=0.5)+
  geom_text(data = PONT_TEXTO_FIRAZ,aes(x=X,y = Y,label= SETOR), size=3,vjust=2.1)+
  theme_void()+
  labs( x = NULL, y = NULL)+
  theme(plot.title = element_text(size = 18,
                                  face = "bold",
                                  hjust = 0.5),
        plot.subtitle = element_text(size = 12, color = "#8B0000"),
        )
ggsave(filename = "imagens/gf36.png", height = 15, units = "cm")
```

##25.5 MAPA SETOR SBAO

```{r echo=FALSE, message=FALSE, warning=FALSE}

# SETORES AO (32)



PONT_TEXTO_FIRAO <- data.frame(Y=c(5,1.5,-26.00),
                            X=c(-36,-31.01,-27.14), 
                            SETOR=c("AO-1","AO-2","AO-3"))

# c(2.24,4.50,2.31,0.42,-0.04,-3.56,-12.51,-26.00,-10.27),
#                             X=c(-44.14,-37.37,-35.05,-34.09,-31.01,-28.59,-34.53,-27.14,-19.05)

VERTICES_SETORES_FIR_SBAO <- VERTICES_SBAO
ggplot()+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAO %>% filter(nam=="SECTOR 1A"),aes(x=LONGITUDE,y = LATITUDE),fill ="#DCDCDC", colour= "#A9A9A9",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAO %>% filter(nam=="SECTOR 1B"),aes(x=LONGITUDE,y = LATITUDE),fill ="#DCDCDC", colour= "#A9A9A9",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAO %>% filter(nam=="SECTOR 1C"),aes(x=LONGITUDE,y = LATITUDE),fill ="#DCDCDC", colour= "#A9A9A9",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAO %>% filter(nam=="SECTOR 2A"),aes(x=LONGITUDE,y = LATITUDE),fill ="#DCDCDC", colour= "#A9A9A9",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAO %>% filter(nam=="SECTOR 2B"),aes(x=LONGITUDE,y = LATITUDE),fill ="#DCDCDC", colour= "#A9A9A9",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAO %>% filter(nam=="SECTOR 2C"),aes(x=LONGITUDE,y = LATITUDE),fill ="#DCDCDC", colour= "#A9A9A9",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAO %>% filter(nam=="SECTOR 3A"),aes(x=LONGITUDE,y = LATITUDE),fill ="#DCDCDC", colour= "#A9A9A9",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAO %>% filter(nam=="SECTOR 3B"),aes(x=LONGITUDE,y = LATITUDE),fill ="#DCDCDC", colour= "#A9A9A9",alpha=0.5)+
  geom_polygon(data=VERTICES_SETORES_FIR_SBAO %>% filter(nam=="SECTOR 3C"),aes(x=LONGITUDE,y = LATITUDE),fill ="#DCDCDC", colour= "#A9A9A9",alpha=0.5)+
  geom_text(data = PONT_TEXTO_FIRAO,aes(x=X,y = Y,label= SETOR), size=3,vjust=2.1)+
  theme_void()+
  labs( x = NULL, y = NULL)+
  theme(plot.title = element_text(size = 18,
                                  face = "bold",
                                  hjust = 0.5),
        plot.subtitle = element_text(size = 12, color = "#8B0000")
        )
ggsave(filename = "imagens/gf37.png", height = 15, units = "cm")
```






<!--chapter:end:GRÁFICOSPRARABOOKDOWN.Rmd-->

